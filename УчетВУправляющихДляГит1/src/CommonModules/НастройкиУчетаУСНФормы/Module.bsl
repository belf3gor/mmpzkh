
////////////////////////////////////////////////////////////////////////////////
// Универсальные методы для формы записи регистра и формы настройки налогов
//
// Серверные методы формы записи регистра сведений НастройкиУчетаУСН
//
////////////////////////////////////////////////////////////////////////////////

#Область СлужебныеПроцедурыИФункции

#Область ОбработчикиСобытийФормы

Процедура ПриСозданииНаСервере(Форма, Отказ, СтандартнаяОбработка) Экспорт
	
	Запись = Форма.НастройкиУчетаУСН;
	
	ПодготовитьФормуНаСервере(Форма);
	
КонецПроцедуры

Процедура ПодготовитьФормуНаСервере(Форма) Экспорт
	
	Запись = Форма.НастройкиУчетаУСН;
	Элементы = Форма.Элементы;
	
	Если НЕ ЗначениеЗаполнено(Запись.Организация) Тогда
		Запись.Организация = БухгалтерскийУчетПереопределяемый.ПолучитьЗначениеПоУмолчанию("ОсновнаяОрганизация");
	КонецЕсли;
	
	Если Элементы.Найти("ТекущаяДата") <> Неопределено Тогда
		ПериодЧтениеяНастройки = Форма.ТекущаяДата;
	Иначе
		ПериодЧтениеяНастройки = Запись.Период;
	КонецЕсли;
	
	ЗаполнитьЗначенияСвойств(Форма,
		НастройкиУчетаУСНФормыВызовСервера.НастройкиСистемыНалогообложения(
		Запись.Организация, ПериодЧтениеяНастройки));
	
	НастройкиУчетаУСНФормыКлиентСервер.УправлениеФормой(Форма);
	
КонецПроцедуры

Процедура ПроверитьЗаполнениеНаСервере(Форма, Отказ, ПроверяемыеРеквизиты) Экспорт
	
	Запись = Форма.НастройкиУчетаУСН;
	ПределСтавки = ?(Форма.ПрименяетсяУСНДоходы, 6, 15);
	Если Запись.СтавкаНалога > ПределСтавки Тогда
		ТекстПредупреждения = СтрШаблон(НСтр("ru = 'Выбранная ставка не может применяться.
			|Максимально допустимая ставка налога для выбранного объекта налогообложения равна %1%2.'"), ПределСтавки, НСтр("ru = '%' "));
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстПредупреждения,,"СтавкаНалога", "НастройкиУчетаУСН");
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
