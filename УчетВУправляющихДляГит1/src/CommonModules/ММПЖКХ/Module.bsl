// Функция преобразует ТаблицуЗначений в Массив из структур.
Функция ПреобразоватьТаблицуЗначенийВМассив(тзДанные) Экспорт
    
    мсДанные = Новый Массив;
        
    // Запишем в массив
    Для Каждого СтрокаТЗ Из тзДанные Цикл
        
        стСтрокаТаблицы = Новый Структура;
        Для Каждого ИмяКолонки Из тзДанные.Колонки Цикл
            стСтрокаТаблицы.Вставить(ИмяКолонки.Имя, СтрокаТЗ[ИмяКолонки.Имя]);
        КонецЦикла;
        
        мсДанные.Добавить(стСтрокаТаблицы);
        
    КонецЦикла;
    
    Возврат мсДанные;
    
КонецФункции // ПреобразоватьТаблицуЗначенийВМассив()

// Функция преобразует Массив из структур в ТаблицуЗначений.
//
Функция ПреобразоватьМассивВТаблицуЗначений(мсДанные) Экспорт
    
    тзДанные = Новый ТаблицаЗначений;
    
    Для Каждого ЭлементМассива Из мсДанные Цикл
        // Рисуем колонки для таблицы
        Если тзДанные.Колонки.Количество() = 0 Тогда
            Для Каждого ЗначениеСтруктуры Из ЭлементМассива Цикл
                тзДанные.Колонки.Добавить(ЗначениеСтруктуры.Ключ);
            КонецЦикла;
        КонецЕсли;
        
        // Добавляем данные в таблицу
        НоваяСтрока = тзДанные.Добавить();
        Для Каждого ЗначениеСтруктуры Из ЭлементМассива Цикл
            НоваяСтрока[ЗначениеСтруктуры.Ключ] = ЗначениеСтруктуры.Значение;
        КонецЦикла;
    КонецЦикла;
    
    Возврат тзДанные;
    
КонецФункции // ПреобразоватьМассивВТаблицуЗначений()

Функция ПолучитьСтроку(ТекАргумент)   Экспорт
    Возврат ЗначениеВСтрокуВнутр(ТекАргумент);	
КонецФункции

Функция ПолучитьТаблицуЗначенийПоИмениВТ(Запрос,ИмяТаблицы) Экспорт
	Запрос.Текст = "ВЫБРАТЬ * ИЗ " + ИмяТаблицы;
	Возврат Запрос.Выполнить().Выгрузить();
КонецФункции
//++ Позолотина  10.03.2019 для расчета налога на прибыль  для субконто "НДС, доначисленный" корреспонденция с 68 счетом
			// вместо колонки доход с минусом, перекладываем сумму в расход
Функция ИзменитьТекстЗапросаДляСправкиРасчета(СхемаКомпоновкиДанных) Экспорт
ТекстЗапроса5_для_замены = "
|        ДоходыГодНДС.Субконто1,
|        ДоходыГодНДС.СуммаОборотКт - ДоходыГодНДС.СуммаОборотДт,
|        0,
|        0,
|        0,
|        ДоходыГодНДС.СуммаНУОборотКт - ДоходыГодНДС.СуммаНУОборотДт,
|        0,
|        0,
|        0,
|        ДоходыГодНДС.СуммаПРОборотКт - ДоходыГодНДС.СуммаПРОборотДт,
|        0,
|        0,
|        0,
|        ДоходыГодНДС.СуммаВРОборотКт - ДоходыГодНДС.СуммаВРОборотДт,
|        0,
|        0,
|        0,
|        ДоходыГодНДС.Организация";

ТекстЗапроса6_для_замены ="
|        ДоходыМесяцНДС.Субконто1,
|        0,
|        ДоходыМесяцНДС.СуммаОборотКт - ДоходыМесяцНДС.СуммаОборотДт,
|        0,
|        0,
|        0,
|        ДоходыМесяцНДС.СуммаНУОборотКт - ДоходыМесяцНДС.СуммаНУОборотДт,
|        0,
|        0,
|        0,
|        ДоходыМесяцНДС.СуммаПРОборотКт - ДоходыМесяцНДС.СуммаПРОборотДт,
|        0,
|        0,
|        0,
|        ДоходыМесяцНДС.СуммаВРОборотКт - ДоходыМесяцНДС.СуммаВРОборотДт,
|        0,
|        0,
|        ДоходыМесяцНДС.Организация";
ТекстЗапроса5_новый = "
|		ДоходыГодНДС.Субконто1,
|		ВЫБОР
|			КОГДА ДоходыГодНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА 0
|			ИНАЧЕ ДоходыГодНДС.СуммаОборотКт - ДоходыГодНДС.СуммаОборотДт
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыГодНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА ДоходыГодНДС.СуммаОборотДт - ДоходыГодНДС.СуммаОборотКт
|			ИНАЧЕ 0
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыГодНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА 0
|			ИНАЧЕ ДоходыГодНДС.СуммаНУОборотКт - ДоходыГодНДС.СуммаНУОборотДт
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыГодНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА ДоходыГодНДС.СуммаНУОборотДт - ДоходыГодНДС.СуммаНУОборотКт
|			ИНАЧЕ 0
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыГодНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА 0
|			ИНАЧЕ ДоходыГодНДС.СуммаПРОборотКт - ДоходыГодНДС.СуммаПРОборотДт
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыГодНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА ДоходыГодНДС.СуммаПРОборотДт - ДоходыГодНДС.СуммаПРОборотКт
|			ИНАЧЕ 0
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыГодНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА 0
|			ИНАЧЕ ДоходыГодНДС.СуммаВРОборотКт - ДоходыГодНДС.СуммаВРОборотДт
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыГодНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА ДоходыГодНДС.СуммаВРОборотДт - ДоходыГодНДС.СуммаВРОборотКт
|			ИНАЧЕ 0
|		КОНЕЦ,
|		0,
|		ДоходыГодНДС.Организация";
ТекстЗапроса6_новый = "
|		ДоходыМесяцНДС.Субконто1,
|		0,
|		ВЫБОР
|			КОГДА ДоходыМесяцНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА 0
|			ИНАЧЕ ДоходыМесяцНДС.СуммаОборотКт - ДоходыМесяцНДС.СуммаОборотДт
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыМесяцНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА ДоходыМесяцНДС.СуммаОборотДт - ДоходыМесяцНДС.СуммаОборотКт
|			ИНАЧЕ 0
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыМесяцНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА 0
|			ИНАЧЕ ДоходыМесяцНДС.СуммаНУОборотКт - ДоходыМесяцНДС.СуммаНУОборотДт
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыМесяцНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА ДоходыМесяцНДС.СуммаНУОборотДт - ДоходыМесяцНДС.СуммаНУОборотКт
|			ИНАЧЕ 0
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыМесяцНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА 0
|			ИНАЧЕ ДоходыМесяцНДС.СуммаПРОборотКт - ДоходыМесяцНДС.СуммаПРОборотДт
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыМесяцНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА ДоходыМесяцНДС.СуммаПРОборотДт - ДоходыМесяцНДС.СуммаПРОборотКт
|			ИНАЧЕ 0
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыМесяцНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА 0
|			ИНАЧЕ ДоходыМесяцНДС.СуммаВРОборотКт - ДоходыМесяцНДС.СуммаВРОборотДт
|		КОНЕЦ,
|		0,
|		ВЫБОР
|			КОГДА ДоходыМесяцНДС.Субконто1 = &НДСдоначисленный
|				ТОГДА ДоходыМесяцНДС.СуммаВРОборотДт - ДоходыМесяцНДС.СуммаВРОборотКт
|			ИНАЧЕ 0
|		КОНЕЦ,
|		ДоходыМесяцНДС.Организация";


			ТекстЗапроса_расходы = СхемаКомпоновкиДанных.НаборыДанных.ДоходыРасходы.Элементы.НеосновнаяДеятельность.Запрос;
			ТекстЗапроса_расходы = стрзаменить(ТекстЗапроса_расходы,ТекстЗапроса5_для_замены, ТекстЗапроса5_новый);
			ТекстЗапроса_расходы = стрзаменить(ТекстЗапроса_расходы,ТекстЗапроса6_для_замены, ТекстЗапроса6_новый);
			СхемаКомпоновкиДанных.НаборыДанных.ДоходыРасходы.Элементы.НеосновнаяДеятельность.Запрос = ТекстЗапроса_расходы;
			НдсДоначисленный = СхемаКомпоновкиДанных.Параметры.Добавить(); 
			НдсДоначисленный.Имя = "НДСдоначисленный";
			//НдсДоначисленный.Заголовок = "Период";
			НдсДоначисленный.ТипЗначения = Новый ОписаниеТипов("СправочникСсылка.ПрочиеДоходыИРасходы");
			НдсДоначисленный.ОграничениеИспользования = Ложь;
			НдсДоначисленный.Значение = Справочники.ПрочиеДоходыИРасходы.НайтиПоКоду("00-000101");
			НдсДоначисленный.Использование = ИспользованиеПараметраКомпоновкиданных.Всегда;
			//НдсДоначисленный.ВключатьВДоступныеПоля = Истина;
	
	
	  Возврат СхемаКомпоновкиДанных;
	
	
КонецФункции
