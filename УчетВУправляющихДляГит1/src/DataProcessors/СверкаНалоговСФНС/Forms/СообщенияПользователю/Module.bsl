
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Организация           = Параметры.Организация;
	ДоступностьОтчетности = Параметры.ДоступностьОтчетности;
	ВывестиТекстСообщения(ДоступностьОтчетности);
	УстановитьВидимостьКнопок(ДоступностьОтчетности);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ПодключитьОтчетность(Команда)
	
	Оповещение = Новый ОписаниеОповещения("ПодключитьОтчетностьЗавершение", ЭтотОбъект);
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОткрытьФормуМастераЗаявленияНаПодключение(
		Организация,
		,
		,
		,
		,
		Оповещение);
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ВывестиТекстСообщения(ДоступностьОтчетности)

	Если Не ДоступностьОтчетности.РазрешеноИспользование Тогда
		
		Заголовок = НСтр("ru = '1С-Отчетность'");
		ТекстСообщения = Новый ФорматированнаяСтрока(
			НСтр("ru = 'Для сверки платежей с ФНС требуется'"),
			" ",
			Новый ФорматированнаяСтрока(НСтр("ru = '1С-Отчетность.'"),,,, СсылкаПодробнее()),
			Символы.ПС,
			НСтр("ru = 'У вас недостаточно прав для ее использования,
				|обратитесь к администратору.'"));
		
	Иначе // отчетность не подключена
		
		Заголовок = НСтр("ru = 'Подключение 1С-Отчетности'");
		ТекстСообщения = Новый ФорматированнаяСтрока(
			НСтр("ru = 'Для сверки платежей с ФНС подключите 1С-Отчетность.
				|А еще вы сможете сдать отчетность
				|прямо из программы.'"),
			" ",
			Новый ФорматированнаяСтрока(НСтр("ru = 'Подробнее'"),,,, СсылкаПодробнее()));
		
	КонецЕсли;

КонецПроцедуры

&НаСервере
Процедура УстановитьВидимостьКнопок(ДоступностьОтчетности)
	
	Если Не ДоступностьОтчетности.РазрешеноИспользование Тогда
		Элементы.ОК.Видимость                        = Истина;
		Элементы.ФормаПодключитьОтчетность.Видимость = Ложь;
	Иначе // отчетность не подключена
		Элементы.ОК.Видимость                        = Ложь;
		Элементы.ФормаПодключитьОтчетность.Видимость = Истина;
	КонецЕсли;

КонецПроцедуры

&НаСервереБезКонтекста
Функция СсылкаПодробнее()

	Возврат "https://portal.1c.ru/applications/5";

КонецФункции

&НаКлиенте
Процедура ПодключитьОтчетностьЗавершение(Результат, ДополнителныеПараметры) Экспорт

	Закрыть();

КонецПроцедуры

#КонецОбласти