#Область ОбработчикиСобытийФормы

&НаСервере
// Устанавливает параметры, переданные из формы РегистрацияНовогоАккаунта.
//
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Логин            = Параметры.Логин;
	Пароль           = Параметры.Пароль;
	ЭлектронныйАдрес = Параметры.Email;
	Телефон          = Параметры.Телефон;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
// Команда "Продолжить". Отправляет кодовое слово на проверку.
//
Процедура ПроверитьКодовоеСлово(Команда)
	
	СведенияОбОшибке = "";
	ВыполненоУспешно = Ложь;
	
	Если Не КодовоеСлово = "" Тогда
		
		СтруктураРегистрации = ОТР_АккаунтыИнтернетСервисовСервер.ПодготовитьСтруктуруРегистрации(Логин, Пароль, ЭлектронныйАдрес);
		ВыполненоУспешно     = ОТР_АккаунтыИнтернетСервисовСервер.ОтправитьВведенноеКодовоеСловоНаСерверДляПроверки(КодовоеСлово, СведенияОбОшибке, СтруктураРегистрации);
		
		Если ВыполненоУспешно Тогда
			ПоказатьПредупреждение(, "Регистрация прошла успешно", 0, );
			Оповестить("ОповеститьФормуРегистрации");
		Иначе
			КодовоеСлово = "";
		КонецЕсли;
		
	Иначе
		Сообщить("Кодовое слово не указано!");
	КонецЕсли;
	
	Если Не СведенияОбОшибке = "" Тогда
		ПоказатьПредупреждение(, СведенияОбОшибке);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
// Отправляет кодовое слово на сервер повторно.
//
Процедура ОтправитьКодовоеСловоПовторно(Команда)
	
	СведенияОбОшибке = "";
	СтруктураРегистрации = ОТР_АккаунтыИнтернетСервисовСервер.ПодготовитьСтруктуруРегистрации(Логин, Пароль, ЭлектронныйАдрес);
	ОТР_АккаунтыИнтернетСервисовСервер.ОтправитьКодовоеСловоНаEmailПовторно(СведенияОбОшибке, СтруктураРегистрации);
	Если Не Реквизит = "ДляПроверки" Тогда
		Сообщить("Кодовое слово отправлено повторно.");
	КонецЕсли;
	Если Не СведенияОбОшибке = "" Тогда
		ПоказатьПредупреждение(, СведенияОбОшибке);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
// Закрывает текущую форму и переходит на форму регистрации аккаунта для того, чтобы изменить введенные данные.
//
Процедура ИзменитьВведенныеДанные(Команда)
	
	Закрыть();
	
КонецПроцедуры

#КонецОбласти
