
#Область ОсновныеПроцедурыИФункции

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)

	// Обход ошибки платформы Параметр сеанса отсутствует или удален
	ПолеТабличногоДокументаФормаОтчета.Очистить();
	
	СформироватьСтруктуруРеквизитовФормы();
	
	СтруктураРеквизитовФормы.СписокПечатаемыхЛистов = Новый СписокЗначений;
	
	// ОПИСАНИЕ ПАРМЕТРОВ ФОРМЫ
	//
	// Версия формы
	СтруктураРеквизитовФормы.мВерсияФормы = "08/10/2013";
	// Код отчета, равен коду по ОКУД
	СтруктураРеквизитовФормы.мКодОтчета   = "0609200";
	
	СтруктураРеквизитовФормы.мПечатныеФормы = Новый СписокЗначений;
	
	ПолеТабличногоДокументаФормаОтчета.Вывести(Отчеты[Сред(Лев(ЭтаФорма.ИмяФормы, Найти(ЭтаФорма.ИмяФормы, ".Форма.") - 1), 7)].ПолучитьМакет("ФормаОтчета2013Годовая_ФормаОтчета"));

	СтруктураРеквизитовФормы.мВыбраннаяФорма          = Параметры.мВыбраннаяФорма;
	СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета  = Параметры.мДатаКонцаПериодаОтчета;
	СтруктураРеквизитовФормы.мДатаНачалаПериодаОтчета = Параметры.мДатаНачалаПериодаОтчета;
	СтруктураРеквизитовФормы.мПериодичность           = Параметры.мПериодичность;
	СтруктураРеквизитовФормы.мСкопированаФорма        = Параметры.мСкопированаФорма;
	СтруктураРеквизитовФормы.мСохраненныйДок          = Параметры.мСохраненныйДок;
	СтруктураРеквизитовФормы.Организация              = Параметры.Организация;
	
	ДатаПодписи = ТекущаяДатаСеанса();
	
	СтруктураРеквизитовФормы.СправочникиВидыКонтактнойИнформацииПочтовыйАдресОрганизации = Справочники.ВидыКонтактнойИнформации.ПочтовыйАдресОрганизации;
	
	Инициализация(Параметры.БезОткрытияФормы);
	
КонецПроцедуры

&НаСервере
Процедура СформироватьСтруктуруРеквизитовФормы()
	
	СтруктураРеквизитовФормы = РегламентированнаяОтчетность.СформироватьСтруктуруОбязательныхРеквизитовСтатистическогоОтчета();
	
КонецПроцедуры

&НаСервере
Процедура Инициализация(БезОткрытияФормы = Ложь) Экспорт
	
	СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Ложь;

	ТекТабличноеПоле = ПолеТабличногоДокументаФормаОтчета;

	СтруктураРеквизитовФормы.ВидДокумента = 0;
	НомерКорректировки = 1;
	СтруктураРеквизитовФормы.мАдресвФорматеДляВыгрузки = "";
	
	Если СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено Тогда
		
		Если СтруктураРеквизитовФормы.мСкопированаФорма <> Неопределено Тогда
			// документ скопирован
			ВосстановитьСохраненныеДанные();
		КонецЕсли;
		
		Модифицированность = Истина;

	Иначе

		// При открытии или при копировании сохраненного
		// отчета восстанавливаем сохраненные данные.
		ВосстановитьСохраненныеДанные();
		
		Если ЗначениеЗаполнено(СтруктураРеквизитовФормы.мСкопированаФорма) Тогда
			СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено;
		КонецЕсли;

	КонецЕсли;
	
	Если СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено Тогда
		НомерКорректировки = 0;
	Иначе
		НомерКорректировки = СтруктураРеквизитовФормы.мСохраненныйДок.Вид;
	КонецЕсли;
	
	// Кварплата+
	ТекТабличноеПоле.Области.ДатаСоставленияОтчета.Текст = Формат(ДатаПодписи, "ДФ=""дд ММММ гггг 'г.'""");
	// Кварплата-

	ПоказатьПериод();

	Если СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено Или СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация Тогда
		ЗаполнитьСведенияОбОрганизацииНаСервере();
	КонецЕсли;
	
	СтруктураРеквизитовФормы.НаимОрганизации = СтруктураРеквизитовФормы.Организация.Наименование;
	
	ТекущийЭлемент = Элементы["ПолеТабличногоДокументаФормаОтчета"];
	РегламентированнаяОтчетностьКлиентСервер.ПриИнициализацииФормыРегламентированногоОтчета(ЭтаФорма, "ФСГС");
	
КонецПроцедуры

// Процедура управляет показом в форме периода построения отчета.
//
&НаСервере
Процедура ПоказатьПериод()
	
	ПолеТабличногоДокументаФормаОтчета.Области.ПериодОтчета.Значение = Прав(Год(СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета), 2);
	
КонецПроцедуры

// Восстанавливает сохраненные данные отчета.
//
&НаСервере
Процедура ВосстановитьСохраненныеДанные()
	Перем ДанныеМногострочныхРазделов;
	Перем ДанныеВариановАвтоЗаполнения;
	Перем ПоказателиОтчета;
	Перем ВерсияФормы;

	// В случае, если формы была скопирована по F9, то проверим, не изменилась ли организация.
	Если СтруктураРеквизитовФормы.Организация <> СтруктураРеквизитовФормы.мСохраненныйДок.Организация
	   И СтруктураРеквизитовФормы.Организация <> РегламентированнаяОтчетностьКлиентСервер.ПустоеЗначениеТипа("СправочникСсылка.Организации")
	   И СтруктураРеквизитовФормы.Организация <> Неопределено Тогда
		// Меняем переменную, для того, чтобы запустилась процедура ЗаполнитьСведенияОбОрганизации.
		СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Истина;
		//СтруктураРеквизитовФормы.мСохраненныйДок.Организация = СтруктураРеквизитовФормы.Организация;
	Иначе
		// восстанавливаем реквизиты отчета
		СтруктураРеквизитовФормы.Организация = СтруктураРеквизитовФормы.мСохраненныйДок.Организация;
	КонецЕсли;

	ДатаПодписи              = СтруктураРеквизитовФормы.мСохраненныйДок.ДатаПодписи;
	СтруктураРеквизитовФормы.ЕдиницаИзмерения         = СтруктураРеквизитовФормы.мСохраненныйДок.ЕдиницаИзмерения;
	СтруктураРеквизитовФормы.ТочностьЕдиницыИзмерения = СтруктураРеквизитовФормы.мСохраненныйДок.ТочностьЕдиницыИзмерения;
	Комментарий                    = СтруктураРеквизитовФормы.мСохраненныйДок.Комментарий;

	// восстанавливаем сохраненные данные отчета
	СписокСохранения = СтруктураРеквизитовФормы.мСохраненныйДок.ДанныеОтчета.Получить();
	
	// восстанавливаем сохраненные данные вариантов автозаполнения ячеек
	Если СписокСохранения.Свойство("ДанныеВариантовАвтоЗаполнения", ДанныеВариановАвтоЗаполнения) Тогда
		
		Если НЕ ДанныеВариановАвтоЗаполнения = Неопределено Тогда
			
			мСтруктураВариантыЗаполнения.Очистить();
			
			Для Каждого ЭлементСтруктуры Из ДанныеВариановАвтоЗаполнения Цикл
				
				мСтруктураВариантыЗаполнения.Вставить(ЭлементСтруктуры.Ключ, ЭлементСтруктуры.Ключ);
				
				ЭтаФорма["ТаблицаВариантыЗаполнения" + ЭлементСтруктуры.Ключ].Очистить();
				
				Для Каждого ЭлементМассива Из ЭлементСтруктуры.Значение Цикл
										
					ТаблВарЗаполнения = ЭтаФорма["ТаблицаВариантыЗаполнения" + ЭлементСтруктуры.Ключ].Добавить().ТаблицаВариантовЗаполнения;
										
					ЗначениеВДанныеФормы(ЭлементМассива, ТаблВарЗаполнения);
					
				КонецЦикла;
				
			КонецЦикла;
			
		КонецЕсли;
			
	КонецЕсли;

	// восстанавливаем версию формы
	СписокСохранения.Свойство("ВерсияФормы", ВерсияФормы);
	
	// восстанавливаем сохраненные данные многострочных разделов
	Если СписокСохранения.Свойство("ДанныеМногострочныхРазделов", ДанныеМногострочныхРазделов) И ДанныеМногострочныхРазделов <> Неопределено Тогда
		
		Для Каждого ЭлементСтруктуры Из ДанныеМногострочныхРазделов Цикл
			
			НайденноеЗначение = Неопределено;
			
			мСтруктураМногострочныхРазделов.Свойство(ЭлементСтруктуры.Ключ, НайденноеЗначение);
			
			Если НЕ НайденноеЗначение = Неопределено Тогда
				
				ЗначениеВДанныеФормы(ЭлементСтруктуры.Значение, ЭтаФорма[НайденноеЗначение]);
				
				ВывестиРазделВТабличныйДокументНаСервере(НайденноеЗначение, ЭтаФорма[НайденноеЗначение]);
				
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЕсли;
	
	// восстановим сохраненные данные редактируемых ячеек
	СписокСохранения.Свойство( "ПоказателиОтчета", ПоказателиОтчета );
	
	Для Каждого ПоказателиСтраницы Из ПоказателиОтчета Цикл
		ИмяТекТабличноеПоле = ПоказателиСтраницы.Ключ;
		ТекТабличноеПоле    = ЭтаФорма[ИмяТекТабличноеПоле];
		ПоказателиТаблПоле  = ПоказателиСтраницы.Значение;

		Для Каждого Показатель Из ПоказателиТаблПоле Цикл
			ИмяПоказателя       = Показатель.Ключ;
			ЗначениеПоказателя  = Показатель.Значение;

			// установим значение в таблице
			Попытка
				Если Лев(ИмяПоказателя, 2) = "ЧН" Тогда
					// значение показателя с префиксом "ЧН" содержит формат представления нуля
					ОбластьПоказателя = ТекТабличноеПоле.Области[Сред(ИмяПоказателя, 3)];
					ОбластьПоказателя.Формат = РегламентированнаяОтчетностьКлиентСервер.ЗаменитьПредставлениеНуляВСтрокеФормата(ОбластьПоказателя.Формат, ЗначениеПоказателя);
					Продолжить;
				КонецЕсли;
				ТекТабличноеПоле.Области[ИмяПоказателя].Значение = ЗначениеПоказателя;
			Исключение
			КонецПопытки;
		КонецЦикла;
	КонецЦикла;

	СтруктураРеквизитовФормы.мАдресвФорматеДляВыгрузки = ПолеТабличногоДокументаФормаОтчета.Области.ОргАдрес.Значение;
	ПолеТабличногоДокументаФормаОтчета.Области.ОргАдрес.Значение = РегламентированнаяОтчетностьКлиентСервер.ПредставлениеАдресаВФормате9Запятых(СтруктураРеквизитовФормы.мАдресвФорматеДляВыгрузки);

	РегламентированнаяОтчетность.ОперацииПриВосстановленииРегламентированногоОтчета(ЭтаФорма);
	
	Модифицированность   = Ложь;

КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСведенияОбОрганизацииНаСервере(ВПрограммеИзмененаДатаПодписи = Ложь)
	
	РегламентированнаяОтчетностьКлиентСервер.ЗаполнитьСведенияОбОрганизацииДляОтчетаСтатистики(ЭтаФорма, ВПрограммеИзмененаДатаПодписи);
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьСведенияОбОрганизацииНаКлиенте(ВПрограммеИзмененаДатаПодписи = Ложь)
	
	РегламентированнаяОтчетностьКлиентСервер.ЗаполнитьСведенияОбОрганизацииДляОтчетаСтатистики(ЭтаФорма, ВПрограммеИзмененаДатаПодписи);
	
КонецПроцедуры

&НаКлиенте
Процедура СохранитьОтчет(Команда)
	
	СохранитьНаКлиенте();
	
КонецПроцедуры

// СохранитьНаКлиенте()
&НаКлиенте
Процедура СохранитьНаКлиенте(Автосохранение = Ложь, ВыполняемоеОповещение = Неопределено) Экспорт
	
	Вариант = СтруктураРеквизитовФормы.ВидДокумента * НомерКорректировки;
	
	Если НЕ РегламентированнаяОтчетностьКлиент.ПриЗаписиРегламентированногоОтчетаНаКлиенте(ЭтаФорма, , Автосохранение, Вариант) Тогда
		Возврат;
	КонецЕсли;
	
	ПодобныйОтчетСуществует = Ложь;
	ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки = Ложь;
	
	// формируем данные редактируемых ячеек таблицы
	ПоказателиОтчета = Новый Структура();
	
	#Если ВебКлиент Тогда
		ЗаполнитьПоказателиОтчетаНаСервере(ПоказателиОтчета);
	#Иначе
		ЗаполнитьПоказателиОтчетаНаКлиенте(ПоказателиОтчета);
	#КонецЕсли
	
	РезультатСохранения = ПередСохранением(, ПодобныйОтчетСуществует, Вариант, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, Автосохранение, ПоказателиОтчета);
	
	ВидДокументаНомерКорректировкиИзменен = Неопределено;
	
	Если ПодобныйОтчетСуществует И Автосохранение Тогда
		Возврат;
	КонецЕсли;
	
	НуженВопросПередСохранением = (ПодобныйОтчетСуществует ИЛИ ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки);
	
	Если НуженВопросПередСохранением Тогда
		СохранитьНаКлиентеСВопросом(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, ПодобныйОтчетСуществует, ПоказателиОтчета);
	Иначе		
		ПослеСохраненияНаКлиенте(ВыполняемоеОповещение, РезультатСохранения);		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СохранитьНаКлиентеСВопросом(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, ПодобныйОтчетСуществует, ПоказателиОтчета)
	
	Если ПодобныйОтчетСуществует Тогда
		
		Кнопки = Новый СписокЗначений;
		Кнопки.Добавить(КодВозвратаДиалога.Да, "Сохранить");
		Кнопки.Добавить(КодВозвратаДиалога.Нет, "Отмена");
		
		ТекстВопроса = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='Отчет с видом %1 уже существует.
		|Сохранить отчет с таким же видом?'"), ?(Вариант = 0, """Первичный""", """Корректирующий/" + Вариант + """"));
		ДополнительныеПараметры = Новый Структура("Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, ПоказателиОтчета", Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, ПоказателиОтчета);
		ОписаниеОповещения = Новый ОписаниеОповещения("ВопросСохранитьОтчетСТакимЖеВидомЗавершение", ЭтотОбъект, ДополнительныеПараметры);
		ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, Кнопки, , Кнопки.Получить(1).Значение);
		
	Иначе
		
		СохранитьНаКлиентеСВопросомПродолжение(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, ПоказателиОтчета);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВопросСохранитьОтчетСТакимЖеВидомЗавершение(Ответ, ДополнительныеПараметры) Экспорт
	
	Автосохранение = ДополнительныеПараметры.Автосохранение;
	Вариант = ДополнительныеПараметры.Вариант;
	ВыполняемоеОповещение = ДополнительныеПараметры.ВыполняемоеОповещение;
	ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки = ДополнительныеПараметры.ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки;
	ПоказателиОтчета = ДополнительныеПараметры.ПоказателиОтчета;
	
	Если Ответ = КодВозвратаДиалога.Нет Тогда
		
		Возврат;
		
	КонецЕсли;
	
	СохранитьНаКлиентеСВопросомПродолжение(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, ПоказателиОтчета);
	
КонецПроцедуры

&НаКлиенте
Процедура СохранитьНаКлиентеСВопросомПродолжение(Автосохранение, Вариант, ВыполняемоеОповещение, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, ПоказателиОтчета)
	
	Если ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки Тогда
		
		ПараметрыФормы = Новый Структура();
		ПараметрыФормы.Вставить("ВидОтчета", Вариант);
		
		ФормаВопроса = РегламентированнаяОтчетностьКлиент.ПолучитьОбщуюФормуПоИмени("ВопросПриИзмененииВидаДокументаНомераКорректировки", ПараметрыФормы);
		
		ДополнительныеПараметры = Новый Структура("Автосохранение, Вариант, ВыполняемоеОповещение, ПоказателиОтчета", Автосохранение, Вариант, ВыполняемоеОповещение, ПоказателиОтчета);
		ОписаниеОповещения = Новый ОписаниеОповещения("ВопросПриИзмененииВидаДокументаЗавершение", ЭтотОбъект, ДополнительныеПараметры);
		
		ФормаВопроса.ОписаниеОповещенияОЗакрытии = ОписаниеОповещения;
		ФормаВопроса.РежимОткрытияОкна = РежимОткрытияОкнаФормы.БлокироватьОкноВладельца;
		ФормаВопроса.Открыть();
		
	Иначе
		Состояние(СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='Сохраняется %1...'"), ЭтаФорма.Заголовок), , , БиблиотекаКартинок.Записать);
		РезультатСохранения = Сохранить(Автосохранение, , Вариант, Ложь, ПоказателиОтчета);
		ПослеСохраненияНаКлиенте(ВыполняемоеОповещение, РезультатСохранения);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВопросПриИзмененииВидаДокументаЗавершение(КодВозврата, ДополнительныеПараметры) Экспорт
	
	Автосохранение = ДополнительныеПараметры.Автосохранение;
	Вариант = ДополнительныеПараметры.Вариант;
	ВыполняемоеОповещение = ДополнительныеПараметры.ВыполняемоеОповещение;
	ПоказателиОтчета = ДополнительныеПараметры.ПоказателиОтчета;
	
	Если КодВозврата = КодВозвратаДиалога.Да
		ИЛИ КодВозврата = КодВозвратаДиалога.Нет Тогда
		
		ВидДокументаНомерКорректировкиИзменен = ?(КодВозврата = КодВозвратаДиалога.Да, Истина, Ложь);
		
	Иначе
		
		Возврат;
		
	КонецЕсли;
	
	Состояние(СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='Сохраняется %1...'"), ЭтаФорма.Заголовок), , , БиблиотекаКартинок.Записать);
	РезультатСохранения = Сохранить(Автосохранение, , Вариант, ВидДокументаНомерКорректировкиИзменен, ПоказателиОтчета);
	ПослеСохраненияНаКлиенте(ВыполняемоеОповещение, РезультатСохранения);
	
КонецПроцедуры

&НаКлиенте
Процедура ПослеСохраненияНаКлиенте(ВыполняемоеОповещение, РезультатСохранения)
	
	КлючУникальности = СтруктураРеквизитовФормы.мСохраненныйДок;
	
	Если РезультатСохранения Тогда
		
		РегламентированнаяОтчетностьКлиент.ПослеЗаписиРегламентированногоОтчета(ЭтаФорма);
		
		Если ВыполняемоеОповещение <> Неопределено Тогда
			ВыполнитьОбработкуОповещения(ВыполняемоеОповещение);
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры
// СохранитьНаКлиенте

// ПередСохранением()
//
&НаСервере
Функция ПередСохранением(КодИФНС = "не применимо", ПодобныйОтчетСуществует, Вариант, ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки, Автосохранение, ПоказателиОтчета)
	
	Если РегламентированнаяОтчетность.БылиИзмененыКлючевыеРеквизитыОтчета(ЭтаФорма, КодИФНС)
	   И РегламентированнаяОтчетность.СуществуетДокументСАналогичнымиРеквизитами(ЭтаФорма, КодИФНС) Тогда
		
		ПодобныйОтчетСуществует = Истина;
		
	КонецЕсли;
	
	СтруктураРеквизитовФормы.мЗаписываетсяНовыйДокумент = (СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено ИЛИ СтруктураРеквизитовФормы.мСкопированаФорма <> Неопределено);
	
	Если Вариант <> Неопределено И ((СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено) ИЛИ (СтруктураРеквизитовФормы.мСкопированаФорма <> Неопределено) ИЛИ (Вариант <> СтруктураРеквизитовФормы.мВариант)) Тогда
		
		Если СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено ИЛИ СтруктураРеквизитовФормы.мСкопированаФорма <> Неопределено Тогда
						
		ИначеЕсли Вариант <> СтруктураРеквизитовФормы.мВариант Тогда
			
			ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки = Истина;
								
		КонецЕсли;

	КонецЕсли;
	
	Если ПодобныйОтчетСуществует
	 ИЛИ ОткрытьФормуВопросаПриИзмененииВидаДокументаНомераКорректировки Тогда
	 
	 	Возврат Ложь;
		
 	КонецЕсли;
		
	Возврат Сохранить(Автосохранение, КодИФНС, Вариант, , ПоказателиОтчета);
		
КонецФункции

// Формирует структуру данных отчета и помещает в реквизит типа ХранилищеЗначения
// документа РегламентированныйОтчет.
// 
// При первом сохранении данных отчета создает новый документ этого вида.
// Структура данных отчета состоит из элементов:
//   - значения редактируемых реквизитов отчета;
//   - данные по многострочным разделам отчета;
//   - данные по  многостраничным разделам отчета;
//   - данные по вариантам заполнения реквизитов,
//     участвующих в автозаполнении.
//
&НаСервере
Функция Сохранить(Автосохранение = Ложь, КодИФНС = "не применимо", Вариант, ВидДокументаНомерКорректировкиИзменен = Неопределено, ПоказателиОтчета) Экспорт
	
	Если НЕ СтруктураРеквизитовФормы.мСохраненныйДок = Неопределено Тогда
		СтруктураРеквизитовФормы.мСохраненныйДок = СтруктураРеквизитовФормы.мСохраненныйДок.ПолучитьОбъект();
	КонецЕсли;
			
	Если НЕ РегламентированнаяОтчетность.ПриЗаписиРегламентированногоОтчетаНаСервере(ЭтаФорма, КодИФНС, Автосохранение, Вариант, ВидДокументаНомерКорректировкиИзменен, СтруктураРеквизитовФормы.мСохраненныйДок) Тогда
		СтруктураРеквизитовФормы.мСохраненныйДок = СтруктураРеквизитовФормы.мСохраненныйДок.Ссылка;
		Возврат Ложь;
	КонецЕсли;

	// установим текущие значения реквизитов документа
	СтруктураРеквизитовФормы.мСохраненныйДок.ИсточникОтчета           = Метаданные.Отчеты[Сред(Лев(ЭтаФорма.ИмяФормы, Найти(ЭтаФорма.ИмяФормы, ".Форма.") - 1), 7)].Имя;
	СтруктураРеквизитовФормы.мСохраненныйДок.НаименованиеОтчета       = Метаданные.Отчеты[Сред(Лев(ЭтаФорма.ИмяФормы, Найти(ЭтаФорма.ИмяФормы, ".Форма.") - 1), 7)].ОсновнаяФорма.Синоним;
	СтруктураРеквизитовФормы.мСохраненныйДок.ДатаНачала               = СтруктураРеквизитовФормы.мДатаНачалаПериодаОтчета;
	СтруктураРеквизитовФормы.мСохраненныйДок.ДатаОкончания            = СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета;
	СтруктураРеквизитовФормы.мСохраненныйДок.Периодичность            = СтруктураРеквизитовФормы.мПериодичность;
	СтруктураРеквизитовФормы.мСохраненныйДок.ВыбраннаяФорма           = СтруктураРеквизитовФормы.мВыбраннаяФорма;
	СтруктураРеквизитовФормы.мСохраненныйДок.Организация              = СтруктураРеквизитовФормы.Организация;
	СтруктураРеквизитовФормы.мСохраненныйДок.ДатаПодписи              = ДатаПодписи;	
	СтруктураРеквизитовФормы.мСохраненныйДок.ЕдиницаИзмерения         = Неопределено;	
	СтруктураРеквизитовФормы.мСохраненныйДок.ТочностьЕдиницыИзмерения = СтруктураРеквизитовФормы.ТочностьЕдиницыИзмерения;	
	СтруктураРеквизитовФормы.мСохраненныйДок.ВидОтчетности            = Перечисления.ВидыОтчетности.РегламентированнаяОтчетность;	
	СтруктураРеквизитовФормы.мСохраненныйДок.Вид                      = Вариант;	
	СтруктураРеквизитовФормы.мСохраненныйДок.ПредставлениеВида        = РегламентированнаяОтчетность.ПредставлениеВидаДокумента(СтруктураРеквизитовФормы.мСохраненныйДок.Вид);	
	СтруктураРеквизитовФормы.мСохраненныйДок.Комментарий              = Комментарий;
	
	СтруктураРеквизитовФормы.мВариант = Вариант;

	// формируем список сохранения
	СписокСохранения = Новый Структура();
	
	// вставляем данные редактируемых ячеек таблицы	
	СписокСохранения.Вставить("ПоказателиОтчета", ПоказателиОтчета);

	// вставляем данные многострочных разделов
	ДанныеМногострочныхРазделов = Новый Структура;
	
	//Для Каждого ЭлементСтруктуры Из мСтруктураМногострочныхРазделов Цикл
	//	
	//	ДанныеМногострочныхРазделов.Вставить(ЭлементСтруктуры.Ключ, ДанныеФормыВЗначение(ЭтаФорма[ЭлементСтруктуры.Значение], Тип("ТаблицаЗначений")));
	//	
	//КонецЦикла;
	
	СписокСохранения.Вставить("ДанныеМногострочныхРазделов", ДанныеМногострочныхРазделов);

	// вставляем данные вариантов автозаполнения ячеек
	СписокСохранения.Вставить("ДанныеВариантовАвтоЗаполнения", Неопределено);

	// вствляем версию формы
	СписокСохранения.Вставить("ВерсияФормы", СтруктураРеквизитовФормы.мВерсияФормы);

	ХранилищеДанных = Новый ХранилищеЗначения(СписокСохранения);
	СтруктураРеквизитовФормы.мСохраненныйДок.ДанныеОтчета = ХранилищеДанных;

	// записываем документ, хранящий данные отчета
	Попытка
		СтруктураРеквизитовФормы.мСохраненныйДок.Записать();
	Исключение
		
		Если НЕ Автосохранение Тогда
			
			Сообщение = Новый СообщениеПользователю;

			Сообщение.Текст = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='%1'"), РегламентированнаяОтчетностьКлиентСервер.СформироватьТекстСообщения(ОписаниеОшибки()));

			Сообщение.Сообщить();
				
		КонецЕсли;
		
		СтруктураРеквизитовФормы.мСохраненныйДок = СтруктураРеквизитовФормы.мСохраненныйДок.Ссылка;
		
		Возврат Ложь;
		
	КонецПопытки;
		
	Модифицированность   = Ложь;
	
	СтруктураРеквизитовФормы.мСохраненныйДок = СтруктураРеквизитовФормы.мСохраненныйДок.Ссылка;

	Возврат Истина;

КонецФункции

&НаКлиенте
Функция СобратьДанныеТекущегоТаблПоляНаКлиенте(ИмяТабличногоПоля) Экспорт
	
	Возврат РегламентированнаяОтчетностьКлиентСервер.СобратьДанныеТекущегоТаблПоля(ЭтаФорма, ИмяТабличногоПоля);
	
КонецФункции

&НаСервере
Функция СобратьДанныеТекущегоТаблПоляНаСервере(ИмяТабличногоПоля) Экспорт
	
	Возврат РегламентированнаяОтчетностьКлиентСервер.СобратьДанныеТекущегоТаблПоля(ЭтаФорма, ИмяТабличногоПоля);

КонецФункции

&НаСервере
Процедура ЗаполнитьПоказателиОтчетаНаСервере(ПоказателиОтчета)
	
	РегламентированнаяОтчетностьКлиентСервер.ЗаполнитьПоказателиОтчета(ЭтаФорма, ПоказателиОтчета);
	           	
КонецПроцедуры

&НаКлиенте
Процедура ЗаполнитьПоказателиОтчетаНаКлиенте(ПоказателиОтчета)
	
	РегламентированнаяОтчетностьКлиентСервер.ЗаполнитьПоказателиОтчета(ЭтаФорма, ПоказателиОтчета);
	
КонецПроцедуры

&НаКлиенте
Функция ОпределитьИдМногострочногоРазделаПоАктивнойСтраницеНаКлиенте(ИмяЛиста = Неопределено) Экспорт
	
	ИдГрупп = Новый Структура;
	
	Возврат ОпределитьИдМногострочногоРазделаПоАктивнойСтранице(ЭтаФорма, ИмяЛиста, ИмяЛиста, ИдГрупп);

КонецФункции

&НаСервере
Функция ОпределитьИдМногострочногоРазделаПоАктивнойСтраницеНаСервере(ИмяЛиста = Неопределено) Экспорт
	
	ИдГрупп = Новый Структура;
	
	Возврат ОпределитьИдМногострочногоРазделаПоАктивнойСтранице(ЭтаФорма, ИмяЛиста, ИмяЛиста, ИдГрупп);
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Функция ОпределитьИдМногострочногоРазделаПоАктивнойСтранице(Форма, ИмяЛиста = Неопределено, ТекущаяСтраница, ИдГрупп)
	
	Перем ИмяГруппы;

	Если ИмяЛиста = Неопределено Тогда
		ИмяТекущейСтраницыПанели = ТекущаяСтраница.Имя;
	Иначе
		ИмяТекущейСтраницыПанели = ИмяЛиста;
	КонецЕсли;

	Если ИмяТекущейСтраницыПанели = "ФормаОтчета" Тогда
		
		ИмяГруппы = РегламентированнаяОтчетностьКлиентСервер.РазделТекущейОбласти(Форма, Форма.Элементы.ПолеТабличногоДокументаФормаОтчета.ТекущаяОбласть);
		
	КонецЕсли;

	Возврат ИмяГруппы;
	
КонецФункции

&НаКлиентеНаСервереБезКонтекста
Процедура ОбновитьСтруктуруМногострочногоРаздела(Форма, ИмяГруппы) Экспорт
	
	Перем СтруктураГруппы;
	
	Форма.мСтруктураМногострочныхРазделов.Свойство(ИмяГруппы, СтруктураГруппы);
	
	СтруктураГруппы = Форма[СтруктураГруппы];
	
	ТекТабличноеПолеИмя = "ПолеТабличногоДокументаФормаОтчета";
	
	ТекТабличноеПоле = Форма[ТекТабличноеПолеИмя];
	
	Для НСтр = 1 По СтруктураГруппы.Количество() Цикл
		ТекСтрокаТаблицы = СтруктураГруппы[НСтр - 1];
		НСтрСтр = Формат(НСтр, "ЧГ=0");
		
		Для НомерГрафы = 1 По Форма.мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
			
			ИмяКолонки = ИмяГруппы + Формат(НомерГрафы, "ЧЦ=2; ЧВН=");
			
			Если СтруктураГруппы[0].Свойство(ИмяКолонки) Тогда
				
				ИмяЯчейки     = ИмяКолонки + "_" + НСтрСтр;
				ОбластьЯчейки = ТекТабличноеПоле.Области[ИмяЯчейки];
				
				Если ОбластьЯчейки.СодержитЗначение = Истина Тогда
					ЗначениеЯчейки = ОбластьЯчейки.Значение;
				Иначе
					ЗначениеЯчейки = ОбластьЯчейки.Текст;
				КонецЕсли;
				
				ТекСтрокаТаблицы[ИмяКолонки] = ЗначениеЯчейки;
				
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры

&НаСервере
Процедура ВывестиРазделВТабличныйДокументНаСервере(ИмяГруппы, СтруктураГруппы) Экспорт
	
	ВывестиРазделВТабличныйДокумент(ЭтаФорма, ИмяГруппы, СтруктураГруппы);
	
КонецПроцедуры

&НаКлиенте
Процедура ВывестиРазделВТабличныйДокументНаКлиенте(ИмяГруппы, СтруктураГруппы) Экспорт
	
	ВывестиРазделВТабличныйДокумент(ЭтаФорма, ИмяГруппы, СтруктураГруппы);
	
КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура ВывестиРазделВТабличныйДокумент(Форма, ИмяГруппы, СтруктураГруппы)
	
	Перем ИсходноеКоличествоСтрокГруппы;

	// Определим исходное колво строк многострочного раздела,
	// соответствующее бумажной форме отчета.
	Форма.мСтруктураИсхКолвоСтрокРазделов.Свойство(ИмяГруппы, ИсходноеКоличествоСтрокГруппы);

	// реальное кол-во строк (колво заполненных строк)
	ТекущееКоличествоСтрокГруппы = СтруктураГруппы.Количество();
	
	ТекТабличноеПолеИмя = "ПолеТабличногоДокументаФормаОтчета";
	
	ТекТабличноеПоле = Форма[ТекТабличноеПолеИмя];
			
	// При восстановлении сохраненных данных отчета сравниваем исходное кол-во
	// отображаемых в форме строк многострочного раздела с реальным количеством
	// созданных строк в сохраненном отчете.
	Если ТекущееКоличествоСтрокГруппы > ИсходноеКоличествоСтрокГруппы Тогда
						
		РегламентированнаяОтчетностьКлиентСервер.ДобавитьНеобходимоеКоличествоДопСтрок(Форма, ТекТабличноеПоле, ТекТабличноеПолеИмя, ИсходноеКоличествоСтрокГруппы, ТекущееКоличествоСтрокГруппы, ИмяГруппы, СтруктураГруппы);
		
		Форма[ТекТабличноеПолеИмя] = ТекТабличноеПоле;
		
	КонецЕсли;
	
	ТекТабличноеПоле = Форма[ТекТабличноеПолеИмя];

	// выводим значения строк
	Для Каждого СтрокаТаблицы Из СтруктураГруппы Цикл
		
		Для НомерГрафы = 1 По Форма.мСтруктураКолвоКолонокРазделов[ИмяГруппы] Цикл
			
			КолонкаТаблицыИмя = ИмяГруппы + Формат(НомерГрафы, "ЧЦ=2; ЧВН=");
			
			Если СтруктураГруппы[0].Свойство(КолонкаТаблицыИмя) Тогда
				
				НомерСтрокиВТаблице      = СтруктураГруппы.Индекс(СтрокаТаблицы);
				НомерСтрокиВФормеТаблицы = НомерСтрокиВТаблице + 1;
				ИмяЯчейки                = КолонкаТаблицыИмя + "_" + НомерСтрокиВФормеТаблицы;
				ОбластьЯчейкиТаблицы     = ТекТабличноеПоле.Области[ИмяЯчейки];
				ЗначениеЯчейки           = СтрокаТаблицы[КолонкаТаблицыИмя];
				
				Если ОбластьЯчейкиТаблицы.СодержитЗначение Тогда
					// задаем значение ячейки
					ОбластьЯчейкиТаблицы.Значение = ЗначениеЯчейки;
					
				Иначе
					ОбластьЯчейкиТаблицы.Текст    = ЗначениеЯчейки;
					
				КонецЕсли;
				
			КонецЕсли;
			
		КонецЦикла;
		
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	Если Найти(Заголовок, СтруктураРеквизитовФормы.СтрПериодОтчета) = 0 Тогда
		Заголовок = Заголовок + " за " + СтруктураРеквизитовФормы.СтрПериодОтчета;
	КонецЕсли;
	
	ОргСтр = " (" + СтруктураРеквизитовФормы.НаимОрганизации + ")";
	Если Найти(Заголовок, ОргСтр) = 0 Тогда
		Заголовок = Заголовок + ОргСтр;
	КонецЕсли;
	
	ПодключитьОбработчикОжидания("ВыполнитьПроверкуПередОткрытием", 0.1, Истина);

КонецПроцедуры

&НаКлиенте
Процедура ВыполнитьПроверкуПередОткрытием()
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПриОткрытииЗавершение", ЭтотОбъект);
	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередОткрытиемФормыРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытииЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Модифицированность = Ложь;
		Закрыть();
		Возврат;
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
// Обработчик события "ПередЗакрытием" формы.
//
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
	
	УПЖКХ_ТиповыеМетодыКлиент.ПередЗакрытиемРегламентированногоОтчета(ЭтаФорма, Отказ, СтандартнаяОбработка, ЗавершениеРаботы, ТекстПредупреждения);
	
КонецПроцедуры

&НаКлиенте
// Обработчик события "ПриЗакрытии" формы.
//
Процедура ПриЗакрытии(ЗавершениеРаботы)
	
	Если ЗавершениеРаботы Тогда
		Возврат;
	КонецЕсли;
	
	ПриЗакрытииНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ПриЗакрытииНаСервере()
	
	УПЖКХ_ТиповыеМетодыСервер.ПриЗакрытииРегламентированногоОтчета(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ПолеТабличногоДокументаФормаОтчетаВыбор(Элемент, Область, СтандартнаяОбработка)
	
	Если Область.Имя = "ОргАдрес" Тогда
		РегламентированнаяОтчетностьКлиент.ОбработкаАдресаВСтатистическомОтчете(ЭтаФорма, Область, СтандартнаяОбработка);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОткрытьФормуКонтактнойИнформацииЗавершение(Результат, Параметры) Экспорт
	
	РегламентированнаяОтчетностьКлиент.ОбновитьАдресВТабличномДокументеСтатистическойОтчетности(Результат, Параметры.Область, СтруктураРеквизитовФормы);
	Модифицированность = Истина;
	
КонецПроцедуры

&НаКлиенте
Процедура ПолеТабличногоДокументаФормаОтчетаПриИзмененииСодержимогоОбласти(Элемент, Область)
	
	Если Область.Имя = "ДатаСоставленияОтчета" Тогда 
		ДатаПодписи = Область.Значение;
		ЗаполнитьСведенияОбОрганизацииНаКлиенте(Истина);
		Модифицированность = Истина;
		Возврат;
	ИначеЕсли Область.Имя = "НомерКорректировки" Тогда 
		Если Область.Значение = 0 Тогда 
			СтруктураРеквизитовФормы.ВидДокумента = 0;
			НомерКорректировки = 0;
		Иначе 
			СтруктураРеквизитовФормы.ВидДокумента = 1;
			НомерКорректировки = Область.Значение;
		КонецЕсли;
		Модифицированность = Истина;
		Возврат;
	КонецЕсли;
	
	Если Область.СодержитЗначение И Область.ТипЗначения.СодержитТип(Тип("Число")) Тогда
		Если Область.Значение = 0 И Область.ТипЗначения.КвалификаторыЧисла.РазрядностьДробнойЧасти = 0 Тогда
			
			ФорматПредставленияНуля = РегламентированнаяОтчетностьКлиентСервер.ПолучитьПредставлениеНуляИзСтрокиФормата(Область.Формат);
			
			ОтображениеНуля = СокрЛП(Формат(0, РегламентированнаяОтчетностьКлиентСервер.ЗаменитьПредставлениеНуляВСтрокеФормата(Область.Формат, "ЧН=")));
			Если ПустаяСтрока(ОтображениеНуля) Тогда
				ОтображениеНуля = "0";
			КонецЕсли;
			ТипСтрокиЗаполнения = Новый ОписаниеТипов("Строка",, Новый КвалификаторыСтроки(СтрДлина(ОтображениеНуля), ДопустимаяДлина.Фиксированная));
			СтрокаЗаполнения = ТипСтрокиЗаполнения.ПривестиЗначение();
			
			Список = Новый СписокЗначений;
			Список.Добавить("ЧН=' '", "  <Пустое значение>    " + СтрокаЗаполнения);
			Список.Добавить("ЧН=" + ОтображениеНуля, "  Отображать как """ + ОтображениеНуля + """  ");
			
			НайденнаяСтрока = Список.НайтиПоЗначению(ФорматПредставленияНуля);
			
			ДополнительныеПараметры = Новый Структура("Область, Элемент", Область, Элемент); 
			ОписаниеОповещения = Новый ОписаниеОповещения("ПолеТабличногоДокументаФормаОтчетаПриИзмененииСодержимогоОбластиЗавершение", ЭтотОбъект, ДополнительныеПараметры);
						
			// Обход ошибок платформы: в тонком клиенте не работает ПоказатьВыборИзСписка (ПоказатьВыборИзМеню не работает в веб-клиенте 
			// и в событии ПриИзмененииСодержимогоОбласти табличного документа - где мы его и хотим использовать прежде всего).
			# Если ВебКлиент Тогда
			
				Если НайденнаяСтрока = Неопределено Тогда
					ПоказатьВыборИзСписка(ОписаниеОповещения, Список, Элемент);
				Иначе
					ПоказатьВыборИзСписка(ОписаниеОповещения, Список, Элемент, НайденнаяСтрока);
				КонецЕсли;
				
			#Иначе
				
				Список.ПоказатьВыборЭлемента(ОписаниеОповещения, "Выберите значение", Элемент);
					
			#КонецЕсли
			
			Возврат;
			
		КонецЕсли;
	КонецЕсли;
	
	Модифицированность = Истина;
	
	ОбластьИмя = Элемент.ТекущаяОбласть.Имя;

	РасчетНаКлиенте("", ОбластьИмя);
	
КонецПроцедуры

&НаКлиенте
Процедура ПолеТабличногоДокументаФормаОтчетаПриИзмененииСодержимогоОбластиЗавершение(СписокЭлемент, ДополнительныеПараметры) Экспорт
	
	Область = ДополнительныеПараметры.Область;
	Элемент = ДополнительныеПараметры.Элемент;
	
	Если СписокЭлемент <> Неопределено  Тогда
		
		Область.Формат = РегламентированнаяОтчетностьКлиентСервер.ЗаменитьПредставлениеНуляВСтрокеФормата(Область.Формат, СписокЭлемент.Значение);
		
	КонецЕсли;
	
	ОбластьИмя = Элемент.ТекущаяОбласть.Имя;
	
	РасчетНаКлиенте("", ОбластьИмя);
	
	Модифицированность = Истина;
	
КонецПроцедуры

&НаКлиенте
Процедура РасчетНаКлиенте(ИмяСтраницыПанели = "", ОбластьИмя = "") Экспорт	

	Расчет(ЭтаФорма, ИмяСтраницыПанели, ОбластьИмя);

КонецПроцедуры

&НаСервере
Процедура РасчетНаСервере(ИмяСтраницыПанели = "", ОбластьИмя = "") Экспорт

	Расчет(ЭтаФорма, ИмяСтраницыПанели, ОбластьИмя);

КонецПроцедуры

&НаКлиентеНаСервереБезКонтекста
Процедура Расчет(Форма, ИмяТекущейСтраницыПанели = "", ОбластьИмя = "")
	
	Области = Форма.ПолеТабличногоДокументаФормаОтчета.Области;
	
	// Раздел 1
	Области.ЖФ102.Значение = Области.ЖФ103.Значение + Области.ЖФ104.Значение;
	Области.ЖФ202.Значение = Области.ЖФ203.Значение + Области.ЖФ204.Значение;
	Области.ЖФ302.Значение = Области.ЖФ303.Значение + Области.ЖФ304.Значение;
	Области.ЖФ101.Значение = Области.ЖФ102.Значение + Области.ЖФ105.Значение + Области.ЖФ108.Значение + Области.ЖФ109.Значение;
	Области.ЖФ201.Значение = Области.ЖФ202.Значение + Области.ЖФ205.Значение + Области.ЖФ208.Значение + Области.ЖФ209.Значение;
	Области.ЖФ301.Значение = Области.ЖФ302.Значение + Области.ЖФ305.Значение + Области.ЖФ308.Значение + Области.ЖФ309.Значение;
		//Области.ЖФ111.Значение = Области.ЖФ112.Значение + Области.ЖФ113.Значение;
		//Области.ЖФ211.Значение = Области.ЖФ212.Значение + Области.ЖФ213.Значение;
		//Области.ЖФ311.Значение = Области.ЖФ312.Значение + Области.ЖФ313.Значение;
	
	// Раздел 2
	Области.ЖФ116.Значение = Области.ЖФ216.Значение + Области.ЖФ316.Значение + Области.ЖФ416.Значение + Области.ЖФ516.Значение;
	Области.ЖФ117.Значение = Области.ЖФ217.Значение + Области.ЖФ317.Значение + Области.ЖФ417.Значение + Области.ЖФ517.Значение;
	Области.ЖФ118.Значение = Области.ЖФ218.Значение + Области.ЖФ318.Значение + Области.ЖФ418.Значение + Области.ЖФ518.Значение;
	Области.ЖФ119.Значение = Области.ЖФ219.Значение + Области.ЖФ319.Значение + Области.ЖФ419.Значение + Области.ЖФ519.Значение;
	Области.ЖФ120.Значение = Области.ЖФ220.Значение + Области.ЖФ320.Значение + Области.ЖФ420.Значение + Области.ЖФ520.Значение;
	Области.ЖФ121.Значение = Области.ЖФ221.Значение + Области.ЖФ321.Значение + Области.ЖФ421.Значение + Области.ЖФ521.Значение;
	Области.ЖФ122.Значение = Области.ЖФ222.Значение + Области.ЖФ322.Значение + Области.ЖФ422.Значение + Области.ЖФ522.Значение;
	
	// Раздел 3
	//Если НЕ Области.ЖФ223.Значение = 0 И НЕ Области.ЖФ423.Значение = 0 И НЕ Области.ЖФ623.Значение = 0
	//   И НЕ Области.ЖФ823.Значение = 0 И (НЕ Области.ЖФ1123.Значение = 0 ИЛИ НЕ Области.ЖФ1223.Значение = 0) Тогда
	//	Области.ЖФ124.Значение = Области.ЖФ223.Значение + Области.ЖФ423.Значение + Области.ЖФ623.Значение + Области.ЖФ823.Значение
	//						   + ?(Не Области.ЖФ1223.Значение = 0, Области.ЖФ1223.Значение, Области.ЖФ1123.Значение);
	//Иначе
	//	Области.ЖФ124.Значение = 0;
	//КонецЕсли;
	Если Не Области.ЖФ129.Значение = 0 И Не Области.ЖФ130.Значение = 0 Тогда
		Области.ЖФ128.Значение = Области.ЖФ129.Значение + Области.ЖФ130.Значение;
	Иначе
		Области.ЖФ128.Значение = 0;
	КонецЕсли;
	
	// Раздел 6
	Области.ЖФ156.Значение = Области.ЖФ157.Значение + Области.ЖФ158.Значение + Области.ЖФ159.Значение;
	Области.ЖФ256.Значение = Области.ЖФ257.Значение + Области.ЖФ258.Значение + Области.ЖФ259.Значение;
	
	// Раздел 7
	Области.ЖФ165.Значение = Области.ЖФ166.Значение + Области.ЖФ167.Значение + Области.ЖФ168.Значение + Области.ЖФ169.Значение;
	Области.ЖФ170.Значение = Области.ЖФ171.Значение + Области.ЖФ173.Значение + Области.ЖФ174.Значение + Области.ЖФ175.Значение + Области.ЖФ176.Значение + Области.ЖФ177.Значение;
	Области.ЖФ178.Значение = Области.ЖФ164.Значение + Области.ЖФ165.Значение - Области.ЖФ170.Значение;

	
	// Гр. 5 = Сумма гр.: 6, 7, 8.
	//Для НомСтр = 1 По 4 Цикл
	//	ТекСумма = 0;
	//	Для НомКол = 6 По 8 Цикл
	//		ТекСумма = ТекСумма + мФормаОтчета.Области["П000001"
	//		+ Формат(НомСтр, "ЧЦ=4; ЧВН=; ЧГ=") + Формат(НомКол, "ЧЦ=2; ЧВН=; ЧГ=")].Значение;
	//	КонецЦикла;
	//	мФормаОтчета.Области["П000001" + Формат(НомСтр, "ЧЦ=4; ЧВН=; ЧГ=") + "05"].Значение = ТекСумма;
	//КонецЦикла;
	//
	//// Стр. 1 = Сумма стр.: 2, 3, 4.
	//Для НомКол = 3 По 8 Цикл
	//	ТекСумма = 0;
	//	Для НомСтр = 2 По 4 Цикл
	//		ТекСумма = ТекСумма + мФормаОтчета.Области["П000001"
	//		+ Формат(НомСтр, "ЧЦ=4; ЧВН=; ЧГ=") + Формат(НомКол, "ЧЦ=2; ЧВН=; ЧГ=")].Значение;
	//	КонецЦикла;
	//	мФормаОтчета.Области["П0000010001" + Формат(НомКол, "ЧЦ=2; ЧВН=; ЧГ=")].Значение = ТекСумма;
	//КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура Обновить(Команда)
	
	СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Истина;
	ЗаполнитьСведенияОбОрганизацииНаКлиенте();
	СтруктураРеквизитовФормы.мВПрограммеИзмененаОрганизация = Ложь;
	
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьОтчет(Команда)
	
	ТекстВопроса = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='Внимание! Будут очищены все показатели отчета.%1Продолжить операцию?'"), Символы.ПС);
	ОписаниеОповещения = Новый ОписаниеОповещения("ОчиститьОтчетЗавершение", ЭтотОбъект);
	ПоказатьВопрос(ОписаниеОповещения, ТекстВопроса, РежимДиалогаВопрос.ДаНет, , КодВозвратаДиалога.Нет);
	
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьОтчетЗавершение(Ответ, ДополнительныеПараметры) Экспорт
	
	Если Ответ = КодВозвратаДиалога.Нет Тогда        
		Возврат;       
	Иначе        
		Очистить();       
	КонецЕсли;
	
КонецПроцедуры // ОчиститьОтчет()

// Процедура очищает содержимое редактируемых и вычисляемых
// ячеек табличного документа.
//
&НаКлиенте
Процедура Очистить() Экспорт
		
	ОчиститьТабличноеПолеНаСервере();

	// устанавливаем флаг модифицированности формы
	Модифицированность = Истина;

КонецПроцедуры

&НаСервере
Процедура ОчиститьТабличноеПолеНаСервере()
	
	// Список ячеек, которые очищать не нужно
	Перем СписокПоказателейНеПодлежащихОчистке;

	ВыбТабличноеПоле = ПолеТабличногоДокументаФормаОтчета;
	
	СписокПоказателейНеПодлежащихОчистке = Новый СписокЗначений;
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["ОргНазв"].Значение,         "ОргНазв");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["ОргАдрес"].Значение,        "ОргАдрес");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["ОргКодОКТМО"].Значение,     "ОргКодОКТМО");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["Код1"].Значение,            "Код1");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["Код2"].Значение,            "Код2");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["Код3"].Значение,            "Код3");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["Код4"].Значение,            "Код4");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["ОргКодНазв"].Значение,      "ОргКодНазв");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["ОргКодЗнач"].Значение,      "ОргКодЗнач");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["ОргДолжностьИсп"].Значение, "ОргДолжностьИсп");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["ОргИсполнитель"].Значение,  "ОргИсполнитель");
	СписокПоказателейНеПодлежащихОчистке.Добавить(ВыбТабличноеПоле.Области["ОргТелефонИсп"].Значение,   "ОргТелефонИсп");

	ВыбТабличноеПоле.Очистить();
	ВыбТабличноеПоле.Вывести(Отчеты[Сред(Лев(ЭтаФорма.ИмяФормы, Найти(ЭтаФорма.ИмяФормы, ".Форма.") - 1), 7)].ПолучитьМакет("ФормаОтчета2013Годовая_ФормаОтчета"));
	
	ПолеТабличногоДокументаФормаОтчета = ВыбТабличноеПоле;
	
	Для каждого ЭлементСписка Из СписокПоказателейНеПодлежащихОчистке Цикл
	
		ВыбТабличноеПоле.Области[ЭлементСписка.Представление].Значение = ЭлементСписка.Значение;
	
	КонецЦикла;
	
КонецПроцедуры

&НаКлиенте
Процедура АктивизироватьЯчейку(Ячейка) Экспорт
	
	ИмяПоляТабличногоДокумента = "ПолеТабличногоДокументаФормаОтчета";
	
	НайденнаяОбласть = ЭтаФорма[ИмяПоляТабличногоДокумента].Области.Найти(Ячейка.ИмяЯчейки);
	
	Если НЕ НайденнаяОбласть = Неопределено Тогда
		
		Элементы[ИмяПоляТабличногоДокумента].ТекущаяОбласть = НайденнаяОбласть;
		
	ИначеЕсли Ячейка.СтрокаПП <> Неопределено И ЗначениеЗаполнено(Ячейка.СтрокаПП) Тогда
		
		НайденнаяОбласть = ЭтаФорма[ИмяПоляТабличногоДокумента].Области.Найти(Ячейка.ИмяЯчейки + Ячейка.СтрокаПП);
		
		Если НЕ НайденнаяОбласть = Неопределено Тогда
			
			Элементы[ИмяПоляТабличногоДокумента].ТекущаяОбласть = НайденнаяОбласть;
			
		Иначе
			
			НайденнаяОбласть = ЭтаФорма[ИмяПоляТабличногоДокумента].Области.Найти(Ячейка.ИмяЯчейки + "_" + Ячейка.СтрокаПП);
			
			Если НЕ НайденнаяОбласть = Неопределено Тогда
				
				Элементы[ИмяПоляТабличногоДокумента].ТекущаяОбласть = НайденнаяОбласть;
				
			КонецЕсли;
			
		КонецЕсли;
		
	Иначе
		
		НайденнаяОбласть = ЭтаФорма[ИмяПоляТабличногоДокумента].Области.Найти(Ячейка.ИмяЯчейки + "1");
		
		Если НЕ НайденнаяОбласть = Неопределено Тогда
			
			Элементы[ИмяПоляТабличногоДокумента].ТекущаяОбласть = НайденнаяОбласть;
			
		Иначе
			
			НайденнаяОбласть = ЭтаФорма[ИмяПоляТабличногоДокумента].Области.Найти(Ячейка.ИмяЯчейки + "_1");
			
			Если НЕ НайденнаяОбласть = Неопределено Тогда
				
				Элементы[ИмяПоляТабличногоДокумента].ТекущаяОбласть = НайденнаяОбласть;
				
			Иначе
				
				Элементы[ИмяПоляТабличногоДокумента].ТекущаяОбласть = ЭтаФорма[ИмяПоляТабличногоДокумента].Область(Ячейка.ИмяЯчейки);
				
			КонецЕсли;
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПечататьСразу(Команда)
	
	Отказ = Ложь;
	
	ДополнительныеПараметры = Новый Структура();
	ДополнительныеПараметры.Вставить("Команда", Команда);
	ОписаниеОповещения = Новый ОписаниеОповещения("ПечататьСразуЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередПечатьюРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ПечататьСразуЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;

	Команда = ДополнительныеПараметры.Команда;
		
	Если Команда <> Неопределено Тогда
		Печать(Команда.Имя);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ПоказатьБланк(Команда)
	
	Отказ = Ложь;
	
	ДополнительныеПараметры = Новый Структура();
	ДополнительныеПараметры.Вставить("Команда", Команда);
	ОписаниеОповещения = Новый ОписаниеОповещения("ПоказатьБланкЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередПечатьюРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ПоказатьБланкЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;

	Команда = ДополнительныеПараметры.Команда;
		
	Если Команда <> Неопределено Тогда
		Печать(Команда.Имя);
	КонецЕсли;
	
КонецПроцедуры

// Процедура управляет выводом отчета на печать.
//
// Параметры:
//  ВидПечати - строка, задающая способ печати:
//              "ПоказатьБланк" - непосредственный вывод на печать;
//              "ПечататьСразу" - с предварительным просмотром.
//
&НаКлиенте
Процедура Печать(ВидПечати, НеИзФормыОтчета = Ложь) Экспорт
    
	Состояние(СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(НСтр("ru='%1. Формируется печатная форма...'"), ЭтаФорма.Заголовок), , , БиблиотекаКартинок.Печать);
	
	Если НЕ ПечатьНаСервере(ВидПечати) Тогда
		Возврат;
	КонецЕсли;
	
	РегламентированнаяОтчетностьКлиент.ОткрытьФормуПредварительногоПросмотра(ЭтаФорма, ВидПечати, , СтруктураРеквизитовФормы.СписокПечатаемыхЛистов);
		
КонецПроцедуры

&НаСервере
Функция ПечатьНаСервере(ВидПечати)
	
	Если НЕ РегламентированнаяОтчетность.ПринтерДоступен() Тогда
		
		Сообщение = Новый СообщениеПользователю;

		Сообщение.Текст = НСтр("ru='Перед формированием печатных форм необходимо определить в системе принтер и задать его в качестве используемого по умолчанию!'");

		Сообщение.Сообщить();
		
		Возврат Ложь;
		
	КонецЕсли;
	
	ТабличныйДокумент = ЭтаФорма["ПолеТабличногоДокументаФормаОтчета"];
	
	СтруктураРеквизитовФормы.мПечатныеФормы.Очистить();
	
	ОбщиеРеквизитыРазделов = Новый Структура;
	
	СтруктураПараметров = Новый Структура;
	СтруктураПараметров.Вставить("НаименованиеЛиста",  "Форма 1 ""Сведения о жилищном фонде""");
	СтруктураПараметров.Вставить("ОриентацияЛиста",    "Ландшафт");
	СтруктураПараметров.Вставить("ИмяСтраницы",        "Форма 1 ""Сведения о жилищном фонде""");
	Структурапараметров.Вставить("ИмяОбластиТаблПоля", "ПолеТабличногоДокументаФормаОтчета");
	СтруктураПараметров.Вставить("ВидПечати",          ВидПечати);
	
	РегламентированнаяОтчетность.ВывестиНаПечатьЛистОбщая(ЭтаФорма.Заголовок, СтруктураПараметров, ТабличныйДокумент, СтруктураРеквизитовФормы.мПечатныеФормы);
	РегламентированнаяОтчетность.УдалитьНомерКорректировки(СтруктураРеквизитовФормы.мПечатныеФормы[0].Значение);
	РегламентированнаяОтчетностьКлиентСервер.ПроставлениеНомеровЛистов(ЭтаФорма, , СтруктураРеквизитовФормы.СписокПечатаемыхЛистов);
	
	Возврат Истина;
	
КонецФункции

&НаКлиенте
Процедура ВыгрузитьЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыгрузитьИзФормыПослеСохраненияЗавершение", ЭтотОбъект);
	Если Модифицированность Тогда
		СохранитьНаКлиенте(, ОписаниеОповещения);
	Иначе
		ВыполнитьОбработкуОповещения(ОписаниеОповещения);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьИзФормыЗавершение(РезультатВопроса, ДополнительныеПараметры) Экспорт
	
	Если РезультатВопроса = КодВозвратаДиалога.Да Тогда
		ВыгрузитьОтчет(Истина);
	Иначе
		СпДокОсн = Новый СписокЗначений;
		СпДокОсн.Добавить(СтруктураРеквизитовФормы.мСохраненныйДок);
		ОшибкиОтчета = Новый Массив;
		РегламентированнаяОтчетностьКлиент.ПроверитьРегламентированныеОтчеты(СпДокОсн, ОшибкиОтчета);
		РегламентированнаяОтчетностьКлиент.ОткрытьФормуНавигацииПоОшибкамВыгрузки(ОшибкиОтчета);
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура ПроверитьВыгрузку(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПроверитьВыгрузкуЗавершение", ЭтотОбъект);

	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередВыгрузкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
		
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьВыгрузкуЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	ПроверитьВыгрузкуОтчета();
	
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьВыгрузкуОтчета()
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПроверитьВыгрузкуОтчетаЗавершение", ЭтотОбъект);
	
	Если НЕ ЗначениеЗаполнено(СтруктураРеквизитовФормы.Организация) Тогда
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = НСтр("ru='Организация не выбрана! Выгрузка невозможна.'");
		Сообщение.Сообщить();
		Возврат;
		
	КонецЕсли;
	
	Если Модифицированность Тогда
		СохранитьНаКлиенте(,ОписаниеОповещения);
	Иначе
		ВыполнитьОбработкуОповещения(ОписаниеОповещения);
	КонецЕсли;
	
КонецПроцедуры 

&НаКлиенте
Процедура ПроверитьВыгрузкуОтчетаЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	ФормаВыгрузкиРеглОтчета = ПолучитьФорму("Документ.ВыгрузкаРегламентированныхОтчетов.Форма.ФормаДокумента", , ЭтаФорма);
	
	СпДокОсн = Новый СписокЗначений;
	СпДокОсн.Добавить(СтруктураРеквизитовФормы.мСохраненныйДок);
	
	ФормаВыгрузкиРеглОтчета.Проверить(СпДокОсн);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьОтчет(ВыгружатьСОшибками = Ложь) Экспорт
	
	ДополнительныеПараметры = Новый Структура("ВыгружатьСОшибками", ВыгружатьСОшибками);
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыгрузитьОтчетЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	
	Если Модифицированность Тогда
		СохранитьНаКлиенте(, ОписаниеОповещения);
	Иначе
		ВыполнитьОбработкуОповещения(ОписаниеОповещения);
	КонецЕсли;
	
КонецПроцедуры 

&НаКлиенте
Процедура ВыгрузитьОтчетЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	ФормаВыгрузкиРеглОтчета = ПолучитьФорму("Документ.ВыгрузкаРегламентированныхОтчетов.Форма.ФормаДокумента", , ЭтаФорма);
	
	СпДокОсн = Новый СписокЗначений;
	СпДокОсн.Добавить(СтруктураРеквизитовФормы.мСохраненныйДок);
	
	ФормаВыгрузкиРеглОтчета.СформироватьИЗаписать(СпДокОсн,,,,,,,,,ДополнительныеПараметры.ВыгружатьСОшибками);
	
КонецПроцедуры

&НаСервере
Функция ТекущийФорматВыгрузки(Организация)
	
	Возврат РегламентированнаяОтчетность.ФорматВыгрузкиСтатистическойОтчетностиВЭлектронномВиде(Организация);
	
КонецФункции

&НаКлиенте
Функция УниверсальнаяВыгрузка(ТекстВыгрузки = Неопределено, ПроверятьБлокировки = Истина, ИмяФайлаВыгрузки = "", ВыгружатьСОшибками = Ложь) Экспорт
	
	Перем ПараметрыВыгрузки;
	
	Если ТекущийФорматВыгрузки(СтруктураРеквизитовФормы.Организация) = Неопределено Тогда
		РегламентированнаяОтчетностьКлиент.ПоказатьФормуНастроекФорматаВыгрузкиСтатистическойОтчетностиВЭлектронномВиде(
			СтруктураРеквизитовФормы.Организация, Ложь, Истина);
			
		Возврат "НеВыбранФормат";
	КонецЕсли;
	
	Если Модифицированность Тогда
		
		Если Найти(Заголовок, СтруктураРеквизитовФормы.СтрПериодОтчета) = 0 Тогда
			ТекстЗаголовка = Заголовок + " за " + СтруктураРеквизитовФормы.СтрПериодОтчета;
		Иначе
			ТекстЗаголовка = Заголовок;
		КонецЕсли;
		
		ОргСтр = " (" + СтруктураРеквизитовФормы.НаимОрганизации + ")";
		Если Найти(Заголовок, ОргСтр) = 0 Тогда
			ТекстЗаголовка = ТекстЗаголовка + ОргСтр;
		КонецЕсли;
		
		Сообщение = Новый СообщениеПользователю;
		Сообщение.Текст = "Отчет """ + ТекстЗаголовка + """ не сохранен.";
		Сообщение.Сообщить();
		
		Возврат Ложь;
		
	КонецЕсли;
	
	ИмяФайлаВыгрузки = ПараметрыВыгрузки.ИмяФайла;
	
	Возврат Истина;
	
КонецФункции

#КонецОбласти 

////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ СТЫКОВКИ С СЕРВИСОМ СДАЧИ ОТЧЕТНОСТИ ЧЕРЕЗ ПРЕДСТАВИТЕЛЯ

#Область ПроцедурыИФункцииСтыковкиССервисомСдачиОтчетностиЧерезПредставителя

&НаКлиенте
Процедура ОтправитьЧерезПредставителя(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ОтправитьЧерезПредставителяЗавершение", ЭтотОбъект);

	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередВыгрузкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьЧерезПредставителяЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	РегламентированнаяОтчетностьКлиент.ПриНажатииНаКнопкуОтправкиЧерезПредставителяВРегламентированномОтчете(ЭтаФорма, "ФСГС");
	
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьВИнтернете(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПроверитьВИнтернетеЗавершение", ЭтотОбъект);

	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередВыгрузкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
		
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьВИнтернетеЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	РегламентированнаяОтчетностьКлиент.ПроверитьВИнтернете(ЭтаФорма, "ФСГС");
	
КонецПроцедуры

#КонецОбласти 

#Область ПанельОтправкиВКонтролирующиеОрганы

&НаКлиенте
Процедура ОбновитьОтправку(Команда)
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОбновитьОтправкуИзПанелиОтправки(ЭтаФорма, "ФСГС");
КонецПроцедуры

&НаКлиенте
Процедура ГиперссылкаПротоколНажатие(Элемент)
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОткрытьПротоколИзПанелиОтправки(ЭтаФорма, "ФСГС");
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьНеотправленноеИзвещение(Команда)
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОтправитьНеотправленноеИзвещениеИзПанелиОтправки(ЭтаФорма, "ФСГС");
КонецПроцедуры

&НаКлиенте
Процедура ЭтапыОтправкиНажатие(Элемент)
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОткрытьСостояниеОтправкиИзПанелиОтправки(ЭтаФорма, "ФСГС");
КонецПроцедуры

&НаКлиенте
Процедура КритическиеОшибкиОбработкаНавигационнойСсылки(Элемент, НавигационнаяСсылка, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ЭлектронныйДокументооборотСКонтролирующимиОрганамиКлиент.ОткрытьКритическиеОшибкиИзПанелиОтправки(ЭтаФорма, "ФСГС");
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьВКонтролирующийОрган(Команда)
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ПроверкаВозможностиВыгрузкиРегламентированногоОтчетаПередОтправкой", ЭтотОбъект);
	Отказ = Ложь;
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередОтправкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ПроверкаВозможностиВыгрузкиРегламентированногоОтчетаПередОтправкой(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ОтправитьВКонтролирующийОрганЗавершение", ЭтотОбъект);
	ОнлайнСервисыРегламентированнойОтчетностиКлиент.ПередВыгрузкойРегламентированногоОтчета(ОписаниеОповещения, ЭтотОбъект, Отказ);
	
КонецПроцедуры

&НаКлиенте
Процедура ОтправитьВКонтролирующийОрганЗавершение(Отказ, ДополнительныеПараметры) Экспорт
	
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	РегламентированнаяОтчетностьКлиент.ПриНажатииНаКнопкуОтправкиВКонтролирующийОрган(ЭтаФорма, "ФСГС");
	
КонецПроцедуры

&НаКлиенте
Процедура ЗаписатьИЗакрыть(Команда)
	ДополнительныеПараметры = Новый Структура;
	ДополнительныеПараметры.Вставить("Форма", ЭтаФорма);
	Оповещение = Новый ОписаниеОповещения("ПослеСохраненияФормыЗавершение", ЭтотОбъект, ДополнительныеПараметры);
	СохранитьНаКлиенте(, Оповещение);
КонецПроцедуры

&НаКлиенте
Процедура ПослеСохраненияФормыЗавершение(Результат, ДополнительныеПараметры) Экспорт
	ДополнительныеПараметры.Форма.Закрыть();
КонецПроцедуры

#КонецОбласти 

#Область ПроцедурыПодсистемыКвартплаты

// Процедуры заполнения

&НаКлиенте
Процедура Заполнить(Команда)
	
	ЗаполнитьАвто();
	РасчетНаКлиенте();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ФУНКЦИИ АВТОЗАПОЛНЕНИЯ

&НаСервере
// Процедура производит автозаполнение формы регламентированного отчета.
//
Процедура ЗаполнитьАвто()
	
	Перем СписокМатериаловСтен;
	
	// Очищаем поле вывода отчета.
	ПолеТабличногоДокументаФормаОтчета.Очистить();
	
	ПолеТабличногоДокументаФормаОтчета.Вывести(Отчеты[Сред(Лев(ЭтаФорма.ИмяФормы, Найти(ЭтаФорма.ИмяФормы, ".Форма.") - 1), 7)].ПолучитьМакет("ФормаОтчета2013Годовая_ФормаОтчета"));
	
	Инициализация(Истина);
	
	НастройкиУказаны = Ложь;
	
	НастройкиУчетнойПолитикиТСЖОтказ = Ложь;
	
	НастройкиУчетнойПолитикиТСЖ = УПЖКХ_ОбщегоНазначенияСервер.ПолучитьПараметрыУчетнойПолитикиЖКХ(СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета, СтруктураРеквизитовФормы.Организация, НастройкиУчетнойПолитикиТСЖОтказ);
	
	Если НастройкиУчетнойПолитикиТСЖОтказ Тогда
		Возврат;
	КонецЕсли;
	
	ТабДокумент = ПолеТабличногоДокументаФормаОтчета;
	
	ПолучитьСписокМатериаловСтен(СписокМатериаловСтен);
	
	СписокВидовЖилыхПомещений = Новый СписокЗначений;
	СписокВидовЖилыхПомещений.ЗагрузитьЗначения(Справочники.УПЖКХ_ВидыПомещений.ПолучитьСписокВидовПомещений(Истина));
	
	ТаблицаЖилыхПомещений = ПолучитьТаблицуЖилыхПомещений(СписокВидовЖилыхПомещений);
	Если ТаблицаЖилыхПомещений.Количество() = 0 Тогда
		УПЖКХ_ТиповыеМетодыКлиентСервер.СообщитьПользователю("Отсутствуют данные для заполнения отчета.");
		Возврат;
	КонецЕсли;
	
	ЗаполнитьРаздел1(ТабДокумент, ТаблицаЖилыхПомещений);
	ЗаполнитьРаздел2(ТабДокумент, ТаблицаЖилыхПомещений);
	ЗаполнитьРаздел3(ТабДокумент, ТаблицаЖилыхПомещений);
	ЗаполнитьРаздел4(ТабДокумент, СписокМатериаловСтен, ТаблицаЖилыхПомещений);
	ЗаполнитьРаздел5(ТабДокумент, СписокМатериаловСтен, ТаблицаЖилыхПомещений);
	
КонецПроцедуры // ЗаполнитьАвто()

&НаСервере
// Возвращает таблицу жилых помещений в базе.
Функция ПолучитьТаблицуЖилыхПомещений(СписокВидовЖилыхПомещений)
	
	Запрос = Новый Запрос;
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	УПЖКХ_Помещения.Ссылка КАК Квартира,
	|	УПЖКХ_Помещения.КоличествоКомнат,
	|	УПЖКХ_Помещения.Владелец КАК Здание,
	|	УПЖКХ_Помещения.Родитель
	|ПОМЕСТИТЬ врЖилыеПомещения
	|ИЗ
	|	Справочник.УПЖКХ_Помещения КАК УПЖКХ_Помещения
	|ГДЕ
	|	НЕ УПЖКХ_Помещения.ПометкаУдаления
	|	И УПЖКХ_Помещения.ВидПомещения В(&ВидыЖилыхПомещений)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Здание
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	КВП_Здания.Ссылка КАК Здание,
	|	КВП_Здания.Многоквартирное,
	|	КВП_Здания.ГодПостройки,
	|	КВП_Здания.ПроцентИзноса,
	|	КВП_Здания.МатериалСтен
	|ПОМЕСТИТЬ втЗдания
	|ИЗ
	|	Справочник.КВП_Здания КАК КВП_Здания
	|ГДЕ
	|	КВП_Здания.Ссылка В
	|			(ВЫБРАТЬ
	|				врЖилыеПомещения.Здание
	|			ИЗ
	|				врЖилыеПомещения КАК врЖилыеПомещения)
	|	И НЕ КВП_Здания.ПометкаУдаления
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Здание
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втЗдания.Здание,
	|	втЗдания.Многоквартирное КАК ЗданиеМногоквартирное,
	|	втЗдания.ГодПостройки КАК ЗданиеГодПостройки,
	|	втЗдания.ПроцентИзноса КАК ЗданиеПроцентИзноса,
	|	втЗдания.МатериалСтен КАК ЗданиеМатериалСтен,
	|	врЖилыеПомещения.Квартира КАК Квартира,
	|	врЖилыеПомещения.КоличествоКомнат,
	|	врЖилыеПомещения.Родитель
	|ПОМЕСТИТЬ врЖилыеПомещенияПодробно
	|ИЗ
	|	врЖилыеПомещения КАК врЖилыеПомещения
	|		ЛЕВОЕ СОЕДИНЕНИЕ втЗдания КАК втЗдания
	|		ПО врЖилыеПомещения.Здание = втЗдания.Здание
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Квартира
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ врЖилыеПомещения
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ втЗдания
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	КВП_ПлощадьПомещенияСрезПоследних.Объект КАК Помещение,
	|	ЕСТЬNULL(КВП_ПлощадьПомещенияСрезПоследних.Площадь, 0) КАК ОбщаяПлощадь
	|ПОМЕСТИТЬ втПлощадиПомещений
	|ИЗ
	|	РегистрСведений.КВП_ПлощадьПомещения.СрезПоследних(
	|			&ДатаКон,
	|			Объект В
	|					(ВЫБРАТЬ
	|						врЖилыеПомещенияПодробно.Квартира
	|					ИЗ
	|						врЖилыеПомещенияПодробно КАК врЖилыеПомещенияПодробно)
	|				И ВидПлощади = ЗНАЧЕНИЕ(Справочник.УПЖКХ_ВидыПлощадей.ОбщаяПлощадь)) КАК КВП_ПлощадьПомещенияСрезПоследних
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Помещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	врЖилыеПомещенияПодробно.Квартира,
	|	врЖилыеПомещенияПодробно.КоличествоКомнат,
	|	врЖилыеПомещенияПодробно.Здание,
	|	врЖилыеПомещенияПодробно.ЗданиеМногоквартирное,
	|	врЖилыеПомещенияПодробно.Родитель,
	|	врЖилыеПомещенияПодробно.ЗданиеГодПостройки,
	|	врЖилыеПомещенияПодробно.ЗданиеПроцентИзноса,
	|	врЖилыеПомещенияПодробно.ЗданиеМатериалСтен,
	|	ЕСТЬNULL(втПлощадиПомещений.ОбщаяПлощадь, 0) КАК ОбщаяПлощадь
	|ИЗ
	|	врЖилыеПомещенияПодробно КАК врЖилыеПомещенияПодробно
	|		ЛЕВОЕ СОЕДИНЕНИЕ втПлощадиПомещений КАК втПлощадиПомещений
	|		ПО врЖилыеПомещенияПодробно.Квартира = втПлощадиПомещений.Помещение";
	Запрос.УстановитьПараметр("ДатаКон",            СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета);
	Запрос.УстановитьПараметр("ВидыЖилыхПомещений", СписокВидовЖилыхПомещений);
	
	Возврат Запрос.Выполнить().Выгрузить();
	
КонецФункции // ПолучитьТаблицуЖилыхПомещений()

&НаСервере
// Формирует список материалов стен зданий.
Процедура ПолучитьСписокМатериаловСтен(СписокМатериаловСтен)
	
	МатериалСтенКаменные   = Справочники.КВП_МатериалСтен.НайтиПоНаименованию("Каменные", Истина);
	МатериалСтенПанельные  = Справочники.КВП_МатериалСтен.НайтиПоНаименованию("Панельные", Истина);
	МатериалСтенМонолитные = Справочники.КВП_МатериалСтен.НайтиПоНаименованию("Монолитные", Истина);
	СписокМатериаловСтен   = Новый СписокЗначений;
	// Не менять порядок добавления элементов в список!!!
	СписокМатериаловСтен.Добавить(МатериалСтенКаменные);
	СписокМатериаловСтен.Добавить(Справочники.КВП_МатериалСтен.Кирпичные);
	СписокМатериаловСтен.Добавить(МатериалСтенПанельные);
	СписокМатериаловСтен.Добавить(Справочники.КВП_МатериалСтен.Блочные);
	СписокМатериаловСтен.Добавить(МатериалСтенМонолитные);
	СписокМатериаловСтен.Добавить(Справочники.КВП_МатериалСтен.Смешанные);
	СписокМатериаловСтен.Добавить(Справочники.КВП_МатериалСтен.Деревянные);
	
КонецПроцедуры // ПолучитьСписокМатериаловСтен()

&НаСервере
// Процедура заполняет раздел 1.
Процедура ЗаполнитьРаздел1(ТабДокумент, ТаблицаЖилыхПомещений)
	
	МенеджерВременныхТаблиц        = Новый МенеджерВременныхТаблиц;
	Запрос                         = Новый Запрос;
	
	МассивВидовКонтактнойИнформации = Новый Массив;
	МассивВидовКонтактнойИнформации.Добавить(Справочники.ВидыКонтактнойИнформации.УПЖКХ_ПочтовыйАдресЗдания);
	
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	
	Запрос.УстановитьПараметр("ВидыЖилыхПомещений",    СписокВидовЖилыхПомещений);
	Запрос.УстановитьПараметр("ДатаКон",               СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета);
	Запрос.УстановитьПараметр("ТаблицаЖилыхПомещений", ТаблицаЖилыхПомещений);
	
	Запрос.Текст =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ТаблицаЖилыхПомещений.Квартира КАК Помещение,
	|	ТаблицаЖилыхПомещений.Здание,
	|	ТаблицаЖилыхПомещений.ЗданиеМногоквартирное,
	|	ТаблицаЖилыхПомещений.ОбщаяПлощадь
	|ПОМЕСТИТЬ врТаблицаЖилыхПомещений
	|ИЗ
	|	&ТаблицаЖилыхПомещений КАК ТаблицаЖилыхПомещений
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	врТаблицаЖилыхПомещений.Помещение,
	|	врТаблицаЖилыхПомещений.Здание,
	|	врТаблицаЖилыхПомещений.ЗданиеМногоквартирное,
	|	врТаблицаЖилыхПомещений.ОбщаяПлощадь,
	|	ЕСТЬNULL(КВП_СостояниеПомещения.Состояние, ЗНАЧЕНИЕ(Перечисление.КВП_СостоянияПомещения.ПустаяСсылка)) КАК СостояниеКвартиры,
	|	ЕСТЬNULL(КВП_СостояниеПомещения.КатегорияКвартиры, ЗНАЧЕНИЕ(Перечисление.КВП_КатегорииКвартир.ПустаяСсылка)) КАК КатегорияКвартиры
	|ПОМЕСТИТЬ втПомещения
	|ИЗ
	|	врТаблицаЖилыхПомещений КАК врТаблицаЖилыхПомещений
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КВП_СостояниеПомещения КАК КВП_СостояниеПомещения
	|		ПО врТаблицаЖилыхПомещений.Помещение = КВП_СостояниеПомещения.Объект
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	УПЖКХ_СобственностьНаПомещенияСрезПоследних.Помещение,
	|	ЕСТЬNULL(УПЖКХ_СобственностьНаПомещенияСрезПоследних.ВидСобственности, ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.ПустаяСсылка)) КАК ВидСобственности
	|ПОМЕСТИТЬ втВидыСобственностиПомещений
	|ИЗ
	|	РегистрСведений.УПЖКХ_СобственностьНаПомещения.СрезПоследних(
	|			&ДатаКон,
	|			Помещение В
	|				(ВЫБРАТЬ
	|					втПомещения.Помещение
	|				ИЗ
	|					втПомещения КАК втПомещения)) КАК УПЖКХ_СобственностьНаПомещенияСрезПоследних
	|ГДЕ
	|	УПЖКХ_СобственностьНаПомещенияСрезПоследних.Действует
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втПомещения.Помещение,
	|	втПомещения.Здание,
	|	втПомещения.СостояниеКвартиры,
	|	втПомещения.КатегорияКвартиры,
	|	втПомещения.ЗданиеМногоквартирное,
	|	втПомещения.ОбщаяПлощадь,
	|	ЕСТЬNULL(втВидыСобственностиПомещений.ВидСобственности, ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.ПустаяСсылка)) КАК ВидСобственности
	|ПОМЕСТИТЬ втИтоговаяВидыСобственностиПомещений
	|ИЗ
	|	втПомещения КАК втПомещения
	|		ЛЕВОЕ СОЕДИНЕНИЕ втВидыСобственностиПомещений КАК втВидыСобственностиПомещений
	|		ПО втПомещения.Помещение = втВидыСобственностиПомещений.Помещение
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	УПЖКХ_СобственникиПомещенийСрезПоследних.Помещение КАК Помещение,
	|	УПЖКХ_СобственникиПомещенийСрезПоследних.Собственник КАК Собственник,
	|	УПЖКХ_СобственникиПомещенийСрезПоследних.ДоляСобственникаЧислитель,
	|	УПЖКХ_СобственникиПомещенийСрезПоследних.ДоляСобственникаЗнаменатель,
	|	ВЫБОР
	|		КОГДА НЕ УПЖКХ_СобственникиПомещенийСрезПоследних.Собственник ЕСТЬ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА УПЖКХ_СобственникиПомещенийСрезПоследних.Собственник ССЫЛКА Справочник.ФизическиеЛица
	|						ТОГДА ИСТИНА
	|					КОГДА УПЖКХ_СобственникиПомещенийСрезПоследних.Собственник ССЫЛКА Справочник.Контрагенты
	|							И УПЖКХ_СобственникиПомещенийСрезПоследних.Собственник.ЮридическоеФизическоеЛицо = ЗНАЧЕНИЕ(Перечисление.ЮридическоеФизическоеЛицо.ФизическоеЛицо)
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ ЛОЖЬ
	|				КОНЕЦ
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СобственностьГраждан,
	|	ВЫБОР
	|		КОГДА НЕ УПЖКХ_СобственникиПомещенийСрезПоследних.Собственник ЕСТЬ NULL 
	|			ТОГДА ВЫБОР
	|					КОГДА УПЖКХ_СобственникиПомещенийСрезПоследних.Собственник ССЫЛКА Справочник.Контрагенты
	|							И УПЖКХ_СобственникиПомещенийСрезПоследних.Собственник.ЮридическоеФизическоеЛицо = ЗНАЧЕНИЕ(Перечисление.ЮридическоеФизическоеЛицо.ЮридическоеЛицо)
	|						ТОГДА ИСТИНА
	|					ИНАЧЕ ЛОЖЬ
	|				КОНЕЦ
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СобственностьЮрЛиц
	|ПОМЕСТИТЬ втСобственникиПомещений
	|ИЗ
	|	РегистрСведений.УПЖКХ_СобственникиПомещений.СрезПоследних(
	|			&ДатаКон,
	|			Помещение В
	|				(ВЫБРАТЬ
	|					втИтоговаяВидыСобственностиПомещений.Помещение
	|				ИЗ
	|					втИтоговаяВидыСобственностиПомещений КАК втИтоговаяВидыСобственностиПомещений)) КАК УПЖКХ_СобственникиПомещенийСрезПоследних
	|ГДЕ
	|	УПЖКХ_СобственникиПомещенийСрезПоследних.Действует
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втИтоговаяВидыСобственностиПомещений.Помещение,
	|	втИтоговаяВидыСобственностиПомещений.Здание,
	|	втИтоговаяВидыСобственностиПомещений.СостояниеКвартиры,
	|	втИтоговаяВидыСобственностиПомещений.КатегорияКвартиры,
	|	втИтоговаяВидыСобственностиПомещений.ЗданиеМногоквартирное,
	|	втИтоговаяВидыСобственностиПомещений.ВидСобственности,
	|	втСобственникиПомещений.СобственностьГраждан,
	|	втСобственникиПомещений.СобственностьЮрЛиц,
	|	СУММА(ВЫБОР
	|			КОГДА НЕ ЕСТЬNULL(втСобственникиПомещений.ДоляСобственникаЧислитель, 0) = 0
	|					И НЕ ЕСТЬNULL(втСобственникиПомещений.ДоляСобственникаЗнаменатель, 0) = 0
	|				ТОГДА втИтоговаяВидыСобственностиПомещений.ОбщаяПлощадь * втСобственникиПомещений.ДоляСобственникаЧислитель / втСобственникиПомещений.ДоляСобственникаЗнаменатель
	|			ИНАЧЕ втИтоговаяВидыСобственностиПомещений.ОбщаяПлощадь
	|		КОНЕЦ) КАК ОбщаяПлощадь
	|ПОМЕСТИТЬ втИтоговаяПоСобственникамПомещений
	|ИЗ
	|	втИтоговаяВидыСобственностиПомещений КАК втИтоговаяВидыСобственностиПомещений
	|		ЛЕВОЕ СОЕДИНЕНИЕ втСобственникиПомещений КАК втСобственникиПомещений
	|		ПО втИтоговаяВидыСобственностиПомещений.Помещение = втСобственникиПомещений.Помещение
	|
	|СГРУППИРОВАТЬ ПО
	|	втИтоговаяВидыСобственностиПомещений.Здание,
	|	втИтоговаяВидыСобственностиПомещений.Помещение,
	|	втИтоговаяВидыСобственностиПомещений.ЗданиеМногоквартирное,
	|	втИтоговаяВидыСобственностиПомещений.СостояниеКвартиры,
	|	втИтоговаяВидыСобственностиПомещений.ВидСобственности,
	|	втИтоговаяВидыСобственностиПомещений.КатегорияКвартиры,
	|	втСобственникиПомещений.СобственностьГраждан,
	|	втСобственникиПомещений.СобственностьЮрЛиц";
	Запрос.Выполнить();
	
	ЗапросПоЗданиям = Новый Запрос;
	ЗапросПоЗданиям.МенеджерВременныхТаблиц = Запрос.МенеджерВременныхТаблиц;
	ЗапросПоЗданиям.Текст = 
	"ВЫБРАТЬ
	|	втИтоговаяПоСобственникамПомещений.Здание КАК Объект
	|ИЗ
	|	втИтоговаяПоСобственникамПомещений КАК втИтоговаяПоСобственникамПомещений
	|
	|СГРУППИРОВАТЬ ПО
	|	втИтоговаяПоСобственникамПомещений.Здание";
	
	МассивОбъектов = ЗапросПоЗданиям.Выполнить().Выгрузить().ВыгрузитьКолонку("Объект");
	
	// Помещает в менеджер временных таблиц запроса таблицу контактной информации "втКонтактнаяИнформация".
	УПЖКХ_ТиповыеМетодыСервер.СформироватьТаблицуКонтактнойИнформацииОбъектов(Запрос.МенеджерВременныхТаблиц, МассивВидовКонтактнойИнформации, МассивОбъектов);
	
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	втКонтактнаяИнформация.Объект КАК Здание,
	|	втКонтактнаяИнформация.Регион,
	|	втКонтактнаяИнформация.Город
	|ПОМЕСТИТЬ втАдресаПоРегионуИГороду
	|ИЗ
	|	втКонтактнаяИнформация КАК втКонтактнаяИнформация
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	втИтоговаяПоСобственникамПомещений.Помещение,
	|	втИтоговаяПоСобственникамПомещений.Здание,
	|	втИтоговаяПоСобственникамПомещений.СостояниеКвартиры,
	|	втИтоговаяПоСобственникамПомещений.КатегорияКвартиры,
	|	втИтоговаяПоСобственникамПомещений.ЗданиеМногоквартирное,
	|	втИтоговаяПоСобственникамПомещений.ОбщаяПлощадь,
	|	втИтоговаяПоСобственникамПомещений.ВидСобственности,
	|	втИтоговаяПоСобственникамПомещений.СобственностьГраждан,
	|	втИтоговаяПоСобственникамПомещений.СобственностьЮрЛиц,
	|	ВЫБОР
	|		КОГДА втАдресаПоРегионуИГороду.Регион ПОДОБНО ""%Москва%""
	|				ИЛИ втАдресаПоРегионуИГороду.Город ПОДОБНО ""%Москва%""
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ПринадлежащийМоскве,
	|	ВЫБОР
	|		КОГДА втАдресаПоРегионуИГороду.Регион ПОДОБНО ""%Санкт-Петербург%""
	|				ИЛИ втАдресаПоРегионуИГороду.Город ПОДОБНО ""%Санкт-Петербург%""
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ПринадлежащийСанктПетербургу
	|ПОМЕСТИТЬ втПоПринадлежности
	|ИЗ
	|	втИтоговаяПоСобственникамПомещений КАК втИтоговаяПоСобственникамПомещений
	|		ЛЕВОЕ СОЕДИНЕНИЕ втАдресаПоРегионуИГороду КАК втАдресаПоРегионуИГороду
	|		ПО втИтоговаяПоСобственникамПомещений.Здание = втАдресаПоРегионуИГороду.Здание
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втПоПринадлежности.Помещение,
	|	втПоПринадлежности.Здание,
	|	втПоПринадлежности.СостояниеКвартиры,
	|	втПоПринадлежности.КатегорияКвартиры,
	|	втПоПринадлежности.ЗданиеМногоквартирное,
	|	втПоПринадлежности.ВидСобственности,
	|	втПоПринадлежности.СобственностьГраждан,
	|	втПоПринадлежности.СобственностьЮрЛиц,
	|	втПоПринадлежности.ПринадлежащийМоскве,
	|	втПоПринадлежности.ПринадлежащийСанктПетербургу,
	|	втПоПринадлежности.ОбщаяПлощадь / 1000 КАК Графа1,
	|	ВЫБОР
	|		КОГДА НЕ втПоПринадлежности.ЗданиеМногоквартирное
	|			ТОГДА втПоПринадлежности.ОбщаяПлощадь / 1000
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК Графа2,
	|	ВЫБОР
	|		КОГДА втПоПринадлежности.ЗданиеМногоквартирное
	|			ТОГДА втПоПринадлежности.ОбщаяПлощадь / 1000
	|		ИНАЧЕ 0
	|	КОНЕЦ КАК Графа3
	|ПОМЕСТИТЬ втОсновная
	|ИЗ
	|	втПоПринадлежности КАК втПоПринадлежности";
	
	Запрос.Выполнить();
	
	ТекстЗапросаРезультат = 
	"ВЫБРАТЬ
	|	СУММА(втОсновная.Графа1) КАК Графа1,
	|	СУММА(втОсновная.Графа2) КАК Графа2,
	|	СУММА(втОсновная.Графа3) КАК Графа3
	|ИЗ
	|	втОсновная КАК втОсновная
	|ГДЕ "; // последний пробел в запросе не удалять!!!
	
	// Строки 01 и 02 заполняются суммированием указанных ниже строк.
	
	// Строка 01 = Сумма строк (02, 05, 08, 09), ИНАЧЕ брать из базы, т.е. раскомментировать строки ниже.
			//Запрос.Текст = СтрЗаменить(ТекстЗапросаРезультат, "ГДЕ", "");
			//Выборка = Запрос.Выполнить().Выбрать();
			//Если Выборка.Следующий() Тогда
			//	ТабДокумент.Области.ЖФ101.Значение = Выборка.Графа1;
			//	ТабДокумент.Области.ЖФ201.Значение = Выборка.Графа2;
			//	ТабДокумент.Области.ЖФ301.Значение = Выборка.Графа3;
			//КонецЕсли;
	
	// Строка 02 = Сумма строк (03, 04), ИНАЧЕ брать из базы, т.е. раскомментировать строки ниже.
			//Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Частная)";
			//Выборка = Запрос.Выполнить().Выбрать();
			//Если Выборка.Следующий() Тогда
			//	ТабДокумент.Области.ЖФ102.Значение = Выборка.Графа1;
			//	ТабДокумент.Области.ЖФ202.Значение = Выборка.Графа2;
			//	ТабДокумент.Области.ЖФ302.Значение = Выборка.Графа3;
			//КонецЕсли;
	
	// Строка 03.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.СобственностьГраждан И втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Частная)";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ103.Значение = Выборка.Графа1;
		ТабДокумент.Области.ЖФ203.Значение = Выборка.Графа2;
		ТабДокумент.Области.ЖФ303.Значение = Выборка.Графа3;
	КонецЕсли;
	
	// Строка 04.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.СобственностьЮрЛиц И втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Частная)";
	Запрос.УстановитьПараметр("СобственностьЮрЛиц", Истина);
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ104.Значение = Выборка.Графа1;
		ТабДокумент.Области.ЖФ204.Значение = Выборка.Графа2;
		ТабДокумент.Области.ЖФ304.Значение = Выборка.Графа3;
	КонецЕсли;
	
	// Строка 05.
	Запрос.Текст = ТекстЗапросаРезультат + "(втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Государственная) ИЛИ втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Ведомственная))";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ105.Значение = Выборка.Графа1;
		ТабДокумент.Области.ЖФ205.Значение = Выборка.Графа2;
		ТабДокумент.Области.ЖФ305.Значение = Выборка.Графа3;
	КонецЕсли;
	
	// Строка 06.
	Запрос.Текст = ТекстЗапросаРезультат + "(втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Государственная) ИЛИ втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Ведомственная))
											| И втОсновная.ПринадлежащийМоскве";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ106.Значение = Выборка.Графа1;
		ТабДокумент.Области.ЖФ206.Значение = Выборка.Графа2;
		ТабДокумент.Области.ЖФ306.Значение = Выборка.Графа3;
	КонецЕсли;
	
	// Строка 07.
	Запрос.Текст = ТекстЗапросаРезультат + "(втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Государственная) ИЛИ втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Ведомственная))
											| И втОсновная.ПринадлежащийСанктПетербургу";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ107.Значение = Выборка.Графа1;
		ТабДокумент.Области.ЖФ207.Значение = Выборка.Графа2;
		ТабДокумент.Области.ЖФ307.Значение = Выборка.Графа3;
	КонецЕсли;
	
	// Строка 08.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Муниципальная)";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ108.Значение = Выборка.Графа1;
		ТабДокумент.Области.ЖФ208.Значение = Выборка.Графа2;
		ТабДокумент.Области.ЖФ308.Значение = Выборка.Графа3;
	КонецЕсли;
	
	// Строка 09.
	Запрос.Текст = ТекстЗапросаРезультат + "НЕ втОсновная.ВидСобственности В (ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Частная),
																			| ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Государственная),
																			| ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Ведомственная),
																			| ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Муниципальная))";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ109.Значение = Выборка.Графа1;
		ТабДокумент.Области.ЖФ209.Значение = Выборка.Графа2;
		ТабДокумент.Области.ЖФ309.Значение = Выборка.Графа3;
	КонецЕсли;
	
КонецПроцедуры // ЗаполнитьРаздел1()

&НаСервере
// Процедура заполняет раздел 2.
Процедура ЗаполнитьРаздел2(ТабДокумент, ТаблицаЖилыхПомещений)
	
	МенеджерВременныхТаблиц        = Новый МенеджерВременныхТаблиц;
	Запрос                         = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Текст                   = ПолучитьТекстЗапросаПоРазделу2();
	
	Запрос.УстановитьПараметр("ВидыЖилыхПомещений",    СписокВидовЖилыхПомещений);
	Запрос.УстановитьПараметр("ДатаКон",               СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета);
	Запрос.УстановитьПараметр("ТаблицаЖилыхПомещений", ТаблицаЖилыхПомещений);
	Запрос.Выполнить();
	
	ТекстЗапросаРезультат = 
	"ВЫБРАТЬ
	|	СУММА(втОсновная.КоличествоКвартир) КАК КоличествоКвартир,
	|	СУММА(втОсновная.ОбщаяПлощадь) КАК ОбщаяПлощадь
	|ИЗ
	|	втОсновная КАК втОсновная
	|ГДЕ &ПризнакМногоквартирности";
	
	СписокСоответствийГраф = Новый Соответствие;
	СписокСоответствийГраф.Вставить(2, "И втОсновная.Однокомнатные");
	СписокСоответствийГраф.Вставить(3, "И втОсновная.Двухкомнатные");
	СписокСоответствийГраф.Вставить(4, "И втОсновная.Трехкомнатные");
	СписокСоответствийГраф.Вставить(5, "И втОсновная.ЧетырехИБолееКомнатные");
	
	// По многоквартирным жилым домам для строк: 16, 17, 18.
	ТекстЗапросаРезультатМногоквартирные = СтрЗаменить(ТекстЗапросаРезультат, "&ПризнакМногоквартирности", "втОсновная.ЗданиеМногоквартирное ");
	Для текСтрока = 16 По 18 Цикл
		Для Каждого ТекСоответствие Из СписокСоответствийГраф Цикл
			Запрос.Текст = ?(текСтрока = 17, ТекстЗапросаРезультатМногоквартирные + ТекСоответствие.Значение + " И ЭтоЧастнаяКвартира",
											 ТекстЗапросаРезультатМногоквартирные + ТекСоответствие.Значение);
			Выборка = Запрос.Выполнить().Выбрать();
			Если Выборка.Следующий() Тогда
				ИмяОбласти = "ЖФ" + ТекСоответствие.Ключ + текСтрока;
				ТабДокумент.Области[ИмяОбласти].Значение = ?(текСтрока = 18, Выборка.ОбщаяПлощадь,
																			 Выборка.КоличествоКвартир);
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	
	// По немногоквартирным жилым домам для строк: 21 и 22.
	ТекстЗапросаРезультатНеМногоквартирные = СтрЗаменить(ТекстЗапросаРезультат, "&ПризнакМногоквартирности", "Не втОсновная.ЗданиеМногоквартирное ");
	Для текСтрока = 21 По 22 Цикл
		Для Каждого ТекСоответствие Из СписокСоответствийГраф Цикл
			Запрос.Текст = ТекстЗапросаРезультатНеМногоквартирные + ТекСоответствие.Значение;
			Выборка = Запрос.Выполнить().Выбрать();
			Если Выборка.Следующий() Тогда
				ИмяОбласти = "ЖФ" + ТекСоответствие.Ключ + текСтрока;
				ТабДокумент.Области[ИмяОбласти].Значение = ?(текСтрока = 22, Выборка.ОбщаяПлощадь,
																			 Выборка.КоличествоКвартир);
			КонецЕсли;
		КонецЦикла;
	КонецЦикла;
	
КонецПроцедуры // ЗаполнитьРаздел2()

&НаСервере
// Возвращает текст запроса по разделу 2.
Функция ПолучитьТекстЗапросаПоРазделу2()
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ТаблицаЖилыхПомещений.Квартира,
	|	ТаблицаЖилыхПомещений.ЗданиеМногоквартирное,
	|	ТаблицаЖилыхПомещений.Родитель,
	|	ТаблицаЖилыхПомещений.КоличествоКомнат,
	|	ТаблицаЖилыхПомещений.ОбщаяПлощадь
	|ПОМЕСТИТЬ втЖилыеКвартиры
	|ИЗ
	|	&ТаблицаЖилыхПомещений КАК ТаблицаЖилыхПомещений
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ Комнаты.Ссылка) КАК КолВоКомнат,
	|	Комнаты.Родитель КАК Квартира
	|ПОМЕСТИТЬ втКомнаты
	|ИЗ
	|	Справочник.УПЖКХ_Помещения КАК Комнаты
	|ГДЕ
	|	НЕ Комнаты.Родитель = ЗНАЧЕНИЕ(Справочник.УПЖКХ_Помещения.ПустаяСсылка)
	|	И НЕ Комнаты.ПометкаУдаления
	|
	|СГРУППИРОВАТЬ ПО
	|	Комнаты.Родитель
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	втЖилыеКвартиры.Квартира,
	|	втЖилыеКвартиры.ЗданиеМногоквартирное,
	|	втЖилыеКвартиры.ОбщаяПлощадь,
	|	ВЫБОР
	|		КОГДА НЕ втКомнаты.КолВоКомнат = 0
	|			ТОГДА втКомнаты.КолВоКомнат
	|		КОГДА НЕ втЖилыеКвартиры.КоличествоКомнат = 0
	|			ТОГДА втЖилыеКвартиры.КоличествоКомнат
	|		ИНАЧЕ 1
	|	КОНЕЦ КАК КоличествоКомнат
	|ПОМЕСТИТЬ втКолКомнат
	|ИЗ
	|	втЖилыеКвартиры КАК втЖилыеКвартиры
	|		ЛЕВОЕ СОЕДИНЕНИЕ втКомнаты КАК втКомнаты
	|		ПО втЖилыеКвартиры.Квартира = втКомнаты.Квартира
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втКолКомнат.Квартира,
	|	втКолКомнат.ЗданиеМногоквартирное,
	|	втКолКомнат.ОбщаяПлощадь,
	|	втКолКомнат.КоличествоКомнат
	|ПОМЕСТИТЬ втИтоговая
	|ИЗ
	|	втКолКомнат КАК втКолКомнат
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	УПЖКХ_СобственностьНаПомещенияСрезПоследних.Помещение КАК Квартира,
	|	УПЖКХ_СобственностьНаПомещенияСрезПоследних.ВидСобственности
	|ПОМЕСТИТЬ втСобственностьНаПомещениЧастная
	|ИЗ
	|	РегистрСведений.УПЖКХ_СобственностьНаПомещения.СрезПоследних(
	|			&ДатаКон,
	|			Помещение В
	|				(ВЫБРАТЬ
	|					втИтоговая.Квартира
	|				ИЗ
	|					втИтоговая КАК втИтоговая)) КАК УПЖКХ_СобственностьНаПомещенияСрезПоследних
	|ГДЕ
	|	УПЖКХ_СобственностьНаПомещенияСрезПоследних.Действует
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ втИтоговая.Квартира) КАК КоличествоКвартир,
	|	втИтоговая.ЗданиеМногоквартирное,
	|	ВЫБОР
	|		КОГДА втСобственностьНаПомещениЧастная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Частная)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЭтоЧастнаяКвартира,
	|	втИтоговая.КоличествоКомнат,
	|	СУММА(втИтоговая.ОбщаяПлощадь) / 1000 КАК ОбщаяПлощадь,
	|	ВЫБОР
	|		КОГДА втИтоговая.КоличествоКомнат = 1
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Однокомнатные,
	|	ВЫБОР
	|		КОГДА втИтоговая.КоличествоКомнат = 2
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Двухкомнатные,
	|	ВЫБОР
	|		КОГДА втИтоговая.КоличествоКомнат = 3
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК Трехкомнатные,
	|	ВЫБОР
	|		КОГДА втИтоговая.КоличествоКомнат >= 4
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ЧетырехИБолееКомнатные
	|ПОМЕСТИТЬ втОсновная
	|ИЗ
	|	втИтоговая КАК втИтоговая
	|		ЛЕВОЕ СОЕДИНЕНИЕ втСобственностьНаПомещениЧастная КАК втСобственностьНаПомещениЧастная
	|		ПО втИтоговая.Квартира = втСобственностьНаПомещениЧастная.Квартира
	|
	|СГРУППИРОВАТЬ ПО
	|	втИтоговая.ЗданиеМногоквартирное,
	|	втИтоговая.КоличествоКомнат,
	|	ВЫБОР
	|		КОГДА втСобственностьНаПомещениЧастная.ВидСобственности = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ВидыСобственности.Частная)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СУММА(втОсновная.КоличествоКвартир) КАК КоличествоКвартир,
	|	СУММА(втОсновная.ОбщаяПлощадь) КАК ОбщаяПлощадь
	|ИЗ
	|	втОсновная КАК втОсновная";
	
	Возврат ТекстЗапроса;
	
КонецФункции // ПолучитьТекстЗапросаПоРазделу2()

&НаСервере
// Процедура заполняет раздел 3.
Процедура ЗаполнитьРаздел3(ТабДокумент, ТаблицаЖилыхПомещений)
	
	СписокВидовЖилыхПомещений = Новый СписокЗначений;
	МассивЗначений            = Справочники.УПЖКХ_ВидыПомещений.ПолучитьСписокВидовПомещений(Истина);
	СписокВидовЖилыхПомещений.ЗагрузитьЗначения(МассивЗначений);
	
	ВидыБлагоустройств = Новый СписокЗначений;
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.Ванна);
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.Ванная);
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.ГорячееВодоснабжение);
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.Канализация);
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.Отопление);
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.Плита);
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.ХолодноеВодоснабжение);
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.ЦентрализованноеОтопление);
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.Мусоропровод);
	ВидыБлагоустройств.Добавить(Справочники.КВП_ВидыБлагоустройстваОбъектов.Лифт);
	
	// Список возможных значений благоустройств, установленных пользователем.
	СписокЗначенийБлагоустройства = Новый СписокЗначений;
	СписокЗначенийБлагоустройства.Добавить(Истина);
	СписокЗначенийБлагоустройства.Добавить("ДА");
	СписокЗначенийБлагоустройства.Добавить("да");
	СписокЗначенийБлагоустройства.Добавить("Да");
	СписокЗначенийБлагоустройства.Добавить("Имеется");
	СписокЗначенийБлагоустройства.Добавить("имеется");
	СписокЗначенийБлагоустройства.Добавить("Присутствует");
	СписокЗначенийБлагоустройства.Добавить("присутствует");
	СписокЗначенийБлагоустройства.Добавить("Есть");
	СписокЗначенийБлагоустройства.Добавить("есть");
	СписокЗначенийБлагоустройства.Добавить(Перечисления.КВП_Плита.Электрическая);
	СписокЗначенийБлагоустройства.Добавить(Перечисления.КВП_Плита.Газовая);
	
	Запрос       = Новый Запрос;
	Запрос.Текст = ПолучитьТекстЗапросаПоРазделу3();
	
	Запрос.УстановитьПараметр("ВидыЖилыхПомещений",            СписокВидовЖилыхПомещений);
	Запрос.УстановитьПараметр("ДатаКон",                       СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета);
	Запрос.УстановитьПараметр("ВидБлагоустройства",            ВидыБлагоустройств);
	Запрос.УстановитьПараметр("ТаблицаЖилыхПомещений",         ТаблицаЖилыхПомещений);
	Запрос.УстановитьПараметр("СписокЗначенийБлагоустройства", СписокЗначенийБлагоустройства);
	
	Выборка = Запрос.Выполнить().Выбрать();
	
	Если Выборка.Следующий() Тогда
		
		ТабДокумент.Области.ЖФ123.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ223.Значение = Выборка.Водопровод;
		ТабДокумент.Области.ЖФ124.Значение = Выборка.ОбщаяПлощадьвтСтрока24;
		ТабДокумент.Области.ЖФ423.Значение = Выборка.Канализация;
		ТабДокумент.Области.ЖФ523.Значение = Выборка.ЦентральнаяКанализация;
		Если Выборка.Канализация = 0 И НЕ Выборка.ЦентральнаяКанализация = 0 Тогда
			ТабДокумент.Области.ЖФ423.Значение = Выборка.ЦентральнаяКанализация;
		КонецЕсли;
		
		ТабДокумент.Области.ЖФ623.Значение = Выборка.ОтоплениеПлощадь;
		ТабДокумент.Области.ЖФ723.Значение = Выборка.ЦентрализованноеОтоплениеПлощадь;
		Если Выборка.ОтоплениеПлощадь = 0 И НЕ Выборка.ЦентрализованноеОтоплениеПлощадь = 0 Тогда
			ТабДокумент.Области.ЖФ623.Значение = Выборка.ЦентрализованноеОтоплениеПлощадь;
		КонецЕсли;
		
		ТабДокумент.Области.ЖФ823.Значение = Выборка.ГорячееВодоснабжение;
		ТабДокумент.Области.ЖФ923.Значение = Выборка.ЦентрализованноеГорячееВодоснабжение;
		Если Выборка.ГорячееВодоснабжение = 0 И НЕ Выборка.ЦентрализованноеГорячееВодоснабжение = 0 Тогда
			ТабДокумент.Области.ЖФ823.Значение = Выборка.ЦентрализованноеОтоплениеПлощадь;
		КонецЕсли;
		
		ТабДокумент.Области.ЖФ1023.Значение = Выборка.ВаннаяПлощадь;
		ТабДокумент.Области.ЖФ1123.Значение = Выборка.ПлитаГазовая;
		ТабДокумент.Области.ЖФ1223.Значение = Выборка.ПлитаЭлектрическая;
		ТабДокумент.Области.ЖФ125.Значение  = Выборка.КоличествоЗданийСМусоропроводом;
		ТабДокумент.Области.ЖФ126.Значение  = Выборка.КоличествоМусоропроводов;
		ТабДокумент.Области.ЖФ127.Значение  = Выборка.КоличествоЗданийСЛифтами;
		//ТабДокумент.Области.ЖФ128.Значение = Выборка.КоличествоЛифтовыхШахт;
		
	КонецЕсли;
	
КонецПроцедуры // ЗаполнитьРаздел3()

&НаСервере
// Возвращает текст запроса по разделу 3.
Функция ПолучитьТекстЗапросаПоРазделу3()
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ТаблицаЖилыхПомещений.Квартира,
	|	ТаблицаЖилыхПомещений.Здание,
	|	ТаблицаЖилыхПомещений.ОбщаяПлощадь,
	|	ТаблицаЖилыхПомещений.ЗданиеМногоквартирное
	|ПОМЕСТИТЬ втЖилыеПомещенияСПлощадями
	|ИЗ
	|	&ТаблицаЖилыхПомещений КАК ТаблицаЖилыхПомещений
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	КВП_БлагоустройствоОбъектов.Объект,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.КВП_Здания
	|			ТОГДА КВП_БлагоустройствоОбъектов.Объект
	|	КОНЕЦ КАК Здание,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.УПЖКХ_Помещения
	|			ТОГДА КВП_БлагоустройствоОбъектов.Объект
	|	КОНЕЦ КАК Помещение,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.КВП_Здания
	|			ТОГДА КВП_БлагоустройствоОбъектов.ВидБлагоустройства
	|	КОНЕЦ КАК ВидБлагоустройстваЗдания,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.УПЖКХ_Помещения
	|			ТОГДА КВП_БлагоустройствоОбъектов.ВидБлагоустройства
	|	КОНЕЦ КАК ВидБлагоустройстваПомещения,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.КВП_Здания
	|			ТОГДА КВП_БлагоустройствоОбъектов.Значение
	|	КОНЕЦ КАК ЗначениеЗдание,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.УПЖКХ_Помещения
	|			ТОГДА КВП_БлагоустройствоОбъектов.Значение
	|	КОНЕЦ КАК ЗначениеПомещение
	|ПОМЕСТИТЬ втБлагоустройства
	|ИЗ
	|	РегистрСведений.КВП_БлагоустройствоОбъектов КАК КВП_БлагоустройствоОбъектов
	|ГДЕ
	|	НЕ КВП_БлагоустройствоОбъектов.Значение = ЛОЖЬ
	|	И КВП_БлагоустройствоОбъектов.ВидБлагоустройства В(&ВидБлагоустройства)
	|	И (КВП_БлагоустройствоОбъектов.Объект В
	|				(ВЫБРАТЬ
	|					втЖилыеПомещенияСПлощадями.Квартира
	|				ИЗ
	|					втЖилыеПомещенияСПлощадями КАК втЖилыеПомещенияСПлощадями)
	|			ИЛИ КВП_БлагоустройствоОбъектов.Объект В
	|				(ВЫБРАТЬ
	|					втЖилыеПомещенияСПлощадями.Здание
	|				ИЗ
	|					втЖилыеПомещенияСПлощадями КАК втЖилыеПомещенияСПлощадями))
	|
	|СГРУППИРОВАТЬ ПО
	|	КВП_БлагоустройствоОбъектов.Объект,
	|	КВП_БлагоустройствоОбъектов.ВидБлагоустройства,
	|	КВП_БлагоустройствоОбъектов.Значение,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.УПЖКХ_Помещения
	|			ТОГДА КВП_БлагоустройствоОбъектов.Объект
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.КВП_Здания
	|			ТОГДА КВП_БлагоустройствоОбъектов.ВидБлагоустройства
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.УПЖКХ_Помещения
	|			ТОГДА КВП_БлагоустройствоОбъектов.ВидБлагоустройства
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.КВП_Здания
	|			ТОГДА КВП_БлагоустройствоОбъектов.Значение
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.УПЖКХ_Помещения
	|			ТОГДА КВП_БлагоустройствоОбъектов.Значение
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА КВП_БлагоустройствоОбъектов.Объект ССЫЛКА Справочник.КВП_Здания
	|			ТОГДА КВП_БлагоустройствоОбъектов.Объект
	|	КОНЕЦ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ РАЗЛИЧНЫЕ
	|	втЖилыеПомещенияСПлощадями.Квартира,
	|	втЖилыеПомещенияСПлощадями.Здание,
	|	втЖилыеПомещенияСПлощадями.ОбщаяПлощадь,
	|	ЕСТЬNULL(втБлагоустройства.ВидБлагоустройстваПомещения, втБлагоустройства.ВидБлагоустройстваЗдания) КАК ВидБлагоустройства,
	|	ЕСТЬNULL(втБлагоустройства.ЗначениеПомещение, втБлагоустройства.ЗначениеЗдание) КАК Значение,
	|	втЖилыеПомещенияСПлощадями.ЗданиеМногоквартирное
	|ПОМЕСТИТЬ втИтоговая
	|ИЗ
	|	втЖилыеПомещенияСПлощадями КАК втЖилыеПомещенияСПлощадями
	|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ втБлагоустройства КАК втБлагоустройства
	|		ПО (втЖилыеПомещенияСПлощадями.Здание = втБлагоустройства.Здание
	|				ИЛИ втЖилыеПомещенияСПлощадями.Квартира = втБлагоустройства.Помещение)
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Отопление)
	|					И втИтоговая.Значение = ИСТИНА
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ОтоплениеПлощадь,
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.ЦентрализованноеОтопление)
	|					И втИтоговая.Значение = ИСТИНА
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ЦентрализованноеОтоплениеПлощадь,
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Канализация)
	|					И втИтоговая.Значение = ИСТИНА
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК Канализация,
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Канализация)
	|					И втИтоговая.Значение = ЗНАЧЕНИЕ(Перечисление.КВП_Канализация.Центральная)
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ЦентральнаяКанализация,
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.ГорячееВодоснабжение)
	|					И втИтоговая.Значение = ИСТИНА
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ГорячееВодоснабжение,
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.ГорячееВодоснабжение)
	|					И втИтоговая.Значение = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_ТипыГорячегоВодоснабжения.Централизованное)
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ЦентрализованноеГорячееВодоснабжение,
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Плита)
	|					И втИтоговая.Значение = ЗНАЧЕНИЕ(Перечисление.КВП_Плита.Газовая)
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПлитаГазовая,
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Плита)
	|					И втИтоговая.Значение = ЗНАЧЕНИЕ(Перечисление.КВП_Плита.Электрическая)
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ПлитаЭлектрическая,
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.ХолодноеВодоснабжение)
	|					И втИтоговая.Значение = ИСТИНА
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ХолодноеВодоснабжение
	|ПОМЕСТИТЬ втИтоговаяСсуммыБезВанн
	|ИЗ
	|	втИтоговая КАК втИтоговая
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	СУММА(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Ванна)
	|					И втИтоговая.Значение В (&СписокЗначенийБлагоустройства)
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|		КОНЕЦ) КАК ВаннаяПлощадь
	|ПОМЕСТИТЬ втПлощадиПомещенийСВаннами
	|ИЗ
	|	втИтоговая КАК втИтоговая
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	втИтоговая.Квартира,
	|	втИтоговая.Здание,
	|	МАКСИМУМ(ВЫБОР
	|			КОГДА втИтоговая.ВидБлагоустройства В (ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Отопление), ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Канализация), ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.ХолодноеВодоснабжение), ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.ГорячееВодоснабжение), ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Плита))
	|					И втИтоговая.Значение В (&СписокЗначенийБлагоустройства)
	|				ТОГДА втИтоговая.ОбщаяПлощадь
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК ОбщаяПлощадь
	|ПОМЕСТИТЬ втСтрока24
	|ИЗ
	|	втИтоговая КАК втИтоговая
	|
	|СГРУППИРОВАТЬ ПО
	|	втИтоговая.Квартира,
	|	втИтоговая.Здание
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	ОбщаяПлощадьЖилыхПомещений.ОбщаяПлощадь / 1000 КАК ОбщаяПлощадь,
	|	втИтоговаяСсуммыБезВанн.ХолодноеВодоснабжение / 1000 КАК Водопровод,
	|	втИтоговаяСсуммыБезВанн.Канализация / 1000 КАК Канализация,
	|	втИтоговаяСсуммыБезВанн.ЦентральнаяКанализация / 1000 КАК ЦентральнаяКанализация,
	|	втИтоговаяСсуммыБезВанн.ОтоплениеПлощадь / 1000 КАК ОтоплениеПлощадь,
	|	втИтоговаяСсуммыБезВанн.ЦентрализованноеОтоплениеПлощадь / 1000 КАК ЦентрализованноеОтоплениеПлощадь,
	|	втИтоговаяСсуммыБезВанн.ГорячееВодоснабжение / 1000 КАК ГорячееВодоснабжение,
	|	втИтоговаяСсуммыБезВанн.ЦентрализованноеГорячееВодоснабжение / 1000 КАК ЦентрализованноеГорячееВодоснабжение,
	|	ПлощадиПомещенийСВаннами.ВаннаяПлощадь / 1000 КАК ВаннаяПлощадь,
	|	втИтоговаяСсуммыБезВанн.ПлитаГазовая / 1000 КАК ПлитаГазовая,
	|	втИтоговаяСсуммыБезВанн.ПлитаЭлектрическая / 1000 КАК ПлитаЭлектрическая,
	|	Строка24.ОбщаяПлощадь / 1000 КАК ОбщаяПлощадьвтСтрока24,
	|	МусоропроводИЛифт.КоличествоЗданийСЛифтами,
	|	МусоропроводИЛифт.КоличествоМусоропроводов,
	|	МусоропроводИЛифт.КоличествоЛифтовыхШахт,
	|	МусоропроводИЛифт.КоличествоЗданийСМусоропроводом
	|ИЗ
	|	(ВЫБРАТЬ
	|		СУММА(ЕСТЬNULL(втПлощадиПомещенийСВаннами.ВаннаяПлощадь, 0)) КАК ВаннаяПлощадь
	|	ИЗ
	|		втПлощадиПомещенийСВаннами КАК втПлощадиПомещенийСВаннами) КАК ПлощадиПомещенийСВаннами,
	|	втИтоговаяСсуммыБезВанн КАК втИтоговаяСсуммыБезВанн,
	|	(ВЫБРАТЬ
	|		СУММА(втЖилыеПомещенияСПлощадями.ОбщаяПлощадь) КАК ОбщаяПлощадь
	|	ИЗ
	|		втЖилыеПомещенияСПлощадями КАК втЖилыеПомещенияСПлощадями) КАК ОбщаяПлощадьЖилыхПомещений,
	|	(ВЫБРАТЬ
	|		КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ВЫБОР
	|				КОГДА втИтоговая.ЗданиеМногоквартирное
	|						И втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Мусоропровод)
	|						И втИтоговая.Значение В (&СписокЗначенийБлагоустройства)
	|					ТОГДА втИтоговая.Здание
	|			КОНЕЦ) КАК КоличествоЗданийСМусоропроводом,
	|		КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ВЫБОР
	|				КОГДА втИтоговая.ЗданиеМногоквартирное
	|						И втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Лифт)
	|						И втИтоговая.Значение В (&СписокЗначенийБлагоустройства)
	|					ТОГДА втИтоговая.Здание
	|			КОНЕЦ) КАК КоличествоЗданийСЛифтами,
	|		СУММА(ВЫБОР
	|				КОГДА втИтоговая.ЗданиеМногоквартирное
	|						И втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.Мусоропровод)
	|						И ТИПЗНАЧЕНИЯ(втИтоговая.Значение) = ТИП(ЧИСЛО)
	|					ТОГДА ВЫРАЗИТЬ(втИтоговая.Значение КАК ЧИСЛО(2, 0))
	|				ИНАЧЕ 0
	|			КОНЕЦ) КАК КоличествоМусоропроводов,
	|		СУММА(ВЫБОР
	|				КОГДА втИтоговая.ВидБлагоустройства = ЗНАЧЕНИЕ(Справочник.КВП_ВидыБлагоустройстваОбъектов.КоличествоЛифтовыхШахт)
	|						И ТИПЗНАЧЕНИЯ(втИтоговая.Значение) = ТИП(ЧИСЛО)
	|					ТОГДА ВЫРАЗИТЬ(втИтоговая.Значение КАК ЧИСЛО(2, 0))
	|				ИНАЧЕ 0
	|			КОНЕЦ) КАК КоличествоЛифтовыхШахт
	|	ИЗ
	|		втИтоговая КАК втИтоговая
	|	ГДЕ
	|		втИтоговая.ЗданиеМногоквартирное) КАК МусоропроводИЛифт,
	|	(ВЫБРАТЬ
	|		СУММА(ЕСТЬNULL(втСтрока24.ОбщаяПлощадь, 0)) КАК ОбщаяПлощадь
	|	ИЗ
	|		втСтрока24 КАК втСтрока24) КАК Строка24";
	
	Возврат ТекстЗапроса;
	
КонецФункции // ПолучитьТекстЗапросаПоРазделу3()

&НаСервере
// Процедура заполняет раздел 4.
Процедура ЗаполнитьРаздел4(ТабДокумент, СписокМатериаловСтен, ТаблицаЖилыхПомещений)
	
	МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	
	Запрос.Текст = ПолучитьТекстЗапросаПоРазделам4И5(ТаблицаЖилыхПомещений);
	Запрос.УстановитьПараметр("ВидыЖилыхПомещений",    СписокВидовЖилыхПомещений);
	Запрос.УстановитьПараметр("ДатаКон",               СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета);
	Запрос.УстановитьПараметр("ТаблицаЖилыхПомещений", ТаблицаЖилыхПомещений);
	Запрос.Выполнить();
	
	ТекстЗапросаРезультат = 
	"ВЫБРАТЬ
	|	СУММА(втОсновная.ОбщаяПлощадь) / 1000 КАК ОбщаяПлощадь,
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ВЫБОР
	|			КОГДА НЕ втОсновная.ЗданиеМногоквартирное
	|				ТОГДА втОсновная.Здание
	|		КОНЕЦ) КАК КолВоНеМногоквартирныхДомов,
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ ВЫБОР
	|			КОГДА втОсновная.ЗданиеМногоквартирное
	|				ТОГДА втОсновная.Здание
	|		КОНЕЦ) КАК КолВоМногоквартирныхДомов
	|ИЗ
	|	втОсновная КАК втОсновная
	|ГДЕ "; // последний пробел в запросе не удалять!!!
	
	// По материалу стен.
	
	// Строка 31.
	МатериалыСтенКаменные = СписокМатериаловСтен[0].Значение;
	Если Не МатериалыСтенКаменные.Пустая() Тогда
		Запрос.УстановитьПараметр("Каменные", МатериалыСтенКаменные);
		Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Каменные";
		Выборка      = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ТабДокумент.Области.ЖФ131.Значение = Выборка.ОбщаяПлощадь;
			ТабДокумент.Области.ЖФ231.Значение = Выборка.КолВоНеМногоквартирныхДомов;
			ТабДокумент.Области.ЖФ331.Значение = Выборка.КолВоМногоквартирныхДомов;
		КонецЕсли;
	КонецЕсли;
	
	// Строка 32.
	Запрос.УстановитьПараметр("Кирпичные", СписокМатериаловСтен[1].Значение);
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Кирпичные";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ132.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ232.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ332.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 33.
	МатериалыСтенПанельные = СписокМатериаловСтен[2].Значение;
	Если Не МатериалыСтенПанельные.Пустая() Тогда
		Запрос.УстановитьПараметр("Панельные", МатериалыСтенПанельные);
		Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Панельные";
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ТабДокумент.Области.ЖФ133.Значение = Выборка.ОбщаяПлощадь;
			ТабДокумент.Области.ЖФ233.Значение = Выборка.КолВоНеМногоквартирныхДомов;
			ТабДокумент.Области.ЖФ333.Значение = Выборка.КолВоМногоквартирныхДомов;
		КонецЕсли;
	КонецЕсли;
	
	// Строка 34.
	Запрос.УстановитьПараметр("Блочные", СписокМатериаловСтен[3].Значение);
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Блочные";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ134.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ234.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ334.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 35.
	МатериалыСтенМонолитные = СписокМатериаловСтен[4].Значение;
	Если Не МатериалыСтенМонолитные.Пустая() Тогда
		Запрос.УстановитьПараметр("Монолитные", МатериалыСтенМонолитные);
		Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Монолитные";
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ТабДокумент.Области.ЖФ135.Значение = Выборка.ОбщаяПлощадь;
			ТабДокумент.Области.ЖФ235.Значение = Выборка.КолВоНеМногоквартирныхДомов;
			ТабДокумент.Области.ЖФ335.Значение = Выборка.КолВоМногоквартирныхДомов;
		КонецЕсли;
	КонецЕсли;
	
	// Строка 36.
	Запрос.УстановитьПараметр("Смешанные", СписокМатериаловСтен[5].Значение);
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Смешанные";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ136.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ236.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ336.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 37.
	Запрос.УстановитьПараметр("Деревянные", СписокМатериаловСтен[6].Значение);
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Деревянные";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ137.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ237.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ337.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 38.
	Если НЕ МатериалыСтенКаменные.Пустая()
	   И НЕ МатериалыСтенПанельные.Пустая()
	   И НЕ МатериалыСтенМонолитные.Пустая() Тогда
		Запрос.УстановитьПараметр("СписокМатериаловСтен", СписокМатериаловСтен);
		Запрос.Текст = ТекстЗапросаРезультат + "НЕ втОсновная.МатериалСтен В (&СписокМатериаловСтен)";
		Выборка      = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ТабДокумент.Области.ЖФ138.Значение = Выборка.ОбщаяПлощадь;
			ТабДокумент.Области.ЖФ238.Значение = Выборка.КолВоНеМногоквартирныхДомов;
			ТабДокумент.Области.ЖФ338.Значение = Выборка.КолВоМногоквартирныхДомов;
		КонецЕсли;
	КонецЕсли;
	
	// По годам возведения.
	
	// Строка 39.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ГодПостройки <= 1920";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ139.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ239.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ339.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 40.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ГодПостройки МЕЖДУ 1921 И 1945";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ140.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ240.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ340.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 41.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ГодПостройки МЕЖДУ 1946 И 1970";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ141.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ241.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ341.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 42.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ГодПостройки МЕЖДУ 1971 И 1995";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ142.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ242.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ342.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 43.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ГодПостройки > 1995";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ143.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ243.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ343.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// По проценту износа.
	
	// Строка 44.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ПроцентИзноса МЕЖДУ 0 И 30";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ144.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ244.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ344.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 45.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ПроцентИзноса МЕЖДУ 31 И 65";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ145.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ245.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ345.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 46.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ПроцентИзноса МЕЖДУ 66 И 70";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ146.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ246.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ346.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	// Строка 47.
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.ПроцентИзноса > 70";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ147.Значение = Выборка.ОбщаяПлощадь;
		ТабДокумент.Области.ЖФ247.Значение = Выборка.КолВоНеМногоквартирныхДомов;
		ТабДокумент.Области.ЖФ347.Значение = Выборка.КолВоМногоквартирныхДомов;
	КонецЕсли;
	
	
КонецПроцедуры // ЗаполнитьРаздел4()

&НаСервере
// Процедура заполняет раздел 5.
Процедура ЗаполнитьРаздел5(ТабДокумент, СписокМатериаловСтен, ТаблицаЖилыхПомещений)
	
	МенеджерВременныхТаблиц        = Новый МенеджерВременныхТаблиц;
	Запрос                         = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = МенеджерВременныхТаблиц;
	Запрос.Текст                   = ПолучитьТекстЗапросаПоРазделам4И5(ТаблицаЖилыхПомещений);
	
	ТекстЗапросаРезультат = 
	"ВЫБРАТЬ
	|	СУММА(ВЫБОР
	|			КОГДА втОсновная.ГодПостройки <= 1920
	|				ТОГДА втОсновная.ОбщаяПлощадь / 1000
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК До1920,
	|	СУММА(ВЫБОР
	|			КОГДА втОсновная.ГодПостройки МЕЖДУ 1921 И 1945
	|				ТОГДА втОсновная.ОбщаяПлощадь / 1000
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК Между1921и1945,
	|	СУММА(ВЫБОР
	|			КОГДА втОсновная.ГодПостройки МЕЖДУ 1946 И 1970
	|				ТОГДА втОсновная.ОбщаяПлощадь / 1000
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК Между1946и1970,
	|	СУММА(ВЫБОР
	|			КОГДА втОсновная.ГодПостройки МЕЖДУ 1971 И 1995
	|				ТОГДА втОсновная.ОбщаяПлощадь / 1000
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК Между1971и1995,
	|	СУММА(ВЫБОР
	|			КОГДА втОсновная.ГодПостройки > 1995
	|				ТОГДА втОсновная.ОбщаяПлощадь / 1000
	|			ИНАЧЕ 0
	|		КОНЕЦ) КАК После1995
	|ИЗ
	|	втОсновная КАК втОсновная
	|ГДЕ "; // последний пробел в запросе не удалять!!!
	
	СписокВидовЖилыхПомещений = Новый СписокЗначений;
	МассивЗначений            = Справочники.УПЖКХ_ВидыПомещений.ПолучитьСписокВидовПомещений(Истина);
	СписокВидовЖилыхПомещений.ЗагрузитьЗначения(МассивЗначений);
	Запрос.УстановитьПараметр("ВидыЖилыхПомещений",    СписокВидовЖилыхПомещений);
	Запрос.УстановитьПараметр("ДатаКон",               СтруктураРеквизитовФормы.мДатаКонцаПериодаОтчета);
	Запрос.УстановитьПараметр("ТаблицаЖилыхПомещений", ТаблицаЖилыхПомещений);
	Запрос.Выполнить();
	
	// По материалу стен.
	
	// Строка 48.
	МатериалыСтенКаменные = СписокМатериаловСтен[0].Значение;
	Если Не МатериалыСтенКаменные.Пустая() Тогда
		Запрос.УстановитьПараметр("Каменные", МатериалыСтенКаменные);
		Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Каменные";
		Выборка = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ТабДокумент.Области.ЖФ148.Значение = Выборка.До1920;
			ТабДокумент.Области.ЖФ248.Значение = Выборка.Между1921и1945;
			ТабДокумент.Области.ЖФ348.Значение = Выборка.Между1946и1970;
			ТабДокумент.Области.ЖФ448.Значение = Выборка.Между1971и1995;
			ТабДокумент.Области.ЖФ548.Значение = Выборка.После1995;
		КонецЕсли;
	КонецЕсли;
	
	// Строка 49.
	Запрос.УстановитьПараметр("Кирпичные", СписокМатериаловСтен[1].Значение);
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Кирпичные";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ149.Значение = Выборка.До1920;
		ТабДокумент.Области.ЖФ249.Значение = Выборка.Между1921и1945;
		ТабДокумент.Области.ЖФ349.Значение = Выборка.Между1946и1970;
		ТабДокумент.Области.ЖФ449.Значение = Выборка.Между1971и1995;
		ТабДокумент.Области.ЖФ549.Значение = Выборка.После1995;
	КонецЕсли;
	
	// Строка 50.
	МатериалыСтенПанельные = СписокМатериаловСтен[2].Значение;
	Если Не МатериалыСтенПанельные.Пустая() Тогда
		Запрос.УстановитьПараметр("Панельные", МатериалыСтенПанельные);
		Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Панельные";
		Выборка      = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ТабДокумент.Области.ЖФ150.Значение = Выборка.До1920;
			ТабДокумент.Области.ЖФ250.Значение = Выборка.Между1921и1945;
			ТабДокумент.Области.ЖФ350.Значение = Выборка.Между1946и1970;
			ТабДокумент.Области.ЖФ450.Значение = Выборка.Между1971и1995;
			ТабДокумент.Области.ЖФ550.Значение = Выборка.После1995;
		КонецЕсли;
	КонецЕсли;
	
	// Строка 51.
	Запрос.УстановитьПараметр("Блочные", СписокМатериаловСтен[3].Значение);
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Блочные";
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ151.Значение = Выборка.До1920;
		ТабДокумент.Области.ЖФ251.Значение = Выборка.Между1921и1945;
		ТабДокумент.Области.ЖФ351.Значение = Выборка.Между1946и1970;
		ТабДокумент.Области.ЖФ451.Значение = Выборка.Между1971и1995;
		ТабДокумент.Области.ЖФ551.Значение = Выборка.После1995;
	КонецЕсли;
	
	// Строка 52.
	МатериалыСтенМонолитные = СписокМатериаловСтен[4].Значение;
	Если Не МатериалыСтенМонолитные.Пустая() Тогда
		Запрос.УстановитьПараметр("Монолитные", МатериалыСтенМонолитные);
		Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Монолитные";
		Выборка      = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ТабДокумент.Области.ЖФ152.Значение = Выборка.До1920;
			ТабДокумент.Области.ЖФ252.Значение = Выборка.Между1921и1945;
			ТабДокумент.Области.ЖФ352.Значение = Выборка.Между1946и1970;
			ТабДокумент.Области.ЖФ452.Значение = Выборка.Между1971и1995;
			ТабДокумент.Области.ЖФ552.Значение = Выборка.После1995;
		КонецЕсли;
	КонецЕсли;
	
	// Строка 53.
	Запрос.УстановитьПараметр("Смешанные", СписокМатериаловСтен[5].Значение);
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Смешанные";
	Выборка      = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ153.Значение = Выборка.До1920;
		ТабДокумент.Области.ЖФ253.Значение = Выборка.Между1921и1945;
		ТабДокумент.Области.ЖФ353.Значение = Выборка.Между1946и1970;
		ТабДокумент.Области.ЖФ453.Значение = Выборка.Между1971и1995;
		ТабДокумент.Области.ЖФ553.Значение = Выборка.После1995;
	КонецЕсли;
	
	// Строка 54.
	Запрос.УстановитьПараметр("Деревянные", СписокМатериаловСтен[6].Значение);
	Запрос.Текст = ТекстЗапросаРезультат + "втОсновная.МатериалСтен = &Деревянные";
	Выборка      = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ТабДокумент.Области.ЖФ154.Значение = Выборка.До1920;
		ТабДокумент.Области.ЖФ254.Значение = Выборка.Между1921и1945;
		ТабДокумент.Области.ЖФ354.Значение = Выборка.Между1946и1970;
		ТабДокумент.Области.ЖФ454.Значение = Выборка.Между1971и1995;
		ТабДокумент.Области.ЖФ554.Значение = Выборка.После1995;
	КонецЕсли;
	
	// Строка 55.
	Если НЕ МатериалыСтенКаменные.Пустая()
	   И НЕ МатериалыСтенПанельные.Пустая()
	   И НЕ МатериалыСтенМонолитные.Пустая() Тогда
		Запрос.УстановитьПараметр("СписокМатериаловСтен", СписокМатериаловСтен);
		Запрос.Текст = ТекстЗапросаРезультат + "НЕ втОсновная.МатериалСтен В (&СписокМатериаловСтен)";
		Выборка      = Запрос.Выполнить().Выбрать();
		Если Выборка.Следующий() Тогда
			ТабДокумент.Области.ЖФ155.Значение = Выборка.До1920;
			ТабДокумент.Области.ЖФ255.Значение = Выборка.Между1921и1945;
			ТабДокумент.Области.ЖФ355.Значение = Выборка.Между1946и1970;
			ТабДокумент.Области.ЖФ455.Значение = Выборка.Между1971и1995;
			ТабДокумент.Области.ЖФ555.Значение = Выборка.После1995;		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры // ЗаполнитьРаздел5()

&НаСервере
// Возвращает текст запроса по разделам 4 и 5.
Функция ПолучитьТекстЗапросаПоРазделам4И5(ТаблицаЖилыхПомещений)
	
	ТекстЗапроса =
	"ВЫБРАТЬ
	|	ТаблицаЖилыхПомещений.Квартира,
	|	ТаблицаЖилыхПомещений.Здание,
	|	ТаблицаЖилыхПомещений.ЗданиеМногоквартирное,
	|	ТаблицаЖилыхПомещений.ЗданиеГодПостройки КАК ГодПостройки,
	|	ТаблицаЖилыхПомещений.ЗданиеПроцентИзноса КАК ПроцентИзноса,
	|	ТаблицаЖилыхПомещений.ЗданиеМатериалСтен КАК МатериалСтен,
	|	ТаблицаЖилыхПомещений.ОбщаяПлощадь
	|ПОМЕСТИТЬ втОсновная
	|ИЗ
	|	&ТаблицаЖилыхПомещений КАК ТаблицаЖилыхПомещений";
	
	Возврат ТекстЗапроса;
	
КонецФункции // ПолучитьТекстЗапросаПоРазделам4И5()

// Квартплата -

#КонецОбласти
