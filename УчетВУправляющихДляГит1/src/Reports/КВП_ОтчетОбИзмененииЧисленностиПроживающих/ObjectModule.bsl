
#Область СлужебныеПроцедурыИФункции

// Формирует отчет.
Процедура СформироватьОтчет(ДокументРезультат) Экспорт

	ДокументРезультат.Очистить();

	Запрос = Новый Запрос;
	Запрос.Текст = ПолучитьТекстЗапроса();
	Запрос.УстановитьПараметр("ДатаКон",     КонецДня(КонецПериода));
	Запрос.УстановитьПараметр("ДатаНач",     НачалоДня(НачалоПериода));
	Запрос.УстановитьПараметр("Организация", Организация);
	Запрос.УстановитьПараметр("ВременноеОтсутствие",
										 Перечисления.КВП_ВидыОперацийКорректировкаНачислений.ВременноеОтсутствие);
	
	ТаблицаПоЧисленностиПроживающих = Запрос.Выполнить().Выгрузить();
	
	Макет = ПолучитьМакет("Макет");

	// Вывод заголовка.
	ОбластьМакета = Макет.ПолучитьОбласть("Заголовок");
	ОбластьМакета.Параметры.Заголовок = "Заголовок";
	ДокументРезультат.Вывести(ОбластьМакета);

	ОбластьШапкаТЧ = Макет.ПолучитьОбласть("ШапкаТЧ");
	ДокументРезультат.Вывести(ОбластьШапкаТЧ);
	
	ОбластьСтрокаТЧ = Макет.ПолучитьОбласть("СтрокаТЧ");
	
	Для Каждого ТекСтрока Из ТаблицаПоЧисленностиПроживающих Цикл
		
		ОбластьСтрокаТЧ.Параметры.Заполнить(ТекСтрока);
		ОбластьСтрокаТЧ.Параметры.РассчетнаяЧисленность = ТекСтрока.КоличествоПроживающих - ТекСтрока.КоличествоОтсутствующих;
		ДокументРезультат.Вывести(ОбластьСтрокаТЧ);
		
	КонецЦикла;
	
	ДокументРезультат.Вывести(Макет.ПолучитьОбласть("ПодвалТЧ"));

КонецПроцедуры // СформироватьОтчет()

// Формирует текст запроса.
Функция ПолучитьТекстЗапроса()

	ТекстЗапроса =
	"ВЫБРАТЬ РАЗРЕШЕННЫЕ
	|	""Управляющая компания"" КАК УправляющаяКомпания,
	|	КОЛИЧЕСТВО(РАЗЛИЧНЫЕ УПЖКХ_СведенияОПроживающихСрезПоследних.Жилец) КАК КоличествоПроживающих,
	|	0 КАК КоличествоОтсутствующих
	|ИЗ
	|	РегистрСведений.УПЖКХ_СведенияОПроживающих.СрезПоследних(
	|			,
	|			Проживает = ИСТИНА
	|				И ДатаИзменения <= &ДатаНач) КАК УПЖКХ_СведенияОПроживающихСрезПоследних
	|		ЛЕВОЕ СОЕДИНЕНИЕ Документ.КВП_ОткрытиеЛицевогоСчета КАК КВП_ОткрытиеЛицевогоСчета
	|		ПО УПЖКХ_СведенияОПроживающихСрезПоследних.ЛицевойСчет = КВП_ОткрытиеЛицевогоСчета.ЛицевойСчет";

	Возврат ТекстЗапроса;
	

КонецФункции // ПолучитьТекстЗапроса()

#КонецОбласти