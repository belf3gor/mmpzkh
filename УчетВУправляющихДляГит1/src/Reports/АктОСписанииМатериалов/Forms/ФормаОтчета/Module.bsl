
&НаСервере
Процедура СформироватьНаСервере()
	
	Макет =РеквизитФормыВЗначение("Отчет").ПолучитьМакет("АктТЭУСписаниеМатериалов");    //тут получаешь макет! тоесть имя переменной в котороый макет "Макет" - теперь тут храниться шаблон макета. путь до макета .получитьМакет("имяМакета");
		//косяк 1с конструктора. просто запомни\запиши как это делаеться.
		
		Если Подразделение=Справочники.ПодразделенияОрганизаций.НайтиПоНаименованию("Кондопога Теплоэнергетический участок  ") тогда	
			Макет =РеквизитФормыВЗначение("Отчет").ПолучитьМакет("АктТЭУСписаниеМатериаловТэу");
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходМатериаловТЭУ.Период КАК Период,
		|	РасходМатериаловТЭУ.Регистратор КАК Регистратор,
		|	РасходМатериаловТЭУ.НомерСтроки КАК НомерСтроки,
		|	РасходМатериаловТЭУ.Активность КАК Активность,
		|	РасходМатериаловТЭУ.АдресПроведенияРаботы КАК АдресПроведенияРаботы,
		|	РасходМатериаловТЭУ.ТеплоУзел КАК ТеплоУзел,
		|	РасходМатериаловТЭУ.Подразделение КАК Подразделение,
		|	РасходМатериаловТЭУ.Номенклатура КАК Номенклатура,
		|	РасходМатериаловТЭУ.Количество КАК Количество,
		|	РасходМатериаловТЭУ.Цена КАК Цена,
		|	РасходМатериаловТЭУ.Сумма КАК Сумма,
		|	РасходМатериаловТЭУ.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
		|	РасходМатериаловТЭУ.Склад КАК Склад,
		|	РасходМатериаловТЭУ.ДатаНачалоРабот КАК ДатаНачалоРабот,
		|	РасходМатериаловТЭУ.ДатаОкончанияРабот КАК ДатаОкончанияРабот,
		|	РасходМатериаловТЭУ.Заказчик КАК Заказчик,
		|	РасходМатериаловТЭУ.Регистратор.Работы.(
		|		ВидРабот КАК Поле1
		|	) КАК Регистратор1,
		|	ЗаявкаНаВыполнениеРаботТЭУРаботы.ВидРабот
		|ИЗ
		|	РегистрСведений.РасходМатериаловТЭУ КАК РасходМатериаловТЭУ
		|		ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.ЗаявкаНаВыполнениеРаботТЭУ.Работы КАК ЗаявкаНаВыполнениеРаботТЭУРаботы
		|		ПО РасходМатериаловТЭУ.Регистратор = ЗаявкаНаВыполнениеРаботТЭУРаботы.Ссылка
		|ГДЕ
		|	РасходМатериаловТЭУ.Период МЕЖДУ &ДатаНач И &ДатаКонц";
	
Иначе
	   	//{{КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА
	// Данный фрагмент построен конструктором.
	// При повторном использовании конструктора, внесенные вручную изменения будут утеряны!!!
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	РасходМатериалов.Период,
		|	РасходМатериалов.Регистратор,
		|	РасходМатериалов.НомерСтроки,
		|	РасходМатериалов.Активность,
		|	РасходМатериалов.Склад,
		|	РасходМатериалов.Подразделение,
		|	РасходМатериалов.Здание,
		|	РасходМатериалов.КатегорияВыполняемыхРабот,
		|	РасходМатериалов.Номенклатура,
		|	РасходМатериалов.Цена,
		|	РасходМатериалов.Сумма,
		|	РасходМатериалов.Количество,
		|	РасходМатериалов.ЕдиницаИзмерения,
		|	РасходМатериалов.ОтветственныйЗаВыполнение,
		|	РасходМатериалов.СтатусВыполнения,
		|	РасходМатериалов.ФлагВыполнения,
		|	РасходМатериалов.МестоПроведенияРабот,
		|	РасходМатериалов.Ответственный,
		|	РасходМатериалов.ВидРаботы
		|ИЗ
		|	РегистрСведений.РасходМатериалов КАК РасходМатериалов
		|ГДЕ
		|	РасходМатериалов.Подразделение = &Подразделение
		|	И РасходМатериалов.Период МЕЖДУ &ДатаНач И &ДатаКонц";
	
		Запрос.УстановитьПараметр("Подразделение", Подразделение);
	
	
	КонецЕсли;
	
	Запрос.УстановитьПараметр("ДатаНач", период.ДатаНачала);
	Запрос.УстановитьПараметр("ДатаКонц",период.ДатаОкончания);

	
	РезультатЗапроса = Запрос.Выполнить();
	
	//тут получаешь области с макета, для дальнейшей работы. например задаем диапазон в макете и присваеваем ему имя Заголовок.    
	ОбластьЗаголовок = Макет.ПолучитьОбласть("Заголовок");
	ОбластьДеталиТаблицы = Макет.ПолучитьОбласть("ДеталиТаблицы");
	ОбластьШапкаТаблицы = Макет.ПолучитьОбласть("ШапкаТаблицы");
	ОбластьРазрывСтраницы = Макет.ПолучитьОбласть("РазрывСтраницы");
	ОбластьПодвал = Макет.ПолучитьОбласть("Подвал");
	
	ТабДок.Очистить(); //очистить табдок. что бы каждый раз новый отчет выходил
	ТабДок.АвтоМасштаб = истина;
	ТабДок.ПолеСлева = 2;
	ТабДок.ПолеСнизу = 7;
	ТабДок.ПолеСправа = 2;
	ТабДок.ПолеСверху = 7;
	табдок.ОриентацияСтраницы=ОриентацияСтраницы.Ландшафт;

	
	ТабДок.Вывести(ОбластьЗаголовок); // тут выводить областЗаголовок. 
	ТабДок.Вывести(ОбластьШапкаТаблицы);
	//ТабДок.НачатьАвтогруппировкуСтрок();      них не нужно
	
	ВыборкаДетальныеЗаписи = РезультатЗапроса.Выбрать();     // обработка запроса. 
	                 //в цикле обходиться запрос, заполняються переменные и сразу выводяться.
					 сч=0;
					 стр=0;
					 строчекНалист = 30 ;
	Пока ВыборкаДетальныеЗаписи.Следующий() Цикл
						 
		ОбластьДеталиТаблицы.Параметры.Заполнить(ВыборкаДетальныеЗаписи);
		ТабДок.Вывести(ОбластьДеталиТаблицы, ВыборкаДетальныеЗаписи.Уровень());
		сч=сч+1;
		Если стр>=1 тогда
			строчекНалист = 50;
		КонецЕсли;
		Если сч=строчекНалист тогда
			ТабДок.Вывести(ОбластьРазрывСтраницы);
			ТабДок.Вывести(ОбластьШапкаТаблицы);
			сч=0;
			стр = стр+1;
		КонецЕсли;
	КонецЦикла;
	
	пока сч<25 цикл
		ОбластьДеталиТаблицы.параметры.Номенклатура ="";
		ОбластьДеталиТаблицы.параметры.ЕдиницаИзмерения ="";
		ОбластьДеталиТаблицы.параметры.Количество ="";
		ОбластьДеталиТаблицы.параметры.ВидРабот ="";

		ТабДок.Вывести(ОбластьДеталиТаблицы);
		сч=сч+1;
		
	КонецЦикла;
	
	ТабДок.Вывести(ОбластьПодвал);
	ТабДок.Вывести(ОбластьРазрывСтраницы);

	//}}КОНСТРУКТОР_ЗАПРОСА_С_ОБРАБОТКОЙ_РЕЗУЛЬТАТА

КонецПроцедуры

&НаКлиенте
Процедура Сформировать(Команда)
	СформироватьНаСервере();
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ЗаполнитьОтветственных();
КонецПроцедуры

процедура ЗаполнитьОтветственных() 
	   //потомДоделаю
	   //НоваяСтр = Ответственные.Добавить();
	   //НоваяСтр.
	   //НоваяСтр.
	   //НоваяСтр.
КонецПроцедуры