#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область СлужебныйПрограммныйИнтерфейс

Процедура СформироватьОтчет(ПараметрыОтчета, АдресХранилища) Экспорт
	
	СтруктураПараметров = Новый Структура;
	
	Если ПараметрыОтчета.Свойство("КонецПериодаОтчета") Тогда
		КонецПериодаОтчета = ПараметрыОтчета.КонецПериодаОтчета;
		// Поддержка возможности формирования отчета за произвольный период
		СтруктураПараметров.Вставить("КонецПериодаОтчета", ПараметрыОтчета.КонецПериодаОтчета); 
	Иначе
		КонецПериодаОтчета = КонецКвартала(ПараметрыОтчета.НалоговыйПериод);
	КонецЕсли;

	ТабличныйДокумент = Новый ТабличныйДокумент;
	ТабличныйДокумент.Очистить();
	ТабличныйДокумент.КлючПараметровПечати = "ПАРАМЕТРЫ_ПЕЧАТИ_ЖурналУчетаСчетовФактур";

	СведенияОрганизации = БухгалтерскийУчетПереопределяемый.СведенияОЮрФизЛице(
		ПараметрыОтчета.Организация, КонецПериодаОтчета);
	НаименованиеОрганизацииДляПечатныхФорм = ОбщегоНазначенияБПВызовСервера.ОписаниеОрганизации(
		СведенияОрганизации, "НаименованиеДляПечатныхФорм,");
	ИННОрганизации = ОбщегоНазначенияБПВызовСервера.ОписаниеОрганизации(СведенияОрганизации, "ИНН", Ложь);
	КППОрганизации = ОбщегоНазначенияБПВызовСервера.ОписаниеОрганизации(СведенияОрганизации, "КПП", Ложь);
		
	Если ПараметрыОтчета.ЗаполнениеДекларации Тогда
		СписокОрганизацийОтбора = ПараметрыОтчета.СписокОрганизаций;
	ИначеЕсли НЕ ПараметрыОтчета.ВключатьОбособленныеПодразделения Тогда
		СписокОрганизацийОтбора = Новый СписокЗначений;
		СписокОрганизацийОтбора.Добавить(ПараметрыОтчета.Организация);
	Иначе
		СписокОрганизацийОтбора = ОбщегоНазначенияБПВызовСервераПовтИсп.ПолучитьСписокОбособленныхПодразделений(
			ПараметрыОтчета.Организация);
	КонецЕсли;
	
	СписокДоступныхОрганизаций = ОбщегоНазначенияБПВызовСервераПовтИсп.ВсеОрганизацииДанныеКоторыхДоступныПоRLS(ложь);
	
	СписокОрганизаций = Новый СписокЗначений;
	
	Для Каждого ОрганизацияСписка Из СписокОрганизацийОтбора Цикл
		Если СписокДоступныхОрганизаций.Найти(ОрганизацияСписка.Значение) <> Неопределено Тогда
			СписокОрганизаций.Добавить(ОрганизацияСписка.Значение);
		КонецЕсли;
	КонецЦикла;
	
	Организация = ?(СписокДоступныхОрганизаций.Найти(ПараметрыОтчета.Организация) <> Неопределено,
		ПараметрыОтчета.Организация, Справочники.Организации.ПустаяСсылка());
		
	ПериодОтчетаСоответствуетНалоговому = УчетНДСПереопределяемый.ПериодОтчетаСоответствуетНалоговому(
		ПараметрыОтчета.Организация, ПараметрыОтчета.НалоговыйПериод, КонецПериодаОтчета);
		
	СтруктураПараметров.Вставить("Организация", Организация);
	СтруктураПараметров.Вставить("НалоговыйПериод", ПараметрыОтчета.НалоговыйПериод);
	СтруктураПараметров.Вставить("НаименованиеОрганизацииДляПечатныхФорм", НаименованиеОрганизацииДляПечатныхФорм);
	СтруктураПараметров.Вставить("СписокОрганизаций", СписокОрганизаций);
	
	СтруктураПараметров.Вставить("СформироватьОтчетПоСтандартнойФорме",
		ПараметрыОтчета.СформироватьОтчетПоСтандартнойФорме И ПериодОтчетаСоответствуетНалоговому);
	СтруктураПараметров.Вставить("ГруппироватьПоКонтрагентам",          ПараметрыОтчета.ГруппироватьПоКонтрагентам);
	СтруктураПараметров.Вставить("ОтбиратьПоКонтрагенту",               ПараметрыОтчета.ОтбиратьПоКонтрагенту);
	СтруктураПараметров.Вставить("КонтрагентДляОтбора",                 ПараметрыОтчета.КонтрагентДляОтбора);
	СтруктураПараметров.Вставить("ЗаполнениеДекларации",                ПараметрыОтчета.ЗаполнениеДекларации);
	
	СтруктураПараметров.Вставить("ЗаполнениеДокумента",
		?(ПараметрыОтчета.Свойство("ЗаполнениеДокумента"), ПараметрыОтчета.ЗаполнениеДокумента, Ложь));
	СтруктураПараметров.Вставить("ФорматПоПостановлению735",
		?(ПараметрыОтчета.Свойство("ФорматПоПостановлению735"), ПараметрыОтчета.ФорматПоПостановлению735, Ложь));
	СтруктураПараметров.Вставить("ПравилаЗаполнения", 
		?(ПараметрыОтчета.Свойство("ПравилаЗаполнения"), ПараметрыОтчета.ПравилаЗаполнения, "2017Кв1"));
	
	ИнициализироватьТаблицыДанныхНДС(СтруктураПараметров);
	
	ВерсияПостановленияНДС1137 = УчетНДСПереопределяемый.ВерсияПостановленияНДС1137(КонецПериодаОтчета);
	Если ВерсияПостановленияНДС1137 = 4 Тогда
		Макет = ПолучитьОбщийМакет("ЖурналУчетаСчетовФактур981");
	ИначеЕсли ВерсияПостановленияНДС1137 = 3 Тогда
		Если СтруктураПараметров.ЗаполнениеДекларации
		   И СтруктураПараметров.ПравилаЗаполнения = "2017Кв1" Тогда
			Макет = ПолучитьОбщийМакет("ЖурналУчетаСчетовФактур1137_2017");
		Иначе
			Макет = ПолучитьОбщийМакет("ЖурналУчетаСчетовФактур735");
		КонецЕсли;
	Иначе
		Макет = ПолучитьОбщийМакет("ЖурналУчетаСчетовФактур1137");
	КонецЕсли;
	
	СтруктураПараметров.Вставить("ДанныеДляПроверкиКонтрагентов", ПараметрыОтчета.ДанныеДляПроверкиКонтрагентов);
	СтруктураПараметров.Вставить("ЭтоЖурналУчетаСчетовФактур",    ПараметрыОтчета.ЭтоЖурналУчетаСчетовФактур);
	
	СтруктураЗаписейЖурнала = Неопределено;
	// ИнтернетПоддержкаПользователей.РаботаСКонтрагентами
	Если ПроверкаКонтрагентов.ФормироватьОтчетСтандартнымСпособом(СтруктураПараметров, СтруктураЗаписейЖурнала) Тогда
	// Конец ИнтернетПоддержкаПользователей.РаботаСКонтрагентами
		СтруктураЗаписейЖурнала = ПолучитьЗаписиЖурналаСчетовФактур(СтруктураПараметров);
	КонецЕсли;
	
	// ШАПКА
	
	Отступ = Макет.ПолучитьОбласть("Отступ");
	
	Если СтруктураПараметров.ЗаполнениеДекларации Тогда
		
		СтруктураСекций = Новый Структура();
		СтруктураСекций.Вставить("ШапкаРаздел10", Макет.ПолучитьОбласть("ШапкаРаздел10"));
		ШапкаТаблицыРаздел10 = Макет.ПолучитьОбласть("ШапкаТаблицыРаздел10");
		ШапкаТаблицыРаздел10.Область("НомераГрафЖурналЧ1").Видимость = Ложь;
		СтруктураСекций.Вставить("ШапкаТаблицыРаздел10", ШапкаТаблицыРаздел10);
		
		ТабличныйДокумент.Вывести(СтруктураСекций.ШапкаРаздел10);
		ТабличныйДокумент.Вывести(СтруктураСекций.ШапкаТаблицыРаздел10);
		
	Иначе
		
		Если СтруктураПараметров.СформироватьОтчетПоСтандартнойФорме Тогда
			Секция = Макет.ПолучитьОбласть("ШапкаИнформация");
			ТабличныйДокумент.Вывести(Секция);
		КонецЕсли;
		
		Шапка = Макет.ПолучитьОбласть("Шапка");
		
		Шапка.Параметры.Организация = НаименованиеОрганизацииДляПечатныхФорм;
		Шапка.Параметры.ИННКПП = ИННОрганизации 
			+ ?(НЕ ЗначениеЗаполнено(КППОрганизации), "", ("/" + КППОрганизации));
		
		Если ПериодОтчетаСоответствуетНалоговому Тогда
			Шапка.Параметры.Квартал = Формат(КонецПериодаОтчета, "ДФ = к");
			Шапка.Параметры.Год     = Формат(КонецПериодаОтчета, "ДФ = гггг");
		Иначе
			Шапка.Параметры.Квартал = "-";
			Шапка.Параметры.Год     = "----";
		КонецЕсли;
		
		ТабличныйДокумент.Вывести(Шапка);
		ТабличныйДокумент.Вывести(Отступ);
		
		Часть1Заголовок = Макет.ПолучитьОбласть("Часть1Заголовок");
		Если Часть1Заголовок.Области.Найти("НомераГрафКДекларацияР10") <> Неопределено Тогда
			Часть1Заголовок.Область("НомераГрафКДекларацияР10").Видимость = Ложь;
		КонецЕсли;
		ТабличныйДокумент.Вывести(Часть1Заголовок);
		
	КонецЕсли;
	
#Область Часть1

	Часть1Строка_Обычная = Макет.ПолучитьОбласть("Часть1Строка");
	Если ВерсияПостановленияНДС1137 >= 3 Тогда
		Часть1Строка_Многострочная1 = Макет.ПолучитьОбласть("Часть1Строка_Многострочная1");
		Часть1Строка_Многострочная2 = Макет.ПолучитьОбласть("Часть1Строка_Многострочная2");
		Часть1Строка_Многострочная3 = Макет.ПолучитьОбласть("Часть1Строка_Многострочная3");
	КонецЕсли;
	
	СтрокиЧасть1 = СтруктураЗаписейЖурнала.ВыставленныеСчетаФактуры;
	
	НомерПП = 1;
	СчетчикСтрокТекущегоСегмента = 0;
	
// ГруппировкаПоКонтрагентам

	Если НЕ СтруктураПараметров.СформироватьОтчетПоСтандартнойФорме И ПараметрыОтчета.ГруппироватьПоКонтрагентам Тогда
		
		// Режим построения с группировкой по контрагенту.
		СекцияКонтрагента = Макет.ПолучитьОбласть("Контрагент");
		ГруппировкаПоКонтрагенту = СтрокиЧасть1.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		
		Если ГруппировкаПоКонтрагенту.Количество() > 0 Тогда
			
			ТабличныйДокумент.НачатьАвтогруппировкуСтрок();
			
			Пока ГруппировкаПоКонтрагенту.Следующий() Цикл
				Если УчетНДС.ВыводитьСтроку(СтруктураПараметров, ГруппировкаПоКонтрагенту, Истина) Тогда
					
					СекцияКонтрагента.Параметры.Заполнить(ГруппировкаПоКонтрагенту);
					ТабличныйДокумент.Вывести(СекцияКонтрагента, 1);
					
					ГруппировкаПоИсходнымИИсправительнымЗаписям = ГруппировкаПоКонтрагенту.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					Пока ГруппировкаПоИсходнымИИсправительнымЗаписям.Следующий() Цикл
						ГруппировкаПоСчетамФактурам = ГруппировкаПоИсходнымИИсправительнымЗаписям.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
						Пока ГруппировкаПоСчетамФактурам.Следующий() Цикл
							
							ГруппировкаПоРегистратору = ГруппировкаПоСчетамФактурам.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
							Пока ГруппировкаПоРегистратору.Следующий() Цикл
								ГруппировкаПоПризнакуСторно = ГруппировкаПоРегистратору.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
								Пока ГруппировкаПоПризнакуСторно.Следующий() Цикл
									
									СчетаФактурыЗаписи = ГруппировкаПоПризнакуСторно.Выбрать();
									КоличествоСгруппированных = СчетаФактурыЗаписи.Количество();
									
									НомерСтрокиВГруппировке = 1;
									// Итоговые данные по счету-фактуре.
									СуммаНДСИтоговая 							 = ГруппировкаПоПризнакуСторно.СуммаНДСИтоговая;
									СуммаНДСРазницаУменьшениеИтоговая 			 = ГруппировкаПоПризнакуСторно.СуммаНДСРазницаУменьшениеИтоговая;
									СуммаНДСРазницаУвеличениеИтоговая 			 = ГруппировкаПоПризнакуСторно.СуммаНДСРазницаУвеличениеИтоговая;
									
									Пока СчетаФактурыЗаписи.Следующий() Цикл
										Если УчетНДС.ВыводитьСтроку(СтруктураПараметров, СчетаФактурыЗаписи) Тогда
											ВыводитьОстатокПоСчетуФактуре = Ложь;
											
											Если ВерсияПостановленияНДС1137 >= 3 Тогда
												// Пересчитаем остаток по счету-фактуре.
												СуммаНДСИтоговая 							 = СуммаНДСИтоговая - СчетаФактурыЗаписи.СуммаНДС;
												СуммаНДСРазницаУменьшениеИтоговая 			 = СуммаНДСРазницаУменьшениеИтоговая - СчетаФактурыЗаписи.СуммаНДСРазницаУменьшение;
												СуммаНДСРазницаУвеличениеИтоговая 			 = СуммаНДСРазницаУвеличениеИтоговая - СчетаФактурыЗаписи.СуммаНДСРазницаУвеличение;
											КонецЕсли;
											
											Если КоличествоСгруппированных > 1 
												И ВерсияПостановленияНДС1137 >= 3
												И НЕ СчетаФактурыЗаписи.СводныйКорректировочный Тогда
												
												ЕстьПодстроки = Истина;
												// Переопределим макет
												Если НомерСтрокиВГруппировке = 1 Тогда 
													Часть1Строка = Часть1Строка_Многострочная1;
													Часть1Строка.Параметры.Ном = НомерПП;
													НомерПП = НомерПП + 1;
												Иначе
													Если НомерСтрокиВГруппировке < КоличествоСгруппированных Тогда
														Часть1Строка = Часть1Строка_Многострочная2;
													Иначе
														// Последняя строка
														Если НЕ СчетаФактурыЗаписи.ИсправлениеСобственнойОшибки
															И НЕ СчетаФактурыЗаписи.СводныйКомиссионный 
															И (СуммаНДСИтоговая <> 0
															ИЛИ СуммаНДСРазницаУменьшениеИтоговая <> 0
															ИЛИ СуммаНДСРазницаУвеличениеИтоговая <> 0) Тогда
															ВыводитьОстатокПоСчетуФактуре = Истина;
															Часть1Строка = Часть1Строка_Многострочная2;
														Иначе
															Часть1Строка = Часть1Строка_Многострочная3;
														КонецЕсли;
													КонецЕсли;
												КонецЕсли;
												
											Иначе
												
												ЕстьПодстроки = Ложь;
												Если ВерсияПостановленияНДС1137 >= 3
													И НЕ СчетаФактурыЗаписи.ИсправлениеСобственнойОшибки
													И НЕ СчетаФактурыЗаписи.СводныйКорректировочный
													И НЕ СчетаФактурыЗаписи.СводныйКомиссионный
													И (СуммаНДСИтоговая <> 0
													ИЛИ СуммаНДСРазницаУменьшениеИтоговая <> 0
													ИЛИ СуммаНДСРазницаУвеличениеИтоговая <> 0) Тогда
													// Если пока только один СФ от комитента.
													ВыводитьОстатокПоСчетуФактуре = Истина;
													Часть1Строка = Часть1Строка_Многострочная1;
												Иначе
													Часть1Строка = Часть1Строка_Обычная;
												КонецЕсли;
												
												Часть1Строка.Параметры.Ном = НомерПП;
												НомерПП = НомерПП + 1;
												
											КонецЕсли;
											
											ЗаполнитьСтрокуЖурналаУчетаСчетовФактур(
												Часть1Строка.Параметры, СчетаФактурыЗаписи, СтруктураПараметров, , НомерПП, ЕстьПодстроки);
											ОбластьТабличногоДокумента = ТабличныйДокумент.Вывести(Часть1Строка, 2);
											УчетНДС.ДобавитьКонтрагентаНаПроверку(СтруктураПараметров, СчетаФактурыЗаписи, ОбластьТабличногоДокумента);
											
											Если ВыводитьОстатокПоСчетуФактуре Тогда 
												СтрокаОстаток = Макет.ПолучитьОбласть("Часть1Строка_Многострочная3");
												СтрокаОстаток.Параметры.Валюта = СокрП(СчетаФактурыЗаписи.НаименованиеВалюты) + ", " + СчетаФактурыЗаписи.КодВалюты;	
												СтрокаОстаток.Параметры.СуммаДокумента = ?(ГруппировкаПоПризнакуСторно.СуммаДокумента = 0, "", ГруппировкаПоПризнакуСторно.СуммаДокумента);
												СтрокаОстаток.Параметры.СуммаНДС = ?(СуммаНДСИтоговая = 0, "", СуммаНДСИтоговая);
												СтрокаОстаток.Параметры.СуммаДокументаРазницаУменьшение = ?(ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУменьшение = 0, 
													"", ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУменьшение);
												СтрокаОстаток.Параметры.СуммаДокументаРазницаУвеличение = ?(ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУвеличение = 0, 
													"", ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУвеличение);
												СтрокаОстаток.Параметры.СуммаНДСРазницаУменьшение = ?(СуммаНДСРазницаУменьшениеИтоговая = 0, "", СуммаНДСРазницаУменьшениеИтоговая);
												СтрокаОстаток.Параметры.СуммаНДСРазницаУвеличение = ?(СуммаНДСРазницаУвеличениеИтоговая = 0, "", СуммаНДСРазницаУвеличениеИтоговая);
												ОбластьТабличногоДокумента = ТабличныйДокумент.Вывести(СтрокаОстаток, 2);
												УчетНДС.ДобавитьКонтрагентаНаПроверку(СтруктураПараметров, СчетаФактурыЗаписи, ОбластьТабличногоДокумента);
											КонецЕсли;
											
											НомерСтрокиВГруппировке = НомерСтрокиВГруппировке + 1;
										КонецЕсли;
									КонецЦикла;
								КонецЦикла;
							КонецЦикла;
						КонецЦикла;
					КонецЦикла;
				КонецЕсли;
			КонецЦикла;
			ТабличныйДокумент.ЗакончитьАвтогруппировкуСтрок();
		КонецЕсли;
		
// Конец ГруппировкаПоКонтрагентам
	
// СтандартнаяФорма
	
	Иначе
		
		ГруппировкаПоИсходнымИИсправительнымЗаписям = СтрокиЧасть1.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Пока ГруппировкаПоИсходнымИИсправительнымЗаписям.Следующий() Цикл
			ГруппировкаПоСчетамФактурам = ГруппировкаПоИсходнымИИсправительнымЗаписям.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
			Пока ГруппировкаПоСчетамФактурам.Следующий() Цикл
				
				ГруппировкаПоРегистратору = ГруппировкаПоСчетамФактурам.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
				Пока ГруппировкаПоРегистратору.Следующий() Цикл
					ГруппировкаПоПризнакуСторно = ГруппировкаПоРегистратору.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					Пока ГруппировкаПоПризнакуСторно.Следующий() Цикл
						СчетаФактурыЗаписи = ГруппировкаПоПризнакуСторно.Выбрать();
						КоличествоСгруппированных = СчетаФактурыЗаписи.Количество();
						
						НомерСтрокиВГруппировке = 1;
						// Итоговые данные по счету-фактуре
						СуммаНДСИтоговая                             = ГруппировкаПоПризнакуСторно.СуммаНДСИтоговая;
						СуммаПоСчетуФактуреРазницаУменьшениеИтоговая = ГруппировкаПоПризнакуСторно.СуммаПоСчетуФактуреРазницаУменьшениеИтоговая;
						СуммаПоСчетуФактуреРазницаУвеличениеИтоговая = ГруппировкаПоПризнакуСторно.СуммаПоСчетуФактуреРазницаУвеличениеИтоговая;
						СуммаНДСРазницаУменьшениеИтоговая            = ГруппировкаПоПризнакуСторно.СуммаНДСРазницаУменьшениеИтоговая;
						СуммаНДСРазницаУвеличениеИтоговая            = ГруппировкаПоПризнакуСторно.СуммаНДСРазницаУвеличениеИтоговая;
						
						Пока СчетаФактурыЗаписи.Следующий() Цикл
							Если УчетНДС.ВыводитьСтроку(СтруктураПараметров, СчетаФактурыЗаписи) Тогда
								
								ВыводитьОстатокПоСчетуФактуре = Ложь;
								
								Если ВерсияПостановленияНДС1137 >= 3 Тогда
									// Пересчитаем остаток по счету-фактуре
									СуммаНДСИтоговая                             = СуммаНДСИтоговая - СчетаФактурыЗаписи.СуммаНДС;
									СуммаНДСРазницаУменьшениеИтоговая            = СуммаНДСРазницаУменьшениеИтоговая - СчетаФактурыЗаписи.СуммаНДСРазницаУменьшение;
									СуммаНДСРазницаУвеличениеИтоговая            = СуммаНДСРазницаУвеличениеИтоговая - СчетаФактурыЗаписи.СуммаНДСРазницаУвеличение;
								КонецЕсли;
								
								Если КоличествоСгруппированных > 1 
									И ВерсияПостановленияНДС1137 >= 3
									И НЕ СчетаФактурыЗаписи.СводныйКорректировочный Тогда
									
									ЕстьПодстроки = Истина;
									// Переопределим макет
									Если НомерСтрокиВГруппировке = 1 Тогда 
										Часть1Строка = Часть1Строка_Многострочная1;
										Часть1Строка.Параметры.Ном = НомерПП;
										НомерПП = НомерПП + 1;
										СчетчикСтрокТекущегоСегмента = СчетчикСтрокТекущегоСегмента + 1;
									Иначе
										Если НомерСтрокиВГруппировке < КоличествоСгруппированных Тогда
											Часть1Строка = Часть1Строка_Многострочная2;
										Иначе
											// Последняя строка
											Если НЕ СчетаФактурыЗаписи.ИсправлениеСобственнойОшибки
												И НЕ СчетаФактурыЗаписи.СводныйКомиссионный
												И (СуммаНДСИтоговая <> 0
												ИЛИ СуммаНДСРазницаУменьшениеИтоговая <> 0
												ИЛИ СуммаНДСРазницаУвеличениеИтоговая <> 0) Тогда
												ВыводитьОстатокПоСчетуФактуре = Истина;
												Часть1Строка = Часть1Строка_Многострочная2;
											Иначе
												Часть1Строка = Часть1Строка_Многострочная3;
											КонецЕсли;
										КонецЕсли;
									КонецЕсли;
									
								Иначе
									
									ЕстьПодстроки = Ложь;
									Если ВерсияПостановленияНДС1137 >= 3
										И НЕ СчетаФактурыЗаписи.ИсправлениеСобственнойОшибки
										И НЕ СчетаФактурыЗаписи.СводныйКорректировочный
										И НЕ СчетаФактурыЗаписи.СводныйКомиссионный
										И (СуммаНДСИтоговая <> 0
										ИЛИ СуммаНДСРазницаУменьшениеИтоговая <> 0
										ИЛИ СуммаНДСРазницаУвеличениеИтоговая <> 0) Тогда
										// Если пока только один СФ от комитента
										ВыводитьОстатокПоСчетуФактуре = Истина;
										Часть1Строка = Часть1Строка_Многострочная1;
									Иначе
										Часть1Строка = Часть1Строка_Обычная;
									КонецЕсли;
									
									Часть1Строка.Параметры.Ном = НомерПП;
									НомерПП = НомерПП + 1;
									СчетчикСтрокТекущегоСегмента = СчетчикСтрокТекущегоСегмента + 1;
								КонецЕсли;
								
								ЗаполнитьСтрокуЖурналаУчетаСчетовФактур(
									Часть1Строка.Параметры, СчетаФактурыЗаписи, СтруктураПараметров, , НомерПП - 1, ЕстьПодстроки);
								Часть1Строка.Область(1, , Часть1Строка.ВысотаТаблицы).Имя = "Строка_" + Формат(НомерПП - 1, "ЧГ=");
								ОбластьТабличногоДокумента = ТабличныйДокумент.Вывести(Часть1Строка);
								
								УчетНДС.ДобавитьКонтрагентаНаПроверку(СтруктураПараметров, СчетаФактурыЗаписи, ОбластьТабличногоДокумента);
								
								Если ВыводитьОстатокПоСчетуФактуре Тогда 
									
									Если СтруктураПараметров.ЗаполнениеДекларации Тогда
										
										СтруктураСвПосрДеят = Новый Структура(
										"НомСчФОтПрод,ДатаСчФОтПрод,ОКВ,СтоимТовСчФВс,СумНДССчФ,РазСтКСчФУм,РазСтКСчФУв,РазНДСКСчФУм,РазНДСКСчФУв,СвПрод");
										
										СтруктураСвПосрДеят.ОКВ           = СчетаФактурыЗаписи.КодВалюты;
										
										СтруктураСвПосрДеят.СтоимТовСчФВс = ?(ГруппировкаПоПризнакуСторно.СуммаДокумента = 0,
											"", ГруппировкаПоПризнакуСторно.СуммаДокумента);
										СтруктураСвПосрДеят.СумНДССчФ     = ?(СуммаНДСИтоговая = 0, "", СуммаНДСИтоговая);
										
										СтруктураСвПосрДеят.РазСтКСчФУм   = ?(ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУменьшение = 0,
											"", ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУменьшение);
										СтруктураСвПосрДеят.РазСтКСчФУв   = ?(ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУвеличение = 0, 
											"", ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУвеличение);
										СтруктураСвПосрДеят.РазНДСКСчФУм  = ?(СуммаНДСРазницаУменьшениеИтоговая = 0, "", СуммаНДСРазницаУменьшениеИтоговая);
										СтруктураСвПосрДеят.РазНДСКСчФУв  = ?(СуммаНДСРазницаУвеличениеИтоговая = 0, "", СуммаНДСРазницаУвеличениеИтоговая);
										
										СтрокаРаздела = СтруктураПараметров.ТаблицаРаздел10[СчетчикСтрокТекущегоСегмента - 1];
										Если СтруктураПараметров.ПравилаЗаполнения = "2015Кв1" Тогда
											МассивСвПосрДеят = СтрокаРаздела.СвПосрДеят;
										ИначеЕсли СтруктураПараметров.ПравилаЗаполнения = "2017Кв1"
										      ИЛИ СтруктураПараметров.ПравилаЗаполнения = "2019Кв1" Тогда
											МассивСвПосрДеят = СтрокаРаздела.СвСчФОтПрод;
										КонецЕсли;
										МассивСвПосрДеят.Добавить(СтруктураСвПосрДеят);
										
									КонецЕсли;
									
									СтрокаОстаток = Макет.ПолучитьОбласть("Часть1Строка_Многострочная3");
									СтрокаОстаток.Параметры.Валюта = СокрП(СчетаФактурыЗаписи.НаименованиеВалюты) + ", " + СчетаФактурыЗаписи.КодВалюты;
									СтрокаОстаток.Параметры.СуммаДокумента = ?(ГруппировкаПоПризнакуСторно.СуммаДокумента = 0,
										"", ГруппировкаПоПризнакуСторно.СуммаДокумента);
									СтрокаОстаток.Параметры.СуммаНДС = ?(СуммаНДСИтоговая = 0, "", СуммаНДСИтоговая);
									СтрокаОстаток.Параметры.СуммаДокументаРазницаУменьшение = ?(ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУменьшение = 0, 
										"", ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУменьшение);
									СтрокаОстаток.Параметры.СуммаДокументаРазницаУвеличение = ?(ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУвеличение = 0, 
										"", ГруппировкаПоПризнакуСторно.СуммаДокументаРазницаУвеличение);
									СтрокаОстаток.Параметры.СуммаНДСРазницаУменьшение = ?(СуммаНДСРазницаУменьшениеИтоговая = 0, "", СуммаНДСРазницаУменьшениеИтоговая);
									СтрокаОстаток.Параметры.СуммаНДСРазницаУвеличение = ?(СуммаНДСРазницаУвеличениеИтоговая = 0, "", СуммаНДСРазницаУвеличениеИтоговая);
									ОбластьТабличногоДокумента = ТабличныйДокумент.Вывести(СтрокаОстаток);
									УчетНДС.ДобавитьКонтрагентаНаПроверку(СтруктураПараметров, СчетаФактурыЗаписи, ОбластьТабличногоДокумента);
								КонецЕсли;
								
								НомерСтрокиВГруппировке = НомерСтрокиВГруппировке + 1;
								
								Если СтруктураПараметров.ЗаполнениеДекларации 
									И СчетчикСтрокТекущегоСегмента = ПараметрыОтчета.ПредельноеКоличествоЗаписейВРазделеДекларацииПоНДС Тогда
									
									// Запишем сегмент
									ПерваяСтрокаСегмента = НомерПП - СчетчикСтрокТекущегоСегмента;
									
									РегламентированнаяОтчетность.ЗаписатьСегментДанныхРазделаДекларацииНДС(
									ПараметрыОтчета.СсылкаНаДекларацию,
									"Раздел10",
									ПерваяСтрокаСегмента,
									СтруктураПараметров.ТаблицаРаздел10);
									
									РегламентированнаяОтчетность.ЗаписатьСегментТабличногоДокументаРазделаДекларацииНДС(
									ПараметрыОтчета.СсылкаНаДекларацию,
									"Раздел10",
									ПерваяСтрокаСегмента,
									ТабличныйДокумент);
									
									// Очистим табличный документ и таблицу
									ТабличныйДокумент.Очистить();
									ТабличныйДокумент.Вывести(СтруктураСекций.ШапкаРаздел10);
									ТабличныйДокумент.Вывести(СтруктураСекций.ШапкаТаблицыРаздел10);
									
									СтруктураПараметров.ТаблицаРаздел10.Очистить();
									
									// Обнулим счетчик текущего сегмента
									СчетчикСтрокТекущегоСегмента = 0;
									
								КонецЕсли;
								
							КонецЕсли;
						КонецЦикла;
					КонецЦикла;
				КонецЦикла;
			КонецЦикла;
		КонецЦикла;
		
	КонецЕсли;
	
// Конец СтандартнаяФорма 
	
	// Запишем последний сегмент
	
	Если СтруктураПараметров.ЗаполнениеДекларации
		И СчетчикСтрокТекущегоСегмента <> 0
		И СчетчикСтрокТекущегоСегмента <> ПараметрыОтчета.ПредельноеКоличествоЗаписейВРазделеДекларацииПоНДС Тогда
		
		// Записать сегменты
		ПерваяСтрокаСегмента = НомерПП - СчетчикСтрокТекущегоСегмента;
		
		РегламентированнаяОтчетность.ЗаписатьСегментДанныхРазделаДекларацииНДС(
			ПараметрыОтчета.СсылкаНаДекларацию,
			"Раздел10",
			ПерваяСтрокаСегмента,
			СтруктураПараметров.ТаблицаРаздел10);
		
		РегламентированнаяОтчетность.ЗаписатьСегментТабличногоДокументаРазделаДекларацииНДС(
			ПараметрыОтчета.СсылкаНаДекларацию,
			"Раздел10",
			ПерваяСтрокаСегмента,
			ТабличныйДокумент);
		
	КонецЕсли;
	
#КонецОбласти

#Область Часть2

	Если СтруктураПараметров.ЗаполнениеДекларации Тогда
	
		ТабличныйДокумент = Новый ТабличныйДокумент;
		
		СтруктураСекций.Вставить("ШапкаРаздел11", Макет.ПолучитьОбласть("ШапкаРаздел11"));
		ШапкаТаблицыРаздел11 = Макет.ПолучитьОбласть("ШапкаТаблицыРаздел11");
		ШапкаТаблицыРаздел11.Область("НомераГрафЖурналЧ2").Видимость = Ложь;
		СтруктураСекций.Вставить("ШапкаТаблицыРаздел11", ШапкаТаблицыРаздел11);
		ТабличныйДокумент.Вывести(СтруктураСекций.ШапкаРаздел11);
		ТабличныйДокумент.Вывести(СтруктураСекций.ШапкаТаблицыРаздел11);
		
	Иначе
		
		ТабличныйДокумент.Вывести(Отступ);
		Часть2Заголовок = Макет.ПолучитьОбласть("Часть2Заголовок");
		Если Часть2Заголовок.Области.Найти("НомераГрафКДекларацияР11") <> Неопределено Тогда
			Часть2Заголовок.Область("НомераГрафКДекларацияР11").Видимость = Ложь;
		КонецЕсли;
		ТабличныйДокумент.Вывести(Часть2Заголовок);
		
	КонецЕсли;
	
	Часть2Строка = Макет.ПолучитьОбласть("Часть2Строка");
	
	СтрокиЧасть2 = СтруктураЗаписейЖурнала.ПолученныеСчетаФактуры;
	ДополнительныеСвойства = СтруктураЗаписейЖурнала.ДополнительныеСвойства;
	ДополнительныеСвойства.Индексы.Добавить("СчетФактура");
	
	НомерПП = 1;
	СчетчикСтрокТекущегоСегмента = 0;
	
	Если НЕ СтруктураПараметров.СформироватьОтчетПоСтандартнойФорме И ПараметрыОтчета.ГруппироватьПоКонтрагентам Тогда
		// Режим построения с группировкой по контрагенту.
		СекцияКонтрагента = Макет.ПолучитьОбласть("Контрагент");
		ГруппировкаПоКонтрагенту = СтрокиЧасть2.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
		Если ГруппировкаПоКонтрагенту.Количество() > 0 Тогда
			ТабличныйДокумент.НачатьАвтогруппировкуСтрок();
			Пока ГруппировкаПоКонтрагенту.Следующий() Цикл
				Если УчетНДС.ВыводитьСтроку(СтруктураПараметров, ГруппировкаПоКонтрагенту, Истина) Тогда
					СекцияКонтрагента.Параметры.Заполнить(ГруппировкаПоКонтрагенту);
					ТабличныйДокумент.Вывести(СекцияКонтрагента, 1);
					ГруппировкаПоСчетуФактуре = ГруппировкаПоКонтрагенту.Выбрать(ОбходРезультатаЗапроса.ПоГруппировкам);
					Пока ГруппировкаПоСчетуФактуре.Следующий() Цикл
						Если УчетНДС.ВыводитьСтроку(СтруктураПараметров, ГруппировкаПоСчетуФактуре) Тогда
							ЗаполнитьСтрокуЖурналаУчетаСчетовФактур(
								Часть2Строка.Параметры, ГруппировкаПоСчетуФактуре, СтруктураПараметров, ДополнительныеСвойства, НомерПП);
							ОбластьТабличногоДокумента = ТабличныйДокумент.Вывести(Часть2Строка, 2);
							УчетНДС.ДобавитьКонтрагентаНаПроверку(СтруктураПараметров, ГруппировкаПоСчетуФактуре, ОбластьТабличногоДокумента);
							НомерПП = НомерПП + 1;
						КонецЕсли;
					КонецЦикла;
				КонецЕсли;
			КонецЦикла;
			ТабличныйДокумент.ЗакончитьАвтогруппировкуСтрок();
		КонецЕсли;
	Иначе
		
		Выборка = СтрокиЧасть2.Выбрать();
		Пока Выборка.Следующий() Цикл
			
			Если УчетНДС.ВыводитьСтроку(СтруктураПараметров, Выборка) Тогда 
				ЗаполнитьСтрокуЖурналаУчетаСчетовФактур(
					Часть2Строка.Параметры, Выборка, СтруктураПараметров, ДополнительныеСвойства, НомерПП);
				Часть2Строка.Область(1, , Часть2Строка.ВысотаТаблицы).Имя = "Строка_" + Формат(НомерПП, "ЧГ=");
				Часть2Строка.Параметры.Ном = НомерПП;
				ОбластьТабличногоДокумента = ТабличныйДокумент.Вывести(Часть2Строка);
				УчетНДС.ДобавитьКонтрагентаНаПроверку(СтруктураПараметров, Выборка, ОбластьТабличногоДокумента);
				
				НомерПП = НомерПП + 1;
				СчетчикСтрокТекущегоСегмента = СчетчикСтрокТекущегоСегмента + 1;
				
				// Запись сегмента.
				
				Если СтруктураПараметров.ЗаполнениеДекларации 
					И СчетчикСтрокТекущегоСегмента = ПараметрыОтчета.ПредельноеКоличествоЗаписейВРазделеДекларацииПоНДС Тогда
					
					// Запишем сегмент.
					ПерваяСтрокаСегмента = НомерПП - СчетчикСтрокТекущегоСегмента;
					
					РегламентированнаяОтчетность.ЗаписатьСегментДанныхРазделаДекларацииНДС(
						ПараметрыОтчета.СсылкаНаДекларацию,
						"Раздел11",
						ПерваяСтрокаСегмента,
						СтруктураПараметров.ТаблицаРаздел11);
					
					РегламентированнаяОтчетность.ЗаписатьСегментТабличногоДокументаРазделаДекларацииНДС(
						ПараметрыОтчета.СсылкаНаДекларацию,
						"Раздел11",
						ПерваяСтрокаСегмента,
						ТабличныйДокумент);
					
					// Очистим табличный документ и таблицу.
					ТабличныйДокумент.Очистить();
					ТабличныйДокумент.Вывести(СтруктураСекций.ШапкаРаздел11);
					ТабличныйДокумент.Вывести(СтруктураСекций.ШапкаТаблицыРаздел11);
					
					СтруктураПараметров.ТаблицаРаздел11.Очистить();
					
					// Обнулим счетчик текущего сегмента.
					СчетчикСтрокТекущегоСегмента = 0;
					
				КонецЕсли;
				
			КонецЕсли;
		
		КонецЦикла;
		
	КонецЕсли;
	
	// Запишем последний сегмент.
	
	Если СтруктураПараметров.ЗаполнениеДекларации
		И СчетчикСтрокТекущегоСегмента <> 0
		И СчетчикСтрокТекущегоСегмента <> ПараметрыОтчета.ПредельноеКоличествоЗаписейВРазделеДекларацииПоНДС Тогда
		
		// Записать сегменты.
		ПерваяСтрокаСегмента = НомерПП - СчетчикСтрокТекущегоСегмента;
		
		РегламентированнаяОтчетность.ЗаписатьСегментДанныхРазделаДекларацииНДС(
			ПараметрыОтчета.СсылкаНаДекларацию,
			"Раздел11",
			ПерваяСтрокаСегмента,
			СтруктураПараметров.ТаблицаРаздел11);
		
		РегламентированнаяОтчетность.ЗаписатьСегментТабличногоДокументаРазделаДекларацииНДС(
			ПараметрыОтчета.СсылкаНаДекларацию,
			"Раздел11",
			ПерваяСтрокаСегмента,
			ТабличныйДокумент);
		
	КонецЕсли;

	ТабличныйДокумент.Вывести(Отступ);
	
#КонецОбласти
	
	// ПОДВАЛ
	
	ОтветственныеЛица = ОтветственныеЛицаБП.ОтветственныеЛица(СтруктураПараметров.Организация, КонецКвартала(СтруктураПараметров.НалоговыйПериод));
	Если ОбщегоНазначенияБПВызовСервераПовтИсп.ЭтоЮрЛицо(СтруктураПараметров.Организация) Тогда
		ИмяРук = ОтветственныеЛица.РуководительПредставление;
		ИмяОрг = "";
		Свидетельство = "";
	Иначе
		ИмяРук = "";
		ИмяОрг = ОтветственныеЛица.РуководительПредставление;
		СведенияОЮрФизЛице = БухгалтерскийУчетПереопределяемый.СведенияОЮрФизЛице(
			СтруктураПараметров.Организация, КонецПериодаОтчета);
		Свидетельство = СведенияОЮрФизЛице.Свидетельство;
	КонецЕсли;
		
	Если СтруктураПараметров.СформироватьОтчетПоСтандартнойФорме
		И НЕ СтруктураПараметров.ЗаполнениеДекларации Тогда
		
		Подвал = Макет.ПолучитьОбласть("Подвал");
		
		Подвал.Параметры.ИмяРук = ИмяРук;
		Подвал.Параметры.ИмяОрг = ИмяОрг;
		Подвал.Параметры.Свидетельство = Свидетельство;

		ТабличныйДокумент.Вывести(Подвал);
		
	КонецЕсли;
	
	УправлениеКолонтитулами.УстановитьКолонтитулы(ТабличныйДокумент);
	
	СтруктураПараметров.Вставить("СформированныйЖурнал", ТабличныйДокумент);
	
	Результат = СтруктураПараметров;
	
	ПоместитьВоВременноеХранилище(Результат, АдресХранилища);
	
КонецПроцедуры

Функция ПолучитьЗаписиЖурналаСчетовФактур(СтруктураПараметров) Экспорт
	Перем СформироватьОтчетПоСтандартнойФорме;
	Перем ГруппироватьПоКонтрагентам;
	Перем ОтбиратьПоКонтрагенту;
	Перем КонтрагентДляОтбора, МассивКонтрагентовДляОтбора;
	Перем КонецПериодаОтчета;
	
	Если НЕ СтруктураПараметров.Свойство("СформироватьОтчетПоСтандартнойФорме", СформироватьОтчетПоСтандартнойФорме) Тогда
		СформироватьОтчетПоСтандартнойФорме = Истина;
	КонецЕсли;
	
	Если НЕ СтруктураПараметров.Свойство("ЗаполнениеДекларации") Тогда
		СтруктураПараметров.Вставить("ЗаполнениеДекларации", Ложь);
	ИначеЕсли СтруктураПараметров.ЗаполнениеДекларации И СтруктураПараметров.НалоговыйПериод < '20150101' Тогда
		СтруктураПараметров.ЗаполнениеДекларации = Ложь;
	КонецЕсли;
	
	Если НЕ СтруктураПараметров.Свойство("ГруппироватьПоКонтрагентам", ГруппироватьПоКонтрагентам) Тогда
		ГруппироватьПоКонтрагентам = Ложь;
	КонецЕсли;
	ГруппироватьПоКонтрагентам = НЕ СформироватьОтчетПоСтандартнойФорме И ГруппироватьПоКонтрагентам;
		
	Если НЕ СтруктураПараметров.Свойство("ОтбиратьПоКонтрагенту", ОтбиратьПоКонтрагенту) Тогда
		ОтбиратьПоКонтрагенту = Ложь;
	КонецЕсли;
	
	ОтбиратьПоКонтрагенту = НЕ СформироватьОтчетПоСтандартнойФорме И ОтбиратьПоКонтрагенту;
	
	Если ОтбиратьПоКонтрагенту И СтруктураПараметров.Свойство("КонтрагентДляОтбора", КонтрагентДляОтбора) Тогда
		
		// Массив контрагентов и их обособленных подразделений.
		Запрос = Новый Запрос;
		Запрос.УстановитьПараметр("Контрагент", КонтрагентДляОтбора);
		Запрос.Текст = 
		"ВЫБРАТЬ РАЗРЕШЕННЫЕ
		|	Контрагенты.Ссылка КАК Контрагент
		|ИЗ
		|	Справочник.Контрагенты КАК Контрагенты
		|ГДЕ
		|	(НЕ Контрагенты.ОбособленноеПодразделение
		|				И Контрагенты.Ссылка В ИЕРАРХИИ (&Контрагент)
		|			ИЛИ Контрагенты.ОбособленноеПодразделение
		|				И Контрагенты.ГоловнойКонтрагент В ИЕРАРХИИ (&Контрагент))";
		
		Результат = Запрос.Выполнить();
		МассивКонтрагентовДляОтбора = Результат.Выгрузить().ВыгрузитьКолонку("Контрагент");
		
	КонецЕсли;
	
	Запрос = Новый Запрос;
	Запрос.МенеджерВременныхТаблиц = Новый МенеджерВременныхТаблиц;
	Запрос.УстановитьПараметр("СписокОрганизаций",  СтруктураПараметров.СписокОрганизаций);
	Запрос.УстановитьПараметр("Квартал",            НачалоКвартала(СтруктураПараметров.НалоговыйПериод));
	Запрос.УстановитьПараметр("МассивКонтрагентов", МассивКонтрагентовДляОтбора);
	
	// Поддержка возможности формирования отчета за произвольный период, ограниченный кварталом.
	Если СтруктураПараметров.Свойство("КонецПериодаОтчета", КонецПериодаОтчета) Тогда
		Запрос.УстановитьПараметр("НачПериода", НачалоДня(СтруктураПараметров.НалоговыйПериод));
		Запрос.УстановитьПараметр("КонПериода", КонецДня(СтруктураПараметров.КонецПериодаОтчета));
	Иначе
		Запрос.УстановитьПараметр("НачПериода", НачалоКвартала(СтруктураПараметров.НалоговыйПериод));
		Запрос.УстановитьПараметр("КонПериода", КонецКвартала(СтруктураПараметров.НалоговыйПериод));
	КонецЕсли;
	
	ВерсияПостановленияНДС1137 = УчетНДСПереопределяемый.ВерсияПостановленияНДС1137(СтруктураПараметров.НалоговыйПериод);
	Запрос.УстановитьПараметр("ПравилаПостановления735", ВерсияПостановленияНДС1137 >= 3);
	
	// Для совместимости с УП.
	МассивПустыеСсылкиСчетовФактур = Новый Массив;
	ТипыРесурса = Метаданные.РегистрыСведений.ЖурналУчетаСчетовФактур.Измерения.СчетФактураВыданныйПокупателю.Тип.Типы();
	Для Каждого ТекущийТип Из ТипыРесурса Цикл
		МассивПустыеСсылкиСчетовФактур.Добавить(Документы[Метаданные.НайтиПоТипу(ТекущийТип).Имя].ПустаяСсылка());
	КонецЦикла;
	Если МассивПустыеСсылкиСчетовФактур.Количество() > 1 Тогда
		// Для составных типов может быть не выбрано ничего.
		МассивПустыеСсылкиСчетовФактур.Добавить(Неопределено);
	КонецЕсли;
	Запрос.УстановитьПараметр("МассивПустыеСсылкиСчетовФактур", МассивПустыеСсылкиСчетовФактур);
	
	Если ВерсияПостановленияНДС1137 >= 4 Тогда
		Запрос.Текст = ТекстЗапросаЖурналСчетовФактур981();
	Иначе
		Запрос.Текст = ТекстЗапросаЖурналСчетовФактур1137();
	КонецЕсли;
	
	Если ОтбиратьПоКонтрагенту Тогда
		Если ПолучитьФункциональнуюОпцию("ОсуществляетсяРеализацияТоваровУслугЧерезКомиссионеров")
			Или ПолучитьФункциональнуюОпцию("ОсуществляетсяЗакупкаТоваровУслугЧерезКомиссионеров") Тогда
			ОтборПоКонтрагенту = "И (Контрагент В (&МассивКонтрагентов)
			|					ИЛИ ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
			|						И Продавец В (&МассивКонтрагентов))";
		Иначе
			ОтборПоКонтрагенту = "И Контрагент В (&МассивКонтрагентов)";
		КонецЕсли;
	Иначе
		ОтборПоКонтрагенту = "";
	КонецЕсли;
	Запрос.Текст = СтрЗаменить(Запрос.Текст, "И &ОтборПоКонтрагенту", ОтборПоКонтрагенту);
	
	УстановитьПривилегированныйРежим(Истина);
	Запрос.Выполнить();
	
	// Выданные счета-фактуры сортируем по дате передачи и далее по номеру с учетом префиксов,
	// чтобы обеспечить правильную сортировку для номеров разной значности.
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КонтрагентСсылка КАК Ссылка,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаСведений
	|ПОМЕСТИТЬ СсылкиНаДаты
	|ИЗ
	|	ВТ_ЖурналУчетаСчетовФактур КАК ЗаписиРегистраЖурналУчетаСчетовФактур
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КомитентСсылка,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаСведений
	|ИЗ
	|	ВТ_ЖурналУчетаСчетовФактур КАК ЗаписиРегистраЖурналУчетаСчетовФактур
	|
	|ОБЪЕДИНИТЬ
	|
	|ВЫБРАТЬ
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СубкомиссионерСсылка,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаСведений
	|ИЗ
	|	ВТ_ЖурналУчетаСчетовФактур КАК ЗаписиРегистраЖурналУчетаСчетовФактур
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	Ссылка";
	
	Запрос.Выполнить();
	
	УчетНДС.РегистрационныеСведенияНаДаты(Запрос.МенеджерВременныхТаблиц);
	
	Запрос.Текст = 
	"ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВТ_ЖурналУчетаСчетовФактур.КонтрагентСсылка КАК Контрагент,
	|	ВТ_ЖурналУчетаСчетовФактур.СчетФактура КАК СчетФактура,
	|	ОшибочныеРеквизитыКонтрагентовСрезПоследних.ИНН,
	|	ОшибочныеРеквизитыКонтрагентовСрезПоследних.КПП
	|ПОМЕСТИТЬ ОшибочныеРеквизитыКонтрагентов
	|ИЗ
	|	РегистрСведений.ОшибочныеРеквизитыКонтрагентов.СрезПоследних КАК ОшибочныеРеквизитыКонтрагентовСрезПоследних
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЖурналУчетаСчетовФактур КАК ВТ_ЖурналУчетаСчетовФактур
	|		ПО ОшибочныеРеквизитыКонтрагентовСрезПоследних.СчетФактура = ВТ_ЖурналУчетаСчетовФактур.СчетФактура
	|			И ОшибочныеРеквизитыКонтрагентовСрезПоследних.Контрагент = ВТ_ЖурналУчетаСчетовФактур.КонтрагентСсылка
	|ГДЕ
	|	ВТ_ЖурналУчетаСчетовФактур.СчетФактура ЕСТЬ НЕ NULL 
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВТ_ЖурналУчетаСчетовФактур.КомитентСсылка КАК Комитент,
	|	ВТ_ЖурналУчетаСчетовФактур.СчетФактураПолученныйОтПродавца КАК СчетФактура,
	|	ОшибочныеРеквизитыКонтрагентовСрезПоследних.ИНН,
	|	ОшибочныеРеквизитыКонтрагентовСрезПоследних.КПП
	|ПОМЕСТИТЬ ОшибочныеРеквизитыКомитентов
	|ИЗ
	|	РегистрСведений.ОшибочныеРеквизитыКонтрагентов.СрезПоследних КАК ОшибочныеРеквизитыКонтрагентовСрезПоследних
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЖурналУчетаСчетовФактур КАК ВТ_ЖурналУчетаСчетовФактур
	|		ПО ОшибочныеРеквизитыКонтрагентовСрезПоследних.СчетФактура = ВТ_ЖурналУчетаСчетовФактур.СчетФактураПолученныйОтПродавца
	|			И ОшибочныеРеквизитыКонтрагентовСрезПоследних.Контрагент = ВТ_ЖурналУчетаСчетовФактур.КомитентСсылка
	|ГДЕ
	|	ВТ_ЖурналУчетаСчетовФактур.СчетФактура ЕСТЬ НЕ NULL 
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ РАЗЛИЧНЫЕ
	|	ВТ_ЖурналУчетаСчетовФактур.СубкомиссионерСсылка КАК Субкомиссионер,
	|	ВТ_ЖурналУчетаСчетовФактур.СчетФактура КАК СчетФактура,
	|	ОшибочныеРеквизитыКонтрагентовСрезПоследних.ИНН,
	|	ОшибочныеРеквизитыКонтрагентовСрезПоследних.КПП
	|ПОМЕСТИТЬ ОшибочныеРеквизитыСубкомиссионеров
	|ИЗ
	|	РегистрСведений.ОшибочныеРеквизитыКонтрагентов.СрезПоследних КАК ОшибочныеРеквизитыКонтрагентовСрезПоследних
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_ЖурналУчетаСчетовФактур КАК ВТ_ЖурналУчетаСчетовФактур
	|		ПО ОшибочныеРеквизитыКонтрагентовСрезПоследних.СчетФактура = ВТ_ЖурналУчетаСчетовФактур.СчетФактура
	|			И ОшибочныеРеквизитыКонтрагентовСрезПоследних.Контрагент = ВТ_ЖурналУчетаСчетовФактур.СубкомиссионерСсылка
	|ГДЕ
	|	ВТ_ЖурналУчетаСчетовФактур.СчетФактура ЕСТЬ НЕ NULL 
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура";
	
	Запрос.Выполнить();
	
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактур.Организация КАК Организация,
	|	ЖурналУчетаСчетовФактур.СчетФактура КАК СчетФактураДокумент,
	|	ЖурналУчетаСчетовФактур.ДатаВыставленияПолучения КАК ДатаПередачиПолучения,
	|	ЖурналУчетаСчетовФактур.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.КонтрагентСсылка КАК Контрагент,
	|	ЕСТЬNULL(СведенияОКонтрагентах.Наименование, """") КАК КонтрагентНаименование,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыКонтрагентов.ИНН ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыКонтрагентов.ИНН
	|		КОГДА ЖурналУчетаСчетовФактур.ИННКонтрагента ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОКонтрагентах.ИНН, """")
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.ИННКонтрагента
	|	КОНЕЦ КАК КонтрагентИНН,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыКонтрагентов.КПП ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыКонтрагентов.КПП
	|		КОГДА ЖурналУчетаСчетовФактур.КППКонтрагента ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОКонтрагентах.КПП, """")
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.КППКонтрагента
	|	КОНЕЦ КАК КонтрагентКПП,
	|	ЖурналУчетаСчетовФактур.Валюта.НаименованиеПолное КАК НаименованиеВалюты,
	|	ЖурналУчетаСчетовФактур.Валюта.Код КАК КодВалюты,
	|	ЖурналУчетаСчетовФактур.Валюта.Наименование КАК НаименованиеВалютыКраткое,
	|	ЖурналУчетаСчетовФактур.ЧастьЖурнала КАК ЧастьЖурнала,
	|	ЖурналУчетаСчетовФактур.КодВидаОперации КАК КодВидаОперации,
	|	ЖурналУчетаСчетовФактур.ПоСтавкеБезНДС КАК СчетФактураБезНДС,
	|	ЖурналУчетаСчетовФактур.КодСпособаВыставленияПолучения КАК КодСпособаВыставления,
	|	ЖурналУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерИсправления КАК НомерИсправления,
	|	ЖурналУчетаСчетовФактур.ДатаИсправления КАК ДатаИсправления,
	|	ЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.СчетФактураНеВыставляется КАК СчетФактураНеВыставляется,
	|	ЖурналУчетаСчетовФактур.КорректировочныйСчетФактура КАК КорректировочныйСчетФактура,
	|	ЖурналУчетаСчетовФактур.СчетФактураВыданныйНомер КАК СчетФактураВыданныйНомер,
	|	ЖурналУчетаСчетовФактур.КодВидаСделки КАК КодВидаСделки,
	|	ЖурналУчетаСчетовФактур.КомитентСсылка КАК КомитентСсылка,
	|	ЕСТЬNULL(СведенияОКомитентах.Наименование, """") КАК Комитент,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыКомитентов.ИНН ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыКомитентов.ИНН
	|		КОГДА ЖурналУчетаСчетовФактур.ИННКомитента ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОКомитентах.ИНН, """")
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.ИННКомитента
	|	КОНЕЦ КАК КомитентИНН,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыКомитентов.КПП ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыКомитентов.КПП
	|		КОГДА ЖурналУчетаСчетовФактур.КППКомитента ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОКомитентах.КПП, """")
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.КППКомитента
	|	КОНЕЦ КАК КомитентКПП,
	|	ЖурналУчетаСчетовФактур.НомерСчетаФактурыКомитента КАК НомерСчетаФактурыКомитента,
	|	ЖурналУчетаСчетовФактур.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЖурналУчетаСчетовФактур.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЖурналУчетаСчетовФактур.ДатаСчетаФактурыКомитента КАК ДатаСчетаФактурыКомитента,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшение) КАК СуммаДокументаРазницаУменьшение,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличение) КАК СуммаДокументаРазницаУвеличение,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаНДСРазницаУменьшение) КАК СуммаНДСРазницаУменьшение,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаНДСРазницаУвеличение) КАК СуммаНДСРазницаУвеличение,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуре) КАК СуммаДокумента,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаНДС) КАК СуммаНДС,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаНДСИтоговая) КАК СуммаНДСИтоговая,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшениеИтоговая) КАК СуммаПоСчетуФактуреРазницаУменьшениеИтоговая,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличениеИтоговая) КАК СуммаПоСчетуФактуреРазницаУвеличениеИтоговая,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаНДСРазницаУменьшениеИтоговая) КАК СуммаНДСРазницаУменьшениеИтоговая,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаНДСРазницаУвеличениеИтоговая) КАК СуммаНДСРазницаУвеличениеИтоговая,
	|	ЖурналУчетаСчетовФактур.ИсправлениеСобственнойОшибки КАК ИсправлениеСобственнойОшибки,
	|	ЖурналУчетаСчетовФактур.Период КАК Период,
	|	ЖурналУчетаСчетовФактур.СчетФактураПолученныйОтПродавца КАК СчетФактураПолученныйОтПродавца,
	|	ОшибочныеРеквизитыКомитентов.ИНН КАК ИННКомитента,
	|	ОшибочныеРеквизитыКонтрагентов.ИНН КАК ИННКонтрагента,
	|	ЖурналУчетаСчетовФактур.Сторно КАК Сторно,
	|	ЖурналУчетаСчетовФактур.ИсправленныйСчетФактура КАК ИсправленныйСчетФактура,
	|	ЖурналУчетаСчетовФактур.Регистратор КАК Регистратор,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреКомиссия) КАК СуммаДокументаКомиссия,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия) КАК СуммаДокументаРазницаУменьшениеКомиссия,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия) КАК СуммаДокументаРазницаУвеличениеКомиссия
	|ПОМЕСТИТЬ ЗаписиРегистраЖурналУчетаСчетовФактур
	|ИЗ
	|	ВТ_ЖурналУчетаСчетовФактур КАК ЖурналУчетаСчетовФактур
	|		ЛЕВОЕ СОЕДИНЕНИЕ ОшибочныеРеквизитыКонтрагентов КАК ОшибочныеРеквизитыКонтрагентов
	|		ПО ЖурналУчетаСчетовФактур.СчетФактура = ОшибочныеРеквизитыКонтрагентов.СчетФактура
	|			И ЖурналУчетаСчетовФактур.КонтрагентСсылка = ОшибочныеРеквизитыКонтрагентов.Контрагент
	|		ЛЕВОЕ СОЕДИНЕНИЕ ОшибочныеРеквизитыКомитентов КАК ОшибочныеРеквизитыКомитентов
	|		ПО ЖурналУчетаСчетовФактур.СчетФактураПолученныйОтПродавца = ОшибочныеРеквизитыКомитентов.СчетФактура
	|			И ЖурналУчетаСчетовФактур.КомитентСсылка = ОшибочныеРеквизитыКомитентов.Комитент
	|		ЛЕВОЕ СОЕДИНЕНИЕ СведенияОСсылкахНаДаты КАК СведенияОКонтрагентах
	|		ПО ЖурналУчетаСчетовФактур.КонтрагентСсылка = СведенияОКонтрагентах.Ссылка
	|			И ЖурналУчетаСчетовФактур.ДатаСведений = СведенияОКонтрагентах.ДатаСведений
	|		ЛЕВОЕ СОЕДИНЕНИЕ СведенияОСсылкахНаДаты КАК СведенияОКомитентах
	|		ПО ЖурналУчетаСчетовФактур.КомитентСсылка = СведенияОКомитентах.Ссылка
	|			И ЖурналУчетаСчетовФактур.ДатаСведений = СведенияОКомитентах.ДатаСведений
	|
	|СГРУППИРОВАТЬ ПО
	|	ЖурналУчетаСчетовФактур.Организация,
	|	ЖурналУчетаСчетовФактур.СчетФактура,
	|	ЖурналУчетаСчетовФактур.ДатаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактур.ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.КонтрагентСсылка,
	|	ЖурналУчетаСчетовФактур.КомитентСсылка,
	|	ЕСТЬNULL(СведенияОКонтрагентах.Наименование, """"),
	|	ЖурналУчетаСчетовФактур.Валюта.НаименованиеПолное,
	|	ЖурналУчетаСчетовФактур.Валюта.Наименование,
	|	ЖурналУчетаСчетовФактур.Валюта.Код,
	|	ЖурналУчетаСчетовФактур.ЧастьЖурнала,
	|	ЖурналУчетаСчетовФактур.КодВидаОперации,
	|	ЖурналУчетаСчетовФактур.ПоСтавкеБезНДС,
	|	ЖурналУчетаСчетовФактур.КодСпособаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.НомерИсправления,
	|	ЖурналУчетаСчетовФактур.ДатаИсправления,
	|	ЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактур.СчетФактураНеВыставляется,
	|	ЖурналУчетаСчетовФактур.КорректировочныйСчетФактура,
	|	ЖурналУчетаСчетовФактур.СчетФактураВыданныйНомер,
	|	ЖурналУчетаСчетовФактур.КодВидаСделки,
	|	ЕСТЬNULL(СведенияОКомитентах.Наименование, """"),
	|	ЖурналУчетаСчетовФактур.НомерСчетаФактурыКомитента,
	|	ЖурналУчетаСчетовФактур.СводныйКорректировочный,
	|	ЖурналУчетаСчетовФактур.СводныйКомиссионный,
	|	ЖурналУчетаСчетовФактур.ДатаСчетаФактурыКомитента,
	|	ЖурналУчетаСчетовФактур.ИсправлениеСобственнойОшибки,
	|	ЖурналУчетаСчетовФактур.Период,
	|	ЖурналУчетаСчетовФактур.СчетФактураПолученныйОтПродавца,
	|	ОшибочныеРеквизитыКомитентов.ИНН,
	|	ОшибочныеРеквизитыКонтрагентов.ИНН,
	|	ЖурналУчетаСчетовФактур.Сторно,
	|	ЖурналУчетаСчетовФактур.ИсправленныйСчетФактура,
	|	ЖурналУчетаСчетовФактур.Регистратор,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыКомитентов.ИНН ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыКомитентов.ИНН
	|		КОГДА ЖурналУчетаСчетовФактур.ИННКомитента ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОКомитентах.ИНН, """")
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.ИННКомитента
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыКомитентов.КПП ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыКомитентов.КПП
	|		КОГДА ЖурналУчетаСчетовФактур.КППКомитента ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОКомитентах.КПП, """")
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.КППКомитента
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыКонтрагентов.ИНН ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыКонтрагентов.ИНН
	|		КОГДА ЖурналУчетаСчетовФактур.ИННКонтрагента ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОКонтрагентах.ИНН, """")
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.ИННКонтрагента
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыКонтрагентов.КПП ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыКонтрагентов.КПП
	|		КОГДА ЖурналУчетаСчетовФактур.КППКонтрагента ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОКонтрагентах.КПП, """")
	|		ИНАЧЕ ЖурналУчетаСчетовФактур.КППКонтрагента
	|	КОНЕЦ
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ЧастьЖурнала
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ВТ_ЖурналУчетаСчетовФактур.СчетФактура КАК СчетФактура,
	|	ЕСТЬNULL(СведенияОСубкомиссионерах.Наименование, """") КАК Субкомиссионер,
	|	ВТ_ЖурналУчетаСчетовФактур.СубкомиссионерСсылка КАК СубкомиссионерСсылка,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыСубкомиссионеров.ИНН ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыСубкомиссионеров.ИНН
	|		КОГДА ВТ_ЖурналУчетаСчетовФактур.ИННСубкомиссионера ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОСубкомиссионерах.ИНН, """")
	|		ИНАЧЕ ВТ_ЖурналУчетаСчетовФактур.ИННСубкомиссионера
	|	КОНЕЦ КАК СубкомиссионерИНН,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыСубкомиссионеров.КПП ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыСубкомиссионеров.КПП
	|		КОГДА ВТ_ЖурналУчетаСчетовФактур.КППСубкомиссионера ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОСубкомиссионерах.КПП, """")
	|		ИНАЧЕ ВТ_ЖурналУчетаСчетовФактур.КППСубкомиссионера
	|	КОНЕЦ КАК СубкомиссионерКПП,
	|	МИНИМУМ(ВТ_ЖурналУчетаСчетовФактур.НомерСтроки) КАК НомерСтроки
	|ИЗ
	|	ВТ_ЖурналУчетаСчетовФактур КАК ВТ_ЖурналУчетаСчетовФактур
	|		ЛЕВОЕ СОЕДИНЕНИЕ ОшибочныеРеквизитыСубкомиссионеров КАК ОшибочныеРеквизитыСубкомиссионеров
	|		ПО ВТ_ЖурналУчетаСчетовФактур.СчетФактура = ОшибочныеРеквизитыСубкомиссионеров.СчетФактура
	|			И ВТ_ЖурналУчетаСчетовФактур.СубкомиссионерСсылка = ОшибочныеРеквизитыСубкомиссионеров.Субкомиссионер
	|		ЛЕВОЕ СОЕДИНЕНИЕ СведенияОСсылкахНаДаты КАК СведенияОСубкомиссионерах
	|		ПО ВТ_ЖурналУчетаСчетовФактур.СубкомиссионерСсылка = СведенияОСубкомиссионерах.Ссылка
	|			И ВТ_ЖурналУчетаСчетовФактур.ДатаСведений = СведенияОСубкомиссионерах.ДатаСведений
	|ГДЕ
	|	ВТ_ЖурналУчетаСчетовФактур.СубкомиссионерСсылка <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|
	|СГРУППИРОВАТЬ ПО
	|	ВТ_ЖурналУчетаСчетовФактур.СчетФактура,
	|	ЕСТЬNULL(СведенияОСубкомиссионерах.Наименование, """"),
	|	ВТ_ЖурналУчетаСчетовФактур.СубкомиссионерСсылка,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыСубкомиссионеров.ИНН ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыСубкомиссионеров.ИНН
	|		КОГДА ВТ_ЖурналУчетаСчетовФактур.ИННСубкомиссионера ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОСубкомиссионерах.ИНН, """")
	|		ИНАЧЕ ВТ_ЖурналУчетаСчетовФактур.ИННСубкомиссионера
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА НЕ ОшибочныеРеквизитыСубкомиссионеров.КПП ЕСТЬ NULL
	|			ТОГДА ОшибочныеРеквизитыСубкомиссионеров.КПП
	|		КОГДА ВТ_ЖурналУчетаСчетовФактур.КППСубкомиссионера ПОДОБНО """"
	|			ТОГДА ЕСТЬNULL(СведенияОСубкомиссионерах.КПП, """")
	|		ИНАЧЕ ВТ_ЖурналУчетаСчетовФактур.КППСубкомиссионера
	|	КОНЕЦ
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ЖурналУчетаСчетовФактур";
	
	ДополнительныеСвойства = Запрос.Выполнить().Выгрузить();
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Организация КАК Организация,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СчетФактураДокумент КАК СчетФактураДокумент,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КодВидаОперации КАК КодВидаОперации,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаПередачиПолучения КАК ДатаПередачиПолучения,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Контрагент КАК Контрагент,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КонтрагентНаименование КАК КонтрагентНаименование,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НаименованиеВалюты КАК НаименованиеВалюты,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НаименованиеВалютыКраткое КАК НаименованиеВалютыКраткое,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КодВалюты КАК КодВалюты,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокумента КАК СуммаДокумента,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДС КАК СуммаНДС,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СчетФактураБезНДС КАК СчетФактураБезНДС,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СводныйКорректировочный КАК СводныйКорректировочный,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ЧастьЖурнала КАК ЧастьЖурнала,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КонтрагентИНН КАК КонтрагентИНН,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КонтрагентКПП КАК КонтрагентКПП,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокументаРазницаУменьшение КАК СуммаДокументаРазницаУменьшение,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокументаРазницаУвеличение КАК СуммаДокументаРазницаУвеличение,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСРазницаУменьшение КАК СуммаНДСРазницаУменьшение,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСРазницаУвеличение КАК СуммаНДСРазницаУвеличение,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КодСпособаВыставления КАК КодСпособаВыставления,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировочногоСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировочногоСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КодВидаСделки КАК КодВидаСделки,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КомитентСсылка КАК КомитентСсылка,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Комитент КАК Комитент,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КомитентИНН КАК КомитентИНН,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КомитентКПП КАК КомитентКПП,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НомерСчетаФактурыКомитента КАК НомерСчетаФактурыКомитента,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаСчетаФактурыКомитента КАК ДатаСчетаФактурыКомитента,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСИтоговая КАК СуммаНДСИтоговая,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшениеИтоговая КАК СуммаПоСчетуФактуреРазницаУменьшениеИтоговая,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличениеИтоговая КАК СуммаПоСчетуФактуреРазницаУвеличениеИтоговая,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСРазницаУменьшениеИтоговая КАК СуммаНДСРазницаУменьшениеИтоговая,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСРазницаУвеличениеИтоговая КАК СуммаНДСРазницаУвеличениеИтоговая,
	|	ВЫБОР
	|		КОГДА НЕ &ПравилаПостановления735
	|				И ЗаписиРегистраЖурналУчетаСчетовФактур.КорректировочныйСчетФактура
	|			ТОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЗаписиРегистраЖурналУчетаСчетовФактур.НомерИсправления
	|	КОНЕЦ КАК НомерИсправления,
	|	ВЫБОР
	|		КОГДА НЕ &ПравилаПостановления735
	|				И ЗаписиРегистраЖурналУчетаСчетовФактур.КорректировочныйСчетФактура
	|			ТОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправления
	|	КОНЕЦ КАК ДатаИсправления,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СчетФактураНеВыставляется КАК СчетФактураНеВыставляется,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КорректировочныйСчетФактура КАК КорректировочныйСчетФактура,
	|	ЕСТЬNULL(ЗаписиРегистраЖурналУчетаСчетовФактур.СчетФактураВыданныйНомер, ЗаписиРегистраЖурналУчетаСчетовФактур.НомерСчетаФактуры) КАК НомерСчетаФактурыДляСортировки,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СводныйКомиссионный КАК СводныйКомиссионный,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ИсправлениеСобственнойОшибки КАК ИсправлениеСобственнойОшибки,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Регистратор КАК Регистратор,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Сторно КАК Сторно,
	|	ВЫБОР
	|		КОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ИсправлениеСобственнойОшибки
	|			ТОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.Период
	|		КОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|				И ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры >= ДАТАВРЕМЯ(2017, 10, 1)
	|			ТОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры
	|		КОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправления <> ДАТАВРЕМЯ(1, 1, 1)
	|				И ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправления >= ДАТАВРЕМЯ(2017, 10, 1)
	|			ТОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправления
	|		ИНАЧЕ ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаПередачиПолучения
	|	КОНЕЦ КАК ПериодДляСортировки,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокументаКомиссия КАК СуммаДокументаКомиссия,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокументаРазницаУменьшениеКомиссия КАК СуммаДокументаРазницаУменьшениеКомиссия,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокументаРазницаУвеличениеКомиссия КАК СуммаДокументаРазницаУвеличениеКомиссия,
	|	ВЫБОР
	|		КОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ИсправлениеСобственнойОшибки
	|				ИЛИ ЗаписиРегистраЖурналУчетаСчетовФактур.Сторно
	|				ИЛИ ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|					И ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры >= ДАТАВРЕМЯ(2017, 10, 1)
	|				ИЛИ ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправления <> ДАТАВРЕМЯ(1, 1, 1)
	|					И ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправления >= ДАТАВРЕМЯ(2017, 10, 1)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ИсправительныеЗаписи
	|ИЗ
	|	ЗаписиРегистраЖурналУчетаСчетовФактур КАК ЗаписиРегистраЖурналУчетаСчетовФактур
	|ГДЕ
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ВыставленныеСчетаФактуры)
	|
	|УПОРЯДОЧИТЬ ПО
	|	ИсправительныеЗаписи,
	|	ПериодДляСортировки,
	|	НомерСчетаФактурыДляСортировки,
	|	Сторно УБЫВ,
	|	ДатаСчетаФактурыКомитента,
	|	Комитент,
	|	НомерСчетаФактурыКомитента
	|ИТОГИ
	|	МАКСИМУМ(КонтрагентНаименование),
	|	МАКСИМУМ(СуммаДокумента),
	|	СУММА(СуммаНДС),
	|	МАКСИМУМ(СводныйКорректировочный),
	|	СУММА(СуммаДокументаРазницаУменьшение),
	|	СУММА(СуммаДокументаРазницаУвеличение),
	|	СУММА(СуммаНДСРазницаУменьшение),
	|	СУММА(СуммаНДСРазницаУвеличение),
	|	МАКСИМУМ(СуммаНДСИтоговая),
	|	МАКСИМУМ(СуммаПоСчетуФактуреРазницаУменьшениеИтоговая),
	|	МАКСИМУМ(СуммаПоСчетуФактуреРазницаУвеличениеИтоговая),
	|	МАКСИМУМ(СуммаНДСРазницаУменьшениеИтоговая),
	|	МАКСИМУМ(СуммаНДСРазницаУвеличениеИтоговая),
	|	СУММА(СуммаДокументаКомиссия),
	|	СУММА(СуммаДокументаРазницаУменьшениеКомиссия),
	|	СУММА(СуммаДокументаРазницаУвеличениеКомиссия)
	|ПО
	|	ИсправительныеЗаписи,
	|	Регистратор,
	|	СчетФактураДокумент,
	|	Сторно";
	
	Если ГруппироватьПоКонтрагентам Тогда
		
		ЗаменяемыйСтандартныйТекст = "ПО
		|	ИсправительныеЗаписи";
		
		НовыйТекст = "ПО
		|	Контрагент,
		|	ИсправительныеЗаписи";
		
		Запрос.Текст = СтрЗаменить(Запрос.Текст, ЗаменяемыйСтандартныйТекст, НовыйТекст);
			
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "УПОРЯДОЧИТЬ ПО", "УПОРЯДОЧИТЬ ПО
			|КонтрагентНаименование, ");
	КонецЕсли;
	
	ВыставленныеСчетаФактуры = Запрос.Выполнить();
	
	// Полученные счета-фактуры выводим сначала исходные, затем исправительные. Далее сортируем по дате 
	// получения/регистрации, наименованию контрагента, номеру счета-фактуры контрагента, регистратору, признаку "Сторно".
	
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Организация КАК Организация,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СчетФактураДокумент КАК СчетФактураДокумент,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КодВидаОперации КАК КодВидаОперации,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаПередачиПолучения КАК ДатаПередачиПолучения,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Контрагент КАК Контрагент,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КонтрагентНаименование КАК КонтрагентНаименование,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НаименованиеВалюты КАК НаименованиеВалюты,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НаименованиеВалютыКраткое КАК НаименованиеВалютыКраткое,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КодВалюты КАК КодВалюты,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокумента КАК СуммаДокумента,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокументаКомиссия КАК СуммаДокументаКомиссия,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДС КАК СуммаНДС,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СчетФактураБезНДС КАК СчетФактураБезНДС,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ЧастьЖурнала КАК ЧастьЖурнала,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КонтрагентИНН КАК КонтрагентИНН,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КонтрагентКПП КАК КонтрагентКПП,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокументаРазницаУменьшение КАК СуммаДокументаРазницаУменьшение,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаДокументаРазницаУвеличение КАК СуммаДокументаРазницаУвеличение,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСРазницаУменьшение КАК СуммаНДСРазницаУменьшение,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСРазницаУвеличение КАК СуммаНДСРазницаУвеличение,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КодСпособаВыставления КАК КодСпособаВыставления,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировочногоСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировочногоСчетаФактуры,
	|	ВЫБОР
	|		КОГДА НЕ &ПравилаПостановления735
	|				И ЗаписиРегистраЖурналУчетаСчетовФактур.КорректировочныйСчетФактура
	|			ТОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЗаписиРегистраЖурналУчетаСчетовФактур.НомерИсправления
	|	КОНЕЦ КАК НомерИсправления,
	|	ВЫБОР
	|		КОГДА НЕ &ПравилаПостановления735
	|				И ЗаписиРегистраЖурналУчетаСчетовФактур.КорректировочныйСчетФактура
	|			ТОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры
	|		ИНАЧЕ ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправления
	|	КОНЕЦ КАК ДатаИсправления,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СчетФактураНеВыставляется КАК СчетФактураНеВыставляется,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КорректировочныйСчетФактура КАК КорректировочныйСчетФактура,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КодВидаСделки КАК КодВидаСделки,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Комитент КАК Комитент,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КомитентИНН КАК КомитентИНН,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КомитентКПП КАК КомитентКПП,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НомерСчетаФактурыКомитента КАК НомерСчетаФактурыКомитента,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаСчетаФактурыКомитента КАК ДатаСчетаФактурыКомитента,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСИтоговая КАК СуммаНДСИтоговая,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУменьшениеИтоговая КАК СуммаПоСчетуФактуреРазницаУменьшениеИтоговая,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаПоСчетуФактуреРазницаУвеличениеИтоговая КАК СуммаПоСчетуФактуреРазницаУвеличениеИтоговая,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСРазницаУменьшениеИтоговая КАК СуммаНДСРазницаУменьшениеИтоговая,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.СуммаНДСРазницаУвеличениеИтоговая КАК СуммаНДСРазницаУвеличениеИтоговая,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ИсправлениеСобственнойОшибки КАК ИсправлениеСобственнойОшибки,
	|	ВЫБОР
	|		КОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ИсправлениеСобственнойОшибки
	|			ТОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.Период
	|		ИНАЧЕ ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаПередачиПолучения
	|	КОНЕЦ КАК ПериодДляСортировки,
	|	ВЫБОР
	|		КОГДА ЗаписиРегистраЖурналУчетаСчетовФактур.ИсправлениеСобственнойОшибки
	|				ИЛИ ЗаписиРегистраЖурналУчетаСчетовФактур.Сторно
	|				ИЛИ ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|					И ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры >= ДАТАВРЕМЯ(2017, 10, 1)
	|				ИЛИ ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправления <> ДАТАВРЕМЯ(1, 1, 1)
	|					И ЗаписиРегистраЖурналУчетаСчетовФактур.ДатаИсправления >= ДАТАВРЕМЯ(2017, 10, 1)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК ИсправительныеЗаписи
	|ИЗ
	|	ЗаписиРегистраЖурналУчетаСчетовФактур КАК ЗаписиРегистраЖурналУчетаСчетовФактур
	|ГДЕ
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|
	|УПОРЯДОЧИТЬ ПО
	|	ИсправительныеЗаписи,
	|	ПериодДляСортировки,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.КонтрагентНаименование,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.НомерСчетаФактуры,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Регистратор,
	|	ЗаписиРегистраЖурналУчетаСчетовФактур.Сторно УБЫВ";
	
	Если ГруппироватьПоКонтрагентам Тогда
		Запрос.Текст = Запрос.Текст + "
			|ИТОГИ
			|	МАКСИМУМ(СуммаДокумента),
			|	СУММА(СуммаДокументаКомиссия),
			|	СУММА(СуммаНДС),
			|	МАКСИМУМ(СуммаНДСИтоговая),
			|	МАКСИМУМ(СуммаПоСчетуФактуреРазницаУменьшениеИтоговая),
			|	МАКСИМУМ(СуммаПоСчетуФактуреРазницаУвеличениеИтоговая),
			|	МАКСИМУМ(СуммаНДСРазницаУменьшениеИтоговая),
			|	МАКСИМУМ(СуммаНДСРазницаУвеличениеИтоговая),
			|	МАКСИМУМ(КонтрагентНаименование)
			|ПО
			|	Контрагент";
		Запрос.Текст = СтрЗаменить(Запрос.Текст, "УПОРЯДОЧИТЬ ПО", "УПОРЯДОЧИТЬ ПО
			|КонтрагентНаименование, ");
	КонецЕсли;
	
	ПолученныеСчетаФактуры = Запрос.Выполнить();
	
	ДанныеОтчета = Новый Структура();
	ДанныеОтчета.Вставить("ВыставленныеСчетаФактуры", 	ВыставленныеСчетаФактуры);
	ДанныеОтчета.Вставить("ПолученныеСчетаФактуры", 	ПолученныеСчетаФактуры);
	ДанныеОтчета.Вставить("ДополнительныеСвойства", 	ДополнительныеСвойства);

	// СтандартныеПодсистемы.РаботаСКонтрагентами
	ПроверкаКонтрагентов.ЗапомнитьДанныеОтчета(СтруктураПараметров, ДанныеОтчета);
	// Конец СтандартныеПодсистемы.РаботаСКонтрагентами
	
	Возврат Новый Структура("ВыставленныеСчетаФактуры, ПолученныеСчетаФактуры, ДополнительныеСвойства", 
		ВыставленныеСчетаФактуры, ПолученныеСчетаФактуры, ДополнительныеСвойства);
	
КонецФункции

Функция ТекстЗапросаЖурналСчетовФактур981()
	
	// 0. ВТ_СчетаФактурыОтКомитента               - таблица счетов-фактур, полученных комиссионером от комитента 
	//    при реализации комиссионных товаров, необходима для заполнения граф 10-12 Части 1 Журнала счетов-фактур.
	// 1. ВТ_ЖурналСчетовФактурПредварительная     - записи Журнала учета счетов-фактур по комиссионным операциям.
	// 2. ВТ_НДСПоСчетуФактуреНАПеревыставленному  - суммы НДС по счетам-фактурам, выставленным при исполнении
	// обязанностей налогового агента комиссионером, закукупающим товары для комитента, необходима для заполнения 
	// графы 15 Части 2 Журнала счетов-фактур.
	// 3. ВТ_ЖурналУчетаСчетовФактур  - итоговая таблица для формирования отчета Журнала учета счетов-фактур.
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактурСрезПоследних.Организация КАК Организация,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК СчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураВыданныйПокупателю КАК СчетФактураВыданныйПокупателю,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Контрагент КАК КомитентСсылка,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреКомиссия КАК СуммаПоСчетуФактуреКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия КАК СуммаНДСКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактуры КАК НомерСчетаФактурыКомитента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры КАК ДатаСчетаФактурыКомитента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия КАК СуммаПоСчетуФактуреРазницаУменьшениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия КАК СуммаПоСчетуФактуреРазницаУвеличениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия КАК СуммаНДСРазницаУменьшениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия КАК СуммаНДСРазницаУвеличениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ПоСтавкеБезНДС КАК ПоСтавкеБезНДС,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца КАК НомерСчетаФактурыПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправлениеСобственнойОшибки КАК ИсправлениеСобственнойОшибки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННКонтрагента КАК ИННКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КППКонтрагента КАК КППКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуре КАК СуммаПоСчетуФактуре
	|ПОМЕСТИТЬ ВТ_СчетаФактурыОтКомитента
	|ИЗ
	|	РегистрСведений.ЖурналУчетаСчетовФактур.СрезПоследних(
	|			,
	|			Организация В (&СписокОрганизаций)
	|				И ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|				И НЕ СчетФактураВыданныйПокупателю В (&МассивПустыеСсылкиСчетовФактур)
	|				И НЕ ИсправлениеСобственнойОшибки) КАК ЖурналУчетаСчетовФактурСрезПоследних
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураВыданныйПокупателю
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактурСрезПоследних.Период КАК Период,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Регистратор КАК Регистратор,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСтроки КАК НомерСтроки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Активность КАК Активность,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Организация КАК Организация,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Контрагент КАК Контрагент,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК СчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала КАК ЧастьЖурнала,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИндексСтроки КАК ИндексСтроки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Сторно КАК Сторно,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправленныйСчетФактура КАК ИсправленныйСчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураВыданныйПокупателю КАК СчетФактураВыданныйПокупателю,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца КАК СчетФактураПолученныйОтПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправлениеСобственнойОшибки КАК ИсправлениеСобственнойОшибки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения КАК ДатаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодСпособаВыставленияПолучения КАК КодСпособаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаОперации КАК КодВидаОперации,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправления КАК НомерИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления КАК ДатаИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Валюта КАК Валюта,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуре КАК СуммаПоСчетуФактуре,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДС КАК СуммаНДС,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшение КАК СуммаПоСчетуФактуреРазницаУменьшение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличение КАК СуммаПоСчетуФактуреРазницаУвеличение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшение КАК СуммаНДСРазницаУменьшение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличение КАК СуммаНДСРазницаУвеличение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ПоСтавкеБезНДС КАК ПоСтавкеБезНДС,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураНеВыставляется КАК СчетФактураНеВыставляется,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Продавец КАК Продавец,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КППКонтрагента КАК КППКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Посредник КАК Посредник,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Субкомиссионер КАК Субкомиссионер,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаСделки КАК КодВидаСделки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца КАК НомерСчетаФактурыПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреКомиссия КАК СуммаПоСчетуФактуреКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия КАК СуммаНДСКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия КАК СуммаПоСчетуФактуреРазницаУменьшениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия КАК СуммаПоСчетуФактуреРазницаУвеличениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия КАК СуммаНДСРазницаУменьшениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия КАК СуммаНДСРазницаУвеличениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаОперацииКомиссия КАК КодВидаОперацииКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактурыПродавца КАК ДатаСчетаФактурыПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННКонтрагента КАК ИННКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННПродавца КАК ИННПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КПППродавца КАК КПППродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННСубкомиссионера КАК ИННСубкомиссионера,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КППСубкомиссионера КАК КППСубкомиссионера
	|ПОМЕСТИТЬ ВТ_ЖурналСчетовФактурПредварительная
	|ИЗ
	|	РегистрСведений.ЖурналУчетаСчетовФактур.СрезПоследних(
	|			,
	|			Организация В (&СписокОрганизаций)
	|				И &ОтборПоКонтрагенту
	|				И (ДатаВыставленияПолучения МЕЖДУ &НачПериода И &КонПериода)) КАК ЖурналУчетаСчетовФактурСрезПоследних
	|ГДЕ
	|	(ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия <> 0)
	|	И ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения <> ДАТАВРЕМЯ(1, 1, 1)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактур.СчетФактура КАК СчетФактура,
	|	СУММА(ЖурналУчетаСчетовФактур.СуммаНДСКомиссия) КАК СуммаНДСКомиссия
	|ПОМЕСТИТЬ ВТ_НДСПоСчетуФактуреНАПеревыставленному
	|ИЗ
	|	РегистрСведений.ЖурналУчетаСчетовФактур КАК ЖурналУчетаСчетовФактур
	|ГДЕ
	|	ЖурналУчетаСчетовФактур.Организация В(&СписокОрганизаций)
	|	И ЖурналУчетаСчетовФактур.СчетФактура В
	|			(ВЫБРАТЬ РАЗЛИЧНЫЕ
	|				ВТ_ЖурналСчетовФактурПредварительная.СчетФактура
	|			ИЗ
	|				ВТ_ЖурналСчетовФактурПредварительная КАК ВТ_ЖурналСчетовФактурПредварительная)
	|	И ЖурналУчетаСчетовФактур.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|	И ЖурналУчетаСчетовФактур.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|	И ЖурналУчетаСчетовФактур.СуммаНДСКомиссия <> 0
	|	И ЖурналУчетаСчетовФактур.ДатаВыставленияПолучения МЕЖДУ &НачПериода И &КонПериода
	|
	|СГРУППИРОВАТЬ ПО
	|	ЖурналУчетаСчетовФактур.СчетФактура
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактурСрезПоследних.Организация КАК Организация,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.Контрагент
	|	КОНЕЦ КАК КонтрагентСсылка,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.КПППродавца
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.КППКонтрагента
	|	КОНЕЦ КАК КППКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК СчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала КАК ЧастьЖурнала,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаОперацииКомиссия КАК КодВидаОперации,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.Период
	|	КОНЕЦ КАК ДатаСведений,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправления КАК НомерИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления КАК ДатаИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Валюта КАК Валюта,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшение КАК СуммаПоСчетуФактуреРазницаУменьшение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличение КАК СуммаПоСчетуФактуреРазницаУвеличение,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУменьшениеКомиссия ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУменьшениеКомиссия
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУменьшениеКомиссия
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия
	|	КОНЕЦ КАК СуммаНДСРазницаУменьшение,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУвеличениеКомиссия ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУвеличениеКомиссия
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУвеличениеКомиссия
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия
	|	КОНЕЦ КАК СуммаНДСРазницаУвеличение,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ПоСтавкеБезНДС, ЖурналУчетаСчетовФактурСрезПоследних.ПоСтавкеБезНДС) КАК ПоСтавкеБезНДС,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураНеВыставляется КАК СчетФактураНеВыставляется,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаСделки КАК КодВидаСделки,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.КомитентСсылка, ЖурналУчетаСчетовФактурСрезПоследних.Продавец) КАК КомитентСсылка,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуре КАК СуммаПоСчетуФактуре,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСКомиссия ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаНДСКомиссия
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСКомиссия
	|				КОНЕЦ
	|		ИНАЧЕ ЕСТЬNULL(ВТ_НДСПоСчетуФактуреНАПеревыставленному.СуммаНДСКомиссия, ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия)
	|	КОНЕЦ КАК СуммаНДС,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца <> """"
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца <> ЗНАЧЕНИЕ(документ.СчетФактураПолученный.ПустаяСсылка)
	|			ТОГДА ДанныеСФОтПродавца.Номер
	|		ИНАЧЕ ВЫБОР
	|				КОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерКорректировочногоСчетаФактуры <> """"
	|					ТОГДА ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.НомерКорректировочногоСчетаФактуры, """")
	|				ИНАЧЕ ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.НомерСчетаФактурыКомитента, """")
	|			КОНЕЦ
	|	КОНЕЦ КАК НомерСчетаФактурыКомитента,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактурыПродавца <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактурыПродавца
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца <> ЗНАЧЕНИЕ(документ.СчетФактураПолученный.ПустаяСсылка)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца.ДатаВходящегоДокумента
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца <> """"
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры
	|		ИНАЧЕ ВЫБОР
	|				КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|					ТОГДА ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ДатаКорректировочногоСчетаФактуры, """")
	|				ИНАЧЕ ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ДатаСчетаФактурыКомитента, """")
	|			КОНЕЦ
	|	КОНЕЦ КАК ДатаСчетаФактурыКомитента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия КАК СуммаНДСИтоговая,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия КАК СуммаПоСчетуФактуреРазницаУменьшениеИтоговая,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия КАК СуммаПоСчетуФактуреРазницаУвеличениеИтоговая,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия КАК СуммаНДСРазницаУменьшениеИтоговая,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия КАК СуммаНДСРазницаУвеличениеИтоговая,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура.СводныйКорректировочный
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СводныйКорректировочный,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|			ТОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураВыданный).СводныйКомиссионный
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура ССЫЛКА Документ.СчетФактураПолученный
	|			ТОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураПолученный).СводныйКомиссионный
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СводныйКомиссионный,
	|	ВЫБОР
	|		КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураВыданный).ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
	|				ИЛИ ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураПолученный).ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.Корректировочный)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК КорректировочныйСчетФактура,
	|	ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураВыданный).Номер КАК СчетФактураВыданныйНомер,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Субкомиссионер КАК СубкомиссионерСсылка,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправлениеСобственнойОшибки КАК ИсправлениеСобственнойОшибки,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.СчетФактура, ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца) КАК СчетФактураПолученныйОтПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Сторно КАК Сторно,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправленныйСчетФактура КАК ИсправленныйСчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Период КАК Период,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Регистратор КАК Регистратор,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ИННКонтрагента, ЖурналУчетаСчетовФактурСрезПоследних.ИННПродавца) КАК ИННКомитента,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.КППКонтрагента, ЖурналУчетаСчетовФактурСрезПоследних.КПППродавца) КАК КППКомитента,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ИННПродавца
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.ИННКонтрагента
	|	КОНЕЦ КАК ИННКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННСубкомиссионера КАК ИННСубкомиссионера,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КППСубкомиссионера КАК КППСубкомиссионера,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения КАК ДатаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодСпособаВыставленияПолучения КАК КодСпособаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСтроки КАК НомерСтроки,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреКомиссия ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреКомиссия
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреКомиссия
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреКомиссия
	|	КОНЕЦ КАК СуммаПоСчетуФактуреКомиссия,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия
	|	КОНЕЦ КАК СуммаПоСчетуФактуреРазницаУменьшениеКомиссия,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия
	|	КОНЕЦ КАК СуммаПоСчетуФактуреРазницаУвеличениеКомиссия
	|ПОМЕСТИТЬ ВТ_ЖурналУчетаСчетовФактур
	|ИЗ
	|	ВТ_ЖурналСчетовФактурПредварительная КАК ЖурналУчетаСчетовФактурСрезПоследних
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактурыОтКомитента КАК ВТ_СчетаФактурыОтКомитента
	|		ПО ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура = ВТ_СчетаФактурыОтКомитента.СчетФактураВыданныйПокупателю
	|			И (ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца = ЗНАЧЕНИЕ(Документ.СчетФактураПолученный.ПустаяСсылка))
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеСФОтПродавца
	|		ПО ЖурналУчетаСчетовФактурСрезПоследних.Организация = ДанныеСФОтПродавца.Организация
	|			И ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца = ДанныеСФОтПродавца.Документ
	|			И (ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения МЕЖДУ &НачПериода И &КонПериода)
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_НДСПоСчетуФактуреНАПеревыставленному КАК ВТ_НДСПоСчетуФактуреНАПеревыставленному
	|		ПО ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура = ВТ_НДСПоСчетуФактуреНАПеревыставленному.СчетФактура
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_НДСПоСчетуФактуреНАПеревыставленному
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ЖурналСчетовФактурПредварительная
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_СчетаФактурыОтКомитента";
	
	Возврат ТекстЗапроса;
	
КонецФункции

Функция ТекстЗапросаЖурналСчетовФактур1137()
	
	ТекстЗапроса = 
	"ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактурСрезПоследних.Организация КАК Организация,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК СчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураВыданныйПокупателю КАК СчетФактураВыданныйПокупателю,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Контрагент КАК КомитентСсылка,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения < ДАТАВРЕМЯ(2015, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуре
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреКомиссия
	|	КОНЕЦ КАК СуммаПоСчетуФактуре,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения < ДАТАВРЕМЯ(2015, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДС
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия
	|	КОНЕЦ КАК СуммаНДС,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактуры КАК НомерСчетаФактурыКомитента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры КАК ДатаСчетаФактурыКомитента,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения < ДАТАВРЕМЯ(2015, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшение
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия
	|	КОНЕЦ КАК СуммаПоСчетуФактуреРазницаУменьшение,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения < ДАТАВРЕМЯ(2015, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличение
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия
	|	КОНЕЦ КАК СуммаПоСчетуФактуреРазницаУвеличение,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения < ДАТАВРЕМЯ(2015, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшение
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия
	|	КОНЕЦ КАК СуммаНДСРазницаУменьшение,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения < ДАТАВРЕМЯ(2015, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличение
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия
	|	КОНЕЦ КАК СуммаНДСРазницаУвеличение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ПоСтавкеБезНДС КАК ПоСтавкеБезНДС,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца КАК НомерСчетаФактурыПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправлениеСобственнойОшибки КАК ИсправлениеСобственнойОшибки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННКонтрагента КАК ИННКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КППКонтрагента КАК КППКонтрагента
	|ПОМЕСТИТЬ ВТ_СчетаФактурыОтКомитента
	|ИЗ
	|	РегистрСведений.ЖурналУчетаСчетовФактур.СрезПоследних(
	|			,
	|			&ПравилаПостановления735
	|				И Организация В (&СписокОрганизаций)
	|				И ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|				И НЕ СчетФактураВыданныйПокупателю В (&МассивПустыеСсылкиСчетовФактур)
	|				И НЕ ИсправлениеСобственнойОшибки) КАК ЖурналУчетаСчетовФактурСрезПоследних
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактураВыданныйПокупателю
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактурСрезПоследних.Период КАК Период,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Регистратор КАК Регистратор,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСтроки КАК НомерСтроки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Активность КАК Активность,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Организация КАК Организация,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Контрагент КАК Контрагент,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК СчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала КАК ЧастьЖурнала,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИндексСтроки КАК ИндексСтроки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Сторно КАК Сторно,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправленныйСчетФактура КАК ИсправленныйСчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураВыданныйПокупателю КАК СчетФактураВыданныйПокупателю,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца КАК СчетФактураПолученныйОтПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправлениеСобственнойОшибки КАК ИсправлениеСобственнойОшибки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения КАК ДатаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодСпособаВыставленияПолучения КАК КодСпособаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаОперации КАК КодВидаОперации,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправления КАК НомерИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления КАК ДатаИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Валюта КАК Валюта,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуре КАК СуммаПоСчетуФактуре,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДС КАК СуммаНДС,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшение КАК СуммаПоСчетуФактуреРазницаУменьшение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличение КАК СуммаПоСчетуФактуреРазницаУвеличение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшение КАК СуммаНДСРазницаУменьшение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличение КАК СуммаНДСРазницаУвеличение,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ПоСтавкеБезНДС КАК ПоСтавкеБезНДС,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураНеВыставляется КАК СчетФактураНеВыставляется,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Продавец КАК Продавец,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КППКонтрагента КАК КППКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Посредник КАК Посредник,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Субкомиссионер КАК Субкомиссионер,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаСделки КАК КодВидаСделки,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца КАК НомерСчетаФактурыПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреКомиссия КАК СуммаПоСчетуФактуреКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия КАК СуммаНДСКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия КАК СуммаПоСчетуФактуреРазницаУменьшениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия КАК СуммаПоСчетуФактуреРазницаУвеличениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия КАК СуммаНДСРазницаУменьшениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия КАК СуммаНДСРазницаУвеличениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаОперацииКомиссия КАК КодВидаОперацииКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактурыПродавца КАК ДатаСчетаФактурыПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННКонтрагента КАК ИННКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННПродавца КАК ИННПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КПППродавца КАК КПППродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННСубкомиссионера КАК ИННСубкомиссионера,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КППСубкомиссионера КАК КППСубкомиссионера
	|ПОМЕСТИТЬ ВТ_ЖурналСчетовФактурПредварительная
	|ИЗ
	|	РегистрСведений.ЖурналУчетаСчетовФактур.СрезПоследних(
	|			,
	|			Организация В (&СписокОрганизаций)
	|				И &ОтборПоКонтрагенту
	|				И (ДатаВыставленияПолучения МЕЖДУ &НачПериода И &КонПериода)) КАК ЖурналУчетаСчетовФактурСрезПоследних
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактурСрезПоследних.Организация КАК Организация,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.Контрагент
	|	КОНЕЦ КАК КонтрагентСсылка,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.КПППродавца
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.КППКонтрагента
	|	КОНЕЦ КАК КППКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК СчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала КАК ЧастьЖурнала,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения КАК ДатаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодСпособаВыставленияПолучения КАК КодСпособаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаОперации КАК КодВидаОперации,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.Период
	|	КОНЕЦ КАК ДатаСведений,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактуры КАК НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры КАК ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерКорректировочногоСчетаФактуры КАК НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры КАК ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправления КАК НомерИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления КАК ДатаИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправленияКорректировочногоСчетаФактуры КАК НомерИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры КАК ДатаИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Валюта КАК Валюта,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУменьшение ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУменьшение
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУменьшение
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшение
	|	КОНЕЦ КАК СуммаПоСчетуФактуреРазницаУменьшение,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУвеличение ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУвеличение
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличение
	|	КОНЕЦ КАК СуммаПоСчетуФактуреРазницаУвеличение,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУменьшение ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУменьшение
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУменьшение
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшение
	|	КОНЕЦ КАК СуммаНДСРазницаУменьшение,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУвеличение ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУвеличение
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУвеличение
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличение
	|	КОНЕЦ КАК СуммаНДСРазницаУвеличение,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ПоСтавкеБезНДС, ЖурналУчетаСчетовФактурСрезПоследних.ПоСтавкеБезНДС) КАК ПоСтавкеБезНДС,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураНеВыставляется КАК СчетФактураНеВыставляется,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаСделки КАК КодВидаСделки,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.КомитентСсылка, ЖурналУчетаСчетовФактурСрезПоследних.Продавец) КАК КомитентСсылка,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуре КАК СуммаПоСчетуФактуре,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаНДС ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаНДС
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаНДС
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДС
	|	КОНЕЦ КАК СуммаНДС,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца <> """"
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца <> ЗНАЧЕНИЕ(документ.СчетФактураПолученный.ПустаяСсылка)
	|			ТОГДА ДанныеСФОтПродавца.Номер
	|		ИНАЧЕ ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.НомерСчетаФактурыКомитента, """")
	|	КОНЕЦ КАК НомерСчетаФактурыКомитента,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактурыПродавца <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактурыПродавца
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца <> ЗНАЧЕНИЕ(документ.СчетФактураПолученный.ПустаяСсылка)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца.ДатаВходящегоДокумента
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца <> """"
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры
	|		ИНАЧЕ ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ДатаСчетаФактурыКомитента, """")
	|	КОНЕЦ КАК ДатаСчетаФактурыКомитента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДС КАК СуммаНДСИтоговая,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшение КАК СуммаПоСчетуФактуреРазницаУменьшениеИтоговая,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличение КАК СуммаПоСчетуФактуреРазницаУвеличениеИтоговая,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшение КАК СуммаНДСРазницаУменьшениеИтоговая,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличение КАК СуммаНДСРазницаУвеличениеИтоговая,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура.СводныйКорректировочный
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК СводныйКорректировочный,
	|	ЛОЖЬ КАК СводныйКомиссионный,
	|	ВЫБОР
	|		КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураВыданный).ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
	|				ИЛИ ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураПолученный).ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.Корректировочный)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ КАК КорректировочныйСчетФактура,
	|	ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураВыданный).Номер КАК СчетФактураВыданныйНомер,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Субкомиссионер КАК СубкомиссионерСсылка,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправлениеСобственнойОшибки КАК ИсправлениеСобственнойОшибки,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.СчетФактура, ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца) КАК СчетФактураПолученныйОтПродавца,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Сторно КАК Сторно,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправленныйСчетФактура КАК ИсправленныйСчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Период КАК Период,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Регистратор КАК Регистратор,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ИННКонтрагента, ЖурналУчетаСчетовФактурСрезПоследних.ИННПродавца) КАК ИННКомитента,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.КППКонтрагента, ЖурналУчетаСчетовФактурСрезПоследних.КПППродавца) КАК КППКомитента,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ИННПродавца
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.ИННКонтрагента
	|	КОНЕЦ КАК ИННКонтрагента,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННСубкомиссионера КАК ИННСубкомиссионера,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КППСубкомиссионера КАК КППСубкомиссионера,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСтроки КАК НомерСтроки,
	|	0 КАК СуммаПоСчетуФактуреКомиссия,
	|	0 КАК СуммаПоСчетуФактуреРазницаУменьшениеКомиссия,
	|	0 КАК СуммаПоСчетуФактуреРазницаУвеличениеКомиссия
	|ПОМЕСТИТЬ ВТ_ЖурналУчетаСчетовФактур
	|ИЗ
	|	ВТ_ЖурналСчетовФактурПредварительная КАК ЖурналУчетаСчетовФактурСрезПоследних
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактурыОтКомитента КАК ВТ_СчетаФактурыОтКомитента
	|		ПО ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура = ВТ_СчетаФактурыОтКомитента.СчетФактураВыданныйПокупателю
	|			И (ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца = ЗНАЧЕНИЕ(Документ.СчетФактураПолученный.ПустаяСсылка))
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеСФОтПродавца
	|		ПО ЖурналУчетаСчетовФактурСрезПоследних.Организация = ДанныеСФОтПродавца.Организация
	|			И ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца = ДанныеСФОтПродавца.Документ
	|			И (ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения МЕЖДУ &НачПериода И &КонПериода)
	|ГДЕ
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения <> ДАТАВРЕМЯ(1, 1, 1)
	|	И ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения < ДАТАВРЕМЯ(2015, 1, 1)
	|
	|ОБЪЕДИНИТЬ ВСЕ
	|
	|ВЫБРАТЬ
	|	ЖурналУчетаСчетовФактурСрезПоследних.Организация,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.Контрагент
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.КПППродавца
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.КППКонтрагента
	|	КОНЕЦ,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Период >= ДАТАВРЕМЯ(2017, 10, 1)
	|				И НЕ ЖурналУчетаСчетовФактурСрезПоследних.ИсправлениеСобственнойОшибки
	|				И НЕ ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.Период
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения
	|	КОНЕЦ,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодСпособаВыставленияПолучения,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаОперацииКомиссия,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.Период
	|	КОНЕЦ,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправления,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаИсправленияКорректировочногоСчетаФактуры,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Валюта,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУменьшение ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУменьшение
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУменьшение
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУвеличение ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУвеличение
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаПоСчетуФактуреРазницаУвеличение
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУменьшение ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУменьшение
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУменьшение
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУвеличение ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУвеличение
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаНДСРазницаУвеличение
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия
	|	КОНЕЦ,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ПоСтавкеБезНДС, ЖурналУчетаСчетовФактурСрезПоследних.ПоСтавкеБезНДС),
	|	ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураНеВыставляется,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КодВидаСделки,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.КомитентСсылка, ЖурналУчетаСчетовФактурСрезПоследних.Продавец),
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ВыставленныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуре
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреКомиссия
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА НЕ ВТ_СчетаФактурыОтКомитента.СуммаНДС ЕСТЬ NULL
	|			ТОГДА ВЫБОР
	|					КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Сторно
	|						ТОГДА -ВТ_СчетаФактурыОтКомитента.СуммаНДС
	|					ИНАЧЕ ВТ_СчетаФактурыОтКомитента.СуммаНДС
	|				КОНЕЦ
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца <> """"
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца <> ЗНАЧЕНИЕ(Документ.СчетФактураПолученный.ПустаяСсылка)
	|			ТОГДА ДанныеСФОтПродавца.Номер
	|		ИНАЧЕ ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.НомерСчетаФактурыКомитента, """")
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактурыПродавца <> ДАТАВРЕМЯ(1, 1, 1)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактурыПродавца
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца <> ЗНАЧЕНИЕ(документ.СчетФактураПолученный.ПустаяСсылка)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца.ДатаВходящегоДокумента
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.НомерСчетаФактурыПродавца <> """"
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ДатаСчетаФактуры
	|		ИНАЧЕ ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ДатаСчетаФактурыКомитента, """")
	|	КОНЕЦ,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия,
	|	ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура.СводныйКорректировочный
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура ССЫЛКА Документ.СчетФактураВыданный
	|			ТОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураВыданный).СводныйКомиссионный
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура ССЫЛКА Документ.СчетФактураПолученный
	|			ТОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураПолученный).СводныйКомиссионный
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	ВЫБОР
	|		КОГДА ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураВыданный).ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыВыставленного.Корректировочный)
	|				ИЛИ ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураПолученный).ВидСчетаФактуры = ЗНАЧЕНИЕ(Перечисление.ВидСчетаФактурыПолученного.Корректировочный)
	|			ТОГДА ИСТИНА
	|		ИНАЧЕ ЛОЖЬ
	|	КОНЕЦ,
	|	ВЫРАЗИТЬ(ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура КАК Документ.СчетФактураВыданный).Номер,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Субкомиссионер,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправлениеСобственнойОшибки,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.СчетФактура, ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца),
	|	ЖурналУчетаСчетовФактурСрезПоследних.Сторно,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИсправленныйСчетФактура,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Период,
	|	ЖурналУчетаСчетовФактурСрезПоследних.Регистратор,
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.ИННКонтрагента, ЖурналУчетаСчетовФактурСрезПоследних.ИННПродавца),
	|	ЕСТЬNULL(ВТ_СчетаФактурыОтКомитента.КППКонтрагента, ЖурналУчетаСчетовФактурСрезПоследних.КПППродавца),
	|	ВЫБОР
	|		КОГДА ЖурналУчетаСчетовФактурСрезПоследних.Продавец <> ЗНАЧЕНИЕ(Справочник.Контрагенты.ПустаяСсылка)
	|				И ЖурналУчетаСчетовФактурСрезПоследних.ЧастьЖурнала = ЗНАЧЕНИЕ(Перечисление.ЧастиЖурналаУчетаСчетовФактур.ПолученныеСчетаФактуры)
	|			ТОГДА ЖурналУчетаСчетовФактурСрезПоследних.ИННПродавца
	|		ИНАЧЕ ЖурналУчетаСчетовФактурСрезПоследних.ИННКонтрагента
	|	КОНЕЦ,
	|	ЖурналУчетаСчетовФактурСрезПоследних.ИННСубкомиссионера,
	|	ЖурналУчетаСчетовФактурСрезПоследних.КППСубкомиссионера,
	|	ЖурналУчетаСчетовФактурСрезПоследних.НомерСтроки,
	|	0,
	|	0,
	|	0
	|ИЗ
	|	ВТ_ЖурналСчетовФактурПредварительная КАК ЖурналУчетаСчетовФактурСрезПоследних
	|		ЛЕВОЕ СОЕДИНЕНИЕ ВТ_СчетаФактурыОтКомитента КАК ВТ_СчетаФактурыОтКомитента
	|		ПО ЖурналУчетаСчетовФактурСрезПоследних.СчетФактура = ВТ_СчетаФактурыОтКомитента.СчетФактураВыданныйПокупателю
	|			И (ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца = ЗНАЧЕНИЕ(Документ.СчетФактураПолученный.ПустаяСсылка))
	|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ДанныеПервичныхДокументов КАК ДанныеСФОтПродавца
	|		ПО ЖурналУчетаСчетовФактурСрезПоследних.Организация = ДанныеСФОтПродавца.Организация
	|			И ЖурналУчетаСчетовФактурСрезПоследних.СчетФактураПолученныйОтПродавца = ДанныеСФОтПродавца.Документ
	|			И (ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения МЕЖДУ &НачПериода И &КонПериода)
	|ГДЕ
	|	ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения <> ДАТАВРЕМЯ(1, 1, 1)
	|	И ЖурналУчетаСчетовФактурСрезПоследних.ДатаВыставленияПолучения >= ДАТАВРЕМЯ(2015, 1, 1)
	|	И (ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУменьшениеКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаПоСчетуФактуреРазницаУвеличениеКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУменьшениеКомиссия <> 0
	|			ИЛИ ЖурналУчетаСчетовФактурСрезПоследних.СуммаНДСРазницаУвеличениеКомиссия <> 0)
	|
	|ИНДЕКСИРОВАТЬ ПО
	|	СчетФактура
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_ЖурналСчетовФактурПредварительная
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|УНИЧТОЖИТЬ ВТ_СчетаФактурыОтКомитента";
		
	Возврат ТекстЗапроса;
	
КонецФункции

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура ИнициализироватьТаблицыДанныхНДС(СтруктураПараметров)
	
	Если СтруктураПараметров.ЗаполнениеДекларации Тогда 
		
		Раздел10 = Новый ТаблицаЗначений; // Часть 1: выставленные счета-фактуры
		
		Раздел10.Колонки.Добавить("НомерПор", ОбщегоНазначения.ОписаниеТипаЧисло(12, 0));
		
		
		Раздел10.Колонки.Добавить("НомСчФПрод", ОбщегоНазначения.ОписаниеТипаСтрока(0));
		Раздел10.Колонки.Добавить("ДатаСчФПрод", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		Раздел10.Колонки.Добавить("НомИспрСчФ", ОбщегоНазначения.ОписаниеТипаЧисло(3, 0));
		Раздел10.Колонки.Добавить("ДатаИспрСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		Раздел10.Колонки.Добавить("НомКСчФПрод", ОбщегоНазначения.ОписаниеТипаСтрока(0));
		Раздел10.Колонки.Добавить("ДатаКСчФПрод", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		Раздел10.Колонки.Добавить("НомИспрКСчФ", ОбщегоНазначения.ОписаниеТипаЧисло(3, 0));
		Раздел10.Колонки.Добавить("ДатаИспрКСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		Раздел10.Колонки.Добавить("КодВидОпер", Новый ОписаниеТипов("Массив"));
		
		Раздел10.Колонки.Добавить("СвПокуп");
		
		Если СтруктураПараметров.ПравилаЗаполнения = "2015Кв1" Тогда
			Раздел10.Колонки.Добавить("ДатаВыст", ОбщегоНазначения.ОписаниеТипаСтрока(10));
			Раздел10.Колонки.Добавить("СвПосрДеят");
		ИначеЕсли СтруктураПараметров.ПравилаЗаполнения = "2017Кв1"
		      ИЛИ СтруктураПараметров.ПравилаЗаполнения = "2019Кв1" Тогда
			Раздел10.Колонки.Добавить("СвСчФОтПрод");
		КонецЕсли;
		
		Раздел10.Колонки.Добавить("ДополнительныеСведения");
		
		Раздел10.Колонки.Добавить("СуммаПосрДеят", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
		
		Раздел11 = Новый ТаблицаЗначений; // Часть 2: полученные счета-фактуры
		
		Раздел11.Колонки.Добавить("НомерПор", ОбщегоНазначения.ОписаниеТипаЧисло(12, 0));
		
		Если СтруктураПараметров.ПравилаЗаполнения = "2015Кв1" Тогда
			Раздел11.Колонки.Добавить("ДатаПолуч", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		КонецЕсли;
		
		Раздел11.Колонки.Добавить("НомСчФПрод", ОбщегоНазначения.ОписаниеТипаСтрока(0));
		Раздел11.Колонки.Добавить("ДатаСчФПрод", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		Раздел11.Колонки.Добавить("НомИспрСчФ", ОбщегоНазначения.ОписаниеТипаЧисло(3, 0));
		Раздел11.Колонки.Добавить("ДатаИспрСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		Раздел11.Колонки.Добавить("НомКСчФПрод", ОбщегоНазначения.ОписаниеТипаСтрока(0));
		Раздел11.Колонки.Добавить("ДатаКСчФПрод", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		Раздел11.Колонки.Добавить("НомИспрКСчФ", ОбщегоНазначения.ОписаниеТипаЧисло(3, 0));
		Раздел11.Колонки.Добавить("ДатаИспрКСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		Раздел11.Колонки.Добавить("КодВидСд", ОбщегоНазначения.ОписаниеТипаСтрока(1));
		Раздел11.Колонки.Добавить("ОКВ", ОбщегоНазначения.ОписаниеТипаСтрока(3));
		
		Раздел11.Колонки.Добавить("СтоимТовСчФВс", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
		Раздел11.Колонки.Добавить("СумНДССчФ", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
		
		Раздел11.Колонки.Добавить("РазСтКСчФУм", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
		Раздел11.Колонки.Добавить("РазСтКСчФУв", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
		Раздел11.Колонки.Добавить("РазНДСКСчФУм", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
		Раздел11.Колонки.Добавить("РазНДСКСчФУв", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
		
		Раздел11.Колонки.Добавить("КодВидОпер", Новый ОписаниеТипов("Массив"));
		Раздел11.Колонки.Добавить("СвПрод");
		Раздел11.Колонки.Добавить("СвКомис");
		Раздел11.Колонки.Добавить("ДополнительныеСведения");
		
		СтруктураПараметров.Вставить("ТаблицаРаздел10", Раздел10);
		СтруктураПараметров.Вставить("ТаблицаРаздел11", Раздел11);
		
		СтруктураПараметров.Вставить("ТабличныйДокументРаздел10");
		СтруктураПараметров.Вставить("ТабличныйДокументРаздел11");
		
	ИначеЕсли СтруктураПараметров.ЗаполнениеДокумента Тогда
		
		ЗаписиВыставленных = Новый ТаблицаЗначений; // Часть 1: выставленные счета-фактуры
		
		ЗаписиВыставленных.Колонки.Добавить("НомПП",       ОбщегоНазначения.ОписаниеТипаЧисло(12, 0));
		ЗаписиВыставленных.Колонки.Добавить("ДатаВыстСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиВыставленных.Колонки.Добавить("НомерСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(1000));
		ЗаписиВыставленных.Колонки.Добавить("ДатаСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиВыставленных.Колонки.Добавить("НомерИспрСчФ", ОбщегоНазначения.ОписаниеТипаЧисло(3, 0));
		ЗаписиВыставленных.Колонки.Добавить("ДатаИспрСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиВыставленных.Колонки.Добавить("НомерКСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(1000));
		ЗаписиВыставленных.Колонки.Добавить("ДатаКСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиВыставленных.Колонки.Добавить("НомерИспрКСчФ", ОбщегоНазначения.ОписаниеТипаЧисло(3, 0));
		ЗаписиВыставленных.Колонки.Добавить("ДатаИспрКСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиВыставленных.Колонки.Добавить("НаимПок", ОбщегоНазначения.ОписаниеТипаСтрока(1000));
		
		ЗаписиВыставленных.Колонки.Добавить("ИННЮЛ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		ЗаписиВыставленных.Колонки.Добавить("КПП", ОбщегоНазначения.ОписаниеТипаСтрока(9));
		ЗаписиВыставленных.Колонки.Добавить("ИННФЛ", ОбщегоНазначения.ОписаниеТипаСтрока(12));
		
		Если СтруктураПараметров.НалоговыйПериод >= '20171001' Тогда
			// Массив структур СвГр10_19 с ключами:
			// КодОКВ, СтТовУчНалВсего, СвПосредн, ВтчСумНДС, РазнСтоимКСчФ, РазнНДСКСчФ.
			ЗаписиВыставленных.Колонки.Добавить("СвГр10_19");
		Иначе
			ЗаписиВыставленных.Колонки.Добавить("КодОКВ", ОбщегоНазначения.ОписаниеТипаСтрока(3));
			ЗаписиВыставленных.Колонки.Добавить("СтТовУчНалВсего", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
			ЗаписиВыставленных.Колонки.Добавить("СвПосредн");
			ЗаписиВыставленных.Колонки.Добавить("ВтчСумНДС", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
			ЗаписиВыставленных.Колонки.Добавить("РазнСтоимКСчФ");
			ЗаписиВыставленных.Колонки.Добавить("РазнНДСКСчФ");
		КонецЕсли;
		
		ЗаписиВыставленных.Колонки.Добавить("КодВидОпер", Новый ОписаниеТипов("Массив"));
		
		ЗаписиПолученных = Новый ТаблицаЗначений; // Часть 2: полученные счета-фактуры
		
		ЗаписиПолученных.Колонки.Добавить("НомПП", ОбщегоНазначения.ОписаниеТипаЧисло(12, 0));
		ЗаписиПолученных.Колонки.Добавить("ДатаПолСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиПолученных.Колонки.Добавить("НомерСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(1000));
		ЗаписиПолученных.Колонки.Добавить("ДатаСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиПолученных.Колонки.Добавить("НомерИспрСчФ", ОбщегоНазначения.ОписаниеТипаЧисло(3, 0));
		ЗаписиПолученных.Колонки.Добавить("ДатаИспрСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиПолученных.Колонки.Добавить("НомерКСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(1000));
		ЗаписиПолученных.Колонки.Добавить("ДатаКСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиПолученных.Колонки.Добавить("НомерИспрКСчФ", ОбщегоНазначения.ОписаниеТипаЧисло(3, 0));
		ЗаписиПолученных.Колонки.Добавить("ДатаИспрКСчФ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		
		ЗаписиПолученных.Колонки.Добавить("НаимПрод", ОбщегоНазначения.ОписаниеТипаСтрока(1000));
		ЗаписиПолученных.Колонки.Добавить("ИННЮЛ", ОбщегоНазначения.ОписаниеТипаСтрока(10));
		ЗаписиПолученных.Колонки.Добавить("КПП", ОбщегоНазначения.ОписаниеТипаСтрока(9));
		ЗаписиПолученных.Колонки.Добавить("ИННФЛ", ОбщегоНазначения.ОписаниеТипаСтрока(12));
		
		ЗаписиПолученных.Колонки.Добавить("КодОКВ", ОбщегоНазначения.ОписаниеТипаСтрока(3));
		ЗаписиПолученных.Колонки.Добавить("СтТовУчНалВсего", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
		ЗаписиПолученных.Колонки.Добавить("КодВидОпер", Новый ОписаниеТипов("Массив"));
		ЗаписиПолученных.Колонки.Добавить("СвПосредн");

		ЗаписиПолученных.Колонки.Добавить("ВтчСумНДС", ОбщегоНазначения.ОписаниеТипаЧисло(19, 2));
		
		ЗаписиПолученных.Колонки.Добавить("РазнСтоимКСчФ");
		ЗаписиПолученных.Колонки.Добавить("РазнНДСКСчФ");
		
		СтруктураПараметров.Вставить("ЗаписиВыставленных", ЗаписиВыставленных);
		СтруктураПараметров.Вставить("ЗаписиПолученных", ЗаписиПолученных);
	
	КонецЕсли;
	
КонецПроцедуры

Процедура ЗаполнитьСтрокуЖурналаУчетаСчетовФактур(
	ПараметрыСтроки, ЗаписьЖурналаУчетаСчетовФактур, СтруктураПараметров, ДополнительныеСвойства = Неопределено, НомерПП = 1, ЕстьПодстроки = Ложь) Экспорт
	
	// В соответствии с порядком заполнения журнала учета счетов-фактур, описанным в Постановлении № 981,
	// графы 14,16,17 части 1 журнала заполняются по-разному в зависимости от учетной ситуации.
	// Важно знать, разбивается ли строка на подстроки или нет.
	// В случае если не разбивается, то указанные графы заполняются полной суммой счета-фактуры.
	// Если разбивается, то графы заполняются стоимостью товаров(работ,услуг), приходящейся на продавца, указанного в графе 10.
	ВерсияПостановленияНДС1137 = УчетНДСПереопределяемый.ВерсияПостановленияНДС1137(СтруктураПараметров.НалоговыйПериод);
	Правила981 = ВерсияПостановленияНДС1137 >= 4;
	РазбиватьСумму = Правила981 И ЕстьПодстроки;
	
	ТекстБезНДС = "без НДС";
	ТекстПустаяСтрока = "";
	
	ЗаполнитьЗначенияСвойств(ПараметрыСтроки, ЗаписьЖурналаУчетаСчетовФактур);
	
		
	// Универсальная структура для заполнения журнала по разным версиям постановления
	СоставСтроки = Новый Структура;
	СоставСтроки.Вставить("КодОперации",       ЗаписьЖурналаУчетаСчетовФактур.КодВидаОперации);
	СоставСтроки.Вставить("НомерСчетаФактуры", ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры);
	СоставСтроки.Вставить("ДатаСчетаФактуры",  Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"));
	СоставСтроки.Вставить("НомерИсправления",  ЗаписьЖурналаУчетаСчетовФактур.НомерИсправления);
	СоставСтроки.Вставить("ДатаИсправления",   Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправления, "ДФ=dd.MM.yyyy"));
	СоставСтроки.Вставить("НомерКорректировочногоСчетаФактуры", ЗаписьЖурналаУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры);
	СоставСтроки.Вставить("ДатаКорректировочногоСчетаФактуры",  Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy"));
	
	СоставСтроки.Вставить("НомерДата",
		СтрШаблон(НСтр("ru='%1;%2'"), 
		СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры),
		Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"))); 
	СоставСтроки.Вставить("НомерОтДата", 
		СтрШаблон(НСтр("ru='%1 от %2'"), 
		СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры),
		Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"))); 
		
	Если ЗначениеЗаполнено(СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерИсправления)) Тогда
		СоставСтроки.Вставить("НомерДатаИсправления",
			СтрШаблон(НСтр("ru='%1;%2'"), 
			СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерИсправления),
			Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправления, "ДФ=dd.MM.yyyy")));
		СоставСтроки.Вставить("НомерОтДатаИсправленный",
			СтрШаблон(НСтр("ru='%1 от %2'"), 
			СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерИсправления),
			Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправления, "ДФ=dd.MM.yyyy")));
	Иначе
		СоставСтроки.Вставить("НомерДатаИсправления", "");
		СоставСтроки.Вставить("НомерОтДатаИсправленный", "");
	КонецЕсли;
	
	Если ЗначениеЗаполнено(СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры)) Тогда
		СоставСтроки.Вставить("НомерДатаКорректировки",
			СтрШаблон(НСтр("ru='%1;%2'"), 
			СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры),
			Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy")));
		СоставСтроки.Вставить("НомерОтДатаКорректировочный",
			СтрШаблон(НСтр("ru='%1 от %2'"), 
			СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры),
			Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy")));
	Иначе
		СоставСтроки.Вставить("НомерДатаКорректировки", "");
		СоставСтроки.Вставить("НомерОтДатаКорректировочный", "");
	КонецЕсли; 
	
	Если ЗначениеЗаполнено(СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры)) Тогда
		СоставСтроки.Вставить("НомерДатаИсправленияКорректировки",
			СтрШаблон(НСтр("ru='%1;%2'"), 
			СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры),
			Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy")));
		СоставСтроки.Вставить("НомерОтДатаИсправленныйКорректировочный",
			СтрШаблон(НСтр("ru='%1 от %2'"), 
			СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры),
			Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy")));
	Иначе
		СоставСтроки.Вставить("НомерДатаИсправленияКорректировки", "");
		СоставСтроки.Вставить("НомерОтДатаИсправленныйКорректировочный", "");
	КонецЕсли; 
	
	СоставСтроки.Вставить("ДатаПередачиПолучения", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаПередачиПолучения, "ДФ=dd.MM.yyyy"));
	СоставСтроки.Вставить("КонтрагентИННКПП", СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентИНН)
		+ ?(НЕ ПустаяСтрока(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентКПП),"/", "") + СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентКПП));
	СоставСтроки.Вставить("Валюта", СокрП(ЗаписьЖурналаУчетаСчетовФактур.НаименованиеВалюты) 
		+ ", " + ЗаписьЖурналаУчетаСчетовФактур.КодВалюты);
		
	СвПоКомиссионеруДляДокумента= 	Новый Структура();
	СвПоКомиссионеруДляДокумента.Вставить("КодВидСдел", ЗаписьЖурналаУчетаСчетовФактур.КодВидаСделки);
	Если ДополнительныеСвойства <> Неопределено Тогда
		ДопСвойстваСчетаФактуры = ДополнительныеСвойства.НайтиСтроки(Новый Структура("СчетФактура", ЗаписьЖурналаУчетаСчетовФактур.СчетФактураДокумент));
		Субкомиссионер          = "";
		СубкомиссионерИНН_КПП   = "";
		Если ДопСвойстваСчетаФактуры.Количество() > 0 Тогда
			ТаблицаДопСвойств = ДополнительныеСвойства.СкопироватьКолонки();
			Для каждого СтрокаДопСвойства Из ДопСвойстваСчетаФактуры Цикл
				НоваяСтрока = ТаблицаДопСвойств.Добавить();
				ЗаполнитьЗначенияСвойств(НоваяСтрока, СтрокаДопСвойства);
			КонецЦикла;
			ТаблицаДопСвойств.Сортировать("НомерСтроки");
			Для каждого СтрокаТаблицы Из ТаблицаДопСвойств Цикл
				Субкомиссионер = Субкомиссионер + ?(ПустаяСтрока(Субкомиссионер), "", ";") 
					+ СтрокаТаблицы.Субкомиссионер;
				СубкомиссионерИНН_КПП = СубкомиссионерИНН_КПП + ?(ПустаяСтрока(СубкомиссионерИНН_КПП), "", ";")
					+ СокрЛП(СтрокаТаблицы.СубкомиссионерИНН)
					+ ?(НЕ ПустаяСтрока(СтрокаТаблицы.СубкомиссионерКПП),"/", "") 
					+ СокрЛП(СтрокаТаблицы.СубкомиссионерКПП);
			КонецЦикла;
			
			// Формат выгрузки раздела 11 декларации по НДС (с 1 квартала 2015 года)
			// не учитывает возможность реализации товаров комитента через нескольких субкомиссионеров
			// в один день (и получение на все реализации сводного счета-фактуры от комитента).
			// Для выгрузки используется один из субкомиссионеров (по последней или единственной строке ТаблицаДопСвойств).
			
			Если ЗначениеЗаполнено(СтрокаТаблицы.СубкомиссионерИНН)
			 ИЛИ ЗначениеЗаполнено(СтрокаТаблицы.СубкомиссионерКПП) Тогда
				
				СвПоКомиссионеру = Новый Структура();
				СвПоКомиссионеру = УчетНДС.ПолучитьСтруктуруРеквизитовКонтрагента(
					СтрокаТаблицы.СубкомиссионерИНН, СтрокаТаблицы.СубкомиссионерКПП, СтрокаТаблицы.Субкомиссионер);
				
				СвПоКомиссионеруДляДекларации = Новый Структура();
				
				Если СвПоКомиссионеру.Свойство("ИННФЛ") Тогда
					СвПоКомиссионеруДляДекларации.Вставить("ИННФЛ", 	СвПоКомиссионеру.ИННФЛ);
					
					СвПоКомиссионеруДляДокумента.Вставить("ИННФЛСубКом", СвПоКомиссионеру.ИННФЛ);
					СвПоКомиссионеруДляДокумента.Вставить("Фамилия",     СвПоКомиссионеру.Фамилия);
					СвПоКомиссионеруДляДокумента.Вставить("Имя",         СвПоКомиссионеру.Имя);
					СвПоКомиссионеруДляДокумента.Вставить("Отчество",    СвПоКомиссионеру.Отчество);
				Иначе
					СвПоКомиссионеруДляДекларации.Вставить("ИННЮЛ", СвПоКомиссионеру.ИННЮЛ);
					СвПоКомиссионеруДляДекларации.Вставить("КПП",   СвПоКомиссионеру.КПП);
					
					СвПоКомиссионеруДляДокумента.Вставить("ИННЮЛСубКом", СвПоКомиссионеру.ИННЮЛ);
					СвПоКомиссионеруДляДокумента.Вставить("КППСубКом",   СвПоКомиссионеру.КПП);
					СвПоКомиссионеруДляДокумента.Вставить("НаимСубКом",  СвПоКомиссионеру.НаимОрг);
				КонецЕсли;
				
				СвПоКомиссионеруДляДекларации.Вставить("Контрагент", СтрокаТаблицы.СубкомиссионерСсылка);
				СвПоКомиссионеруДляДекларации.Вставить("КонтрагентНаименование", СтрокаТаблицы.Субкомиссионер);
				
				СоставСтроки.Вставить("СвКомис", СвПоКомиссионеруДляДекларации);
				
			КонецЕсли;
			
		КонецЕсли;
		
		СоставСтроки.Вставить("Субкомиссионер",        Субкомиссионер);
		СоставСтроки.Вставить("СубкомиссионерИНН_КПП", СубкомиссионерИНН_КПП);
		
	КонецЕсли;
	
	СоставСтроки.Вставить("КомитентИНН_КПП", СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.КомитентИНН)
		+ ?(НЕ ПустаяСтрока(ЗаписьЖурналаУчетаСчетовФактур.КомитентКПП),"/", "") + СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.КомитентКПП));	
		
	Если ЗначениеЗаполнено(СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактурыКомитента)) Тогда
		СоставСтроки.Вставить("НомерДатаСчетаФактурыКомитента",
			СтрШаблон(НСтр("ru='%1;%2'"), 
			СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактурыКомитента),
			Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактурыКомитента, "ДФ=dd.MM.yyyy")));
		СоставСтроки.Вставить("НомерОтДатаСчетаФактурыКомитента",
			СтрШаблон(НСтр("ru='%1 от %2'"), 
			СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактурыКомитента),
			Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактурыКомитента, "ДФ=dd.MM.yyyy")));
	Иначе
		СоставСтроки.Вставить("НомерДатаСчетаФактурыКомитента", "");
		СоставСтроки.Вставить("НомерОтДатаСчетаФактурыКомитента", "");
	КонецЕсли;
		
	Если ЗаписьЖурналаУчетаСчетовФактур.КорректировочныйСчетФактура Тогда
		
		СоставСтроки.Вставить("СуммаДокумента", ТекстПустаяСтрока);
		СоставСтроки.Вставить("СуммаНДС", ТекстПустаяСтрока);
		
		СоставСтроки.Вставить("СуммаДокументаРазницаУменьшение", ?(РазбиватьСумму,
			ЗаписьЖурналаУчетаСчетовФактур.СуммаДокументаРазницаУменьшениеКомиссия,
			ЗаписьЖурналаУчетаСчетовФактур.СуммаДокументаРазницаУменьшение));
		СоставСтроки.Вставить("СуммаДокументаРазницаУвеличение", ?(РазбиватьСумму,
			ЗаписьЖурналаУчетаСчетовФактур.СуммаДокументаРазницаУвеличениеКомиссия,
			ЗаписьЖурналаУчетаСчетовФактур.СуммаДокументаРазницаУвеличение));
		СоставСтроки.Вставить("СуммаНДСРазницаУменьшение", ЗаписьЖурналаУчетаСчетовФактур.СуммаНДСРазницаУменьшение);
		СоставСтроки.Вставить("СуммаНДСРазницаУвеличение", ЗаписьЖурналаУчетаСчетовФактур.СуммаНДСРазницаУвеличение);
		
	Иначе
		
		СоставСтроки.Вставить("СуммаДокумента", ?(РазбиватьСумму,
			ЗаписьЖурналаУчетаСчетовФактур.СуммаДокументаКомиссия,
			ЗаписьЖурналаУчетаСчетовФактур.СуммаДокумента));
		СоставСтроки.Вставить("СуммаНДС", ЗаписьЖурналаУчетаСчетовФактур.СуммаНДС);
		
		СоставСтроки.Вставить("НомерКорректировочногоСчетаФактуры", ТекстПустаяСтрока);
		СоставСтроки.Вставить("ДатаКорректировочногоСчетаФактуры", ТекстПустаяСтрока);
		
		СоставСтроки.Вставить("СуммаДокументаРазницаУменьшение", ТекстПустаяСтрока);
		СоставСтроки.Вставить("СуммаДокументаРазницаУвеличение", ТекстПустаяСтрока);
		СоставСтроки.Вставить("СуммаНДСРазницаУменьшение", ТекстПустаяСтрока);
		СоставСтроки.Вставить("СуммаНДСРазницаУвеличение", ТекстПустаяСтрока);
		
	КонецЕсли;
	
	Если ЗаписьЖурналаУчетаСчетовФактур.Контрагент = ЗаписьЖурналаУчетаСчетовФактур.Организация Тогда
		СоставСтроки.Вставить("КонтрагентНаименование", СтруктураПараметров.НаименованиеОрганизацииДляПечатныхФорм);
	КонецЕсли;
	
	Если ЗаписьЖурналаУчетаСчетовФактур.СчетФактураБезНДС Тогда
		
		СодержаниеГрафНДС = ?(ВерсияПостановленияНДС1137 >= 4, 0, ТекстБезНДС);
		Если ЗаписьЖурналаУчетаСчетовФактур.КорректировочныйСчетФактура Тогда
			СоставСтроки.Вставить("СуммаНДСРазницаУменьшение", СодержаниеГрафНДС);
			СоставСтроки.Вставить("СуммаНДСРазницаУвеличение", СодержаниеГрафНДС);
		Иначе
			СоставСтроки.Вставить("СуммаНДС", СодержаниеГрафНДС);
		КонецЕсли;
		
	КонецЕсли;
	
	ЗаполнитьЗначенияСвойств(ПараметрыСтроки, СоставСтроки);
	
	Если СтруктураПараметров.ЗаполнениеДекларации Тогда
		
		ДополнительныеСведения = Новый Структура("Контрагент,ПредставлениеКонтрагента,Документ,ПредставлениеДокумента");
		ДополнительныеСведения.Документ = ЗаписьЖурналаУчетаСчетовФактур.СчетФактураДокумент;
		ДополнительныеСведения.Контрагент = Справочники.Контрагенты.ПустаяСсылка();
		ДополнительныеСведения.ПредставлениеКонтрагента = "";
		
		Если ЗаписьЖурналаУчетаСчетовФактур.ЧастьЖурнала = Перечисления.ЧастиЖурналаУчетаСчетовФактур.ВыставленныеСчетаФактуры Тогда
			
			// Раздел 10
			
			ДополнительныеСведения.ПредставлениеДокумента = СтрШаблон(
				НСтр("ru='Счет-фактура выданный № %1 от %2 на сумму %3 %4'"), 
				ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры, 
				Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"),
				Формат(СоставСтроки.СуммаДокумента, "ЧДЦ=2; ЧН="),
				ЗаписьЖурналаУчетаСчетовФактур.НаименованиеВалютыКраткое);
			
			// Массив структур со сведениями о посреднической деятельности
			СтруктураСвПосрДеят = Новый Структура(
				"НомСчФОтПрод,ДатаСчФОтПрод,ОКВ,СтоимТовСчФВс,СумНДССчФ,РазСтКСчФУм,РазСтКСчФУв,РазНДСКСчФУм,РазНДСКСчФУв,СвПрод");
				
			СтруктураСвПосрДеят.НомСчФОтПрод  = СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактурыКомитента);
			СтруктураСвПосрДеят.ДатаСчФОтПрод = Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактурыКомитента, "ДФ=dd.MM.yyyy");
			СтруктураСвПосрДеят.ОКВ           = ЗаписьЖурналаУчетаСчетовФактур.КодВалюты;
			
			СтруктураСвПосрДеят.СтоимТовСчФВс =
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокумента, ТекстБезНДС, ТекстПустаяСтрока);
			СтруктураСвПосрДеят.СумНДССчФ =
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДС, ТекстБезНДС, ТекстПустаяСтрока);
			СтруктураСвПосрДеят.РазСтКСчФУм =
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокументаРазницаУменьшение, ТекстБезНДС, ТекстПустаяСтрока);
			СтруктураСвПосрДеят.РазСтКСчФУв =
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокументаРазницаУвеличение, ТекстБезНДС, ТекстПустаяСтрока);
			СтруктураСвПосрДеят.РазНДСКСчФУм =
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДСРазницаУменьшение, ТекстБезНДС, ТекстПустаяСтрока);
			СтруктураСвПосрДеят.РазНДСКСчФУв =
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДСРазницаУвеличение, ТекстБезНДС, ТекстПустаяСтрока);
			
			Если ЗначениеЗаполнено(ЗаписьЖурналаУчетаСчетовФактур.КомитентИНН)
			 ИЛИ ЗначениеЗаполнено(ЗаписьЖурналаУчетаСчетовФактур.КомитентКПП) Тогда
				СтруктуруРеквизитовКомитента = УчетНДС.ПолучитьСтруктуруРеквизитовКонтрагента(
					ЗаписьЖурналаУчетаСчетовФактур.КомитентИНН, ЗаписьЖурналаУчетаСчетовФактур.КомитентКПП);
				СтруктуруРеквизитовКомитента.Вставить("Контрагент", ЗаписьЖурналаУчетаСчетовФактур.КомитентСсылка);
				СтруктуруРеквизитовКомитента.Вставить("КонтрагентНаименование", ЗаписьЖурналаУчетаСчетовФактур.Комитент);
				СтруктураСвПосрДеят.СвПрод = СтруктуруРеквизитовКомитента;
			КонецЕсли;

			СоставСтроки.Вставить("ДополнительныеСведения", ДополнительныеСведения);
			
			СтруктураОтбора = Новый Структура("НомерПор", НомерПП);
			// Осуществляем поиск по таблице, в случае если записи нет - добавляем новую строку,
			// иначе добавляем сведения о комитенте в колонку "СвПосрДеят" (с 1 кв 2017 года в "СвСчФОтПрод").
			СтрокиРаздела10 = СтруктураПараметров.ТаблицаРаздел10.НайтиСтроки(СтруктураОтбора);
			
			Если СтрокиРаздела10.Количество() = 0 Тогда
				
				СтрокаРаздела = СтруктураПараметров.ТаблицаРаздел10.Добавить();
				
				СоставСтроки.Вставить("НомерПор", НомерПП);
				Если СтруктураПараметров.ПравилаЗаполнения = "2015Кв1" Тогда
					СоставСтроки.Вставить("ДатаВыст", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаПередачиПолучения, "ДФ=dd.MM.yyyy"));
				КонецЕсли;
				
				СоставСтроки.Вставить("НомСчФПрод", ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры);
				СоставСтроки.Вставить("ДатаСчФПрод", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"));
				
				СоставСтроки.Вставить("НомИспрСчФ", ЗаписьЖурналаУчетаСчетовФактур.НомерИсправления);
				СоставСтроки.Вставить("ДатаИспрСчФ", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправления, "ДФ=dd.MM.yyyy"));
				
				СоставСтроки.Вставить("НомКСчФПрод", ЗаписьЖурналаУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры);
				СоставСтроки.Вставить("ДатаКСчФПрод", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy"));
				
				СоставСтроки.Вставить("НомИспрКСчФ", ЗаписьЖурналаУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры);
				СоставСтроки.Вставить("ДатаИспрКСчФ", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy"));
				
				МассивКодовОпераций = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(ЗаписьЖурналаУчетаСчетовФактур.КодВидаОперации, ";");
				СоставСтроки.Вставить("КодВидОпер", МассивКодовОпераций);
				
				Если ЗначениеЗаполнено(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентИНН)
				 ИЛИ ЗначениеЗаполнено(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентКПП) Тогда
					СтруктураРеквизитовКонтрагента = УчетНДС.ПолучитьСтруктуруРеквизитовКонтрагента(
						ЗаписьЖурналаУчетаСчетовФактур.КонтрагентИНН, ЗаписьЖурналаУчетаСчетовФактур.КонтрагентКПП);
					СтруктураРеквизитовКонтрагента.Вставить("Контрагент", ЗаписьЖурналаУчетаСчетовФактур.Контрагент);
					СтруктураРеквизитовКонтрагента.Вставить("КонтрагентНаименование", ЗаписьЖурналаУчетаСчетовФактур.КонтрагентНаименование);
					СоставСтроки.Вставить("СвПокуп", СтруктураРеквизитовКонтрагента);
				КонецЕсли;
				
				ДополнительныеСведения.Контрагент = ЗаписьЖурналаУчетаСчетовФактур.Контрагент;
				ДополнительныеСведения.ПредставлениеКонтрагента = ЗаписьЖурналаУчетаСчетовФактур.КонтрагентНаименование;
				
				МассивСвПосрДеят = Новый Массив();
				МассивСвПосрДеят.Добавить(СтруктураСвПосрДеят);
				
				Если СтруктураПараметров.ПравилаЗаполнения = "2015Кв1" Тогда
					СоставСтроки.Вставить("СвПосрДеят", МассивСвПосрДеят);
				ИначеЕсли СтруктураПараметров.ПравилаЗаполнения = "2017Кв1"
				      ИЛИ СтруктураПараметров.ПравилаЗаполнения = "2019Кв1" Тогда
					СоставСтроки.Вставить("СвСчФОтПрод", МассивСвПосрДеят);
				КонецЕсли; 
				
				СоставСтроки.Вставить("СуммаПосрДеят", СтруктураСвПосрДеят.СтоимТовСчФВс);
				
				ЗаполнитьЗначенияСвойств(СтрокаРаздела, СоставСтроки);
				
			Иначе
				
				СтрокаРаздела = СтрокиРаздела10[0];
				СтрокаРаздела.СуммаПосрДеят = СтрокаРаздела.СуммаПосрДеят + СтруктураСвПосрДеят.СтоимТовСчФВс;
				
				Если СтруктураПараметров.ПравилаЗаполнения = "2015Кв1" Тогда
					МассивСвПосрДеят = СтрокаРаздела.СвПосрДеят;
				ИначеЕсли СтруктураПараметров.ПравилаЗаполнения = "2017Кв1"
				      ИЛИ СтруктураПараметров.ПравилаЗаполнения = "2019Кв1" Тогда
					МассивСвПосрДеят = СтрокаРаздела.СвСчФОтПрод;
				КонецЕсли;
				МассивСвПосрДеят.Добавить(СтруктураСвПосрДеят);
				
				ДополнительныеСведения = СтрокаРаздела.ДополнительныеСведения;
				ДополнительныеСведения.ПредставлениеДокумента = СтрШаблон(
					НСтр("ru='Счет-фактура выданный № %1 от %2 на сумму %3 %4'"), 
					ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры, 
					Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"),
					Формат(СтрокаРаздела.СуммаПосрДеят, "ЧДЦ=2; ЧН="),
					ЗаписьЖурналаУчетаСчетовФактур.НаименованиеВалютыКраткое);
				
			КонецЕсли;
			
		Иначе
			
			// Раздел 11
			
			ДополнительныеСведения.ПредставлениеДокумента = СтрШаблон(
				НСтр("ru='Счет-фактура полученный № %1 от %2 на сумму %3 %4'"), 
				ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры, 
				Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"),
				Формат(СоставСтроки.СуммаДокумента, "ЧДЦ=2; ЧН="),
				ЗаписьЖурналаУчетаСчетовФактур.НаименованиеВалютыКраткое);
			
			СоставСтроки.Вставить("НомерПор", НомерПП);
			Если СтруктураПараметров.ПравилаЗаполнения = "2015Кв1" Тогда
				СоставСтроки.Вставить("ДатаПолуч", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаПередачиПолучения, "ДФ=dd.MM.yyyy"));
			КонецЕсли;
			
			СоставСтроки.Вставить("НомСчФПрод", ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры);
			СоставСтроки.Вставить("ДатаСчФПрод", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"));
			
			СоставСтроки.Вставить("НомИспрСчФ", ЗаписьЖурналаУчетаСчетовФактур.НомерИсправления);
			СоставСтроки.Вставить("ДатаИспрСчФ", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправления, "ДФ=dd.MM.yyyy"));
			
			СоставСтроки.Вставить("НомКСчФПрод", ЗаписьЖурналаУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры);
			СоставСтроки.Вставить("ДатаКСчФПрод", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy"));
			
			СоставСтроки.Вставить("НомИспрКСчФ", ЗаписьЖурналаУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры);
			СоставСтроки.Вставить("ДатаИспрКСчФ", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy"));
			
			МассивКодовОпераций = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(ЗаписьЖурналаУчетаСчетовФактур.КодВидаОперации, ";");
			СоставСтроки.Вставить("КодВидОпер", МассивКодовОпераций);
			СоставСтроки.Вставить("КодВидСд", ЗаписьЖурналаУчетаСчетовФактур.КодВидаСделки);
			СоставСтроки.Вставить("ОКВ", ЗаписьЖурналаУчетаСчетовФактур.КодВалюты);
			
			СоставСтроки.Вставить("СтоимТовСчФВс",
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокумента, ТекстБезНДС, ТекстПустаяСтрока));
			СоставСтроки.Вставить("СумНДССчФ",
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДС, ТекстБезНДС, ТекстПустаяСтрока));
			СоставСтроки.Вставить("РазСтКСчФУм",
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокументаРазницаУменьшение, ТекстБезНДС, ТекстПустаяСтрока));
			СоставСтроки.Вставить("РазСтКСчФУв",
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокументаРазницаУвеличение, ТекстБезНДС, ТекстПустаяСтрока));
			СоставСтроки.Вставить("РазНДСКСчФУм",
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДСРазницаУменьшение, ТекстБезНДС, ТекстПустаяСтрока));
			СоставСтроки.Вставить("РазНДСКСчФУв",
				ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДСРазницаУвеличение, ТекстБезНДС, ТекстПустаяСтрока));
			
			Если ЗначениеЗаполнено(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентИНН)
			 ИЛИ ЗначениеЗаполнено(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентКПП) Тогда
				СтруктураРеквизитовПродавца = УчетНДС.ПолучитьСтруктуруРеквизитовКонтрагента(
					ЗаписьЖурналаУчетаСчетовФактур.КонтрагентИНН, ЗаписьЖурналаУчетаСчетовФактур.КонтрагентКПП);
				СтруктураРеквизитовПродавца.Вставить("Контрагент", ЗаписьЖурналаУчетаСчетовФактур.Контрагент);
				СтруктураРеквизитовПродавца.Вставить("КонтрагентНаименование", ЗаписьЖурналаУчетаСчетовФактур.КонтрагентНаименование);
				СоставСтроки.Вставить("СвПрод", СтруктураРеквизитовПродавца);
			КонецЕсли;
			
			ДополнительныеСведения.Контрагент = ЗаписьЖурналаУчетаСчетовФактур.Контрагент;
			ДополнительныеСведения.ПредставлениеКонтрагента = ЗаписьЖурналаУчетаСчетовФактур.КонтрагентНаименование;
		
			СоставСтроки.Вставить("ДополнительныеСведения", ДополнительныеСведения);
			
			СтрокаРаздела = СтруктураПараметров.ТаблицаРаздел11.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаРаздела, СоставСтроки);
			
		КонецЕсли;
		
	ИначеЕсли СтруктураПараметров.ЗаполнениеДокумента 
		И СтруктураПараметров.ФорматПоПостановлению735 Тогда
		
		Если ЗаписьЖурналаУчетаСчетовФактур.ЧастьЖурнала = Перечисления.ЧастиЖурналаУчетаСчетовФактур.ВыставленныеСчетаФактуры Тогда
			
			// С 01.10.2017 сведения о посреднической деятельности передаются в массиве структур
			СвГр10_19 = Новый Структура("КодОКВ,СтТовУчНалВсего,СвПосредн,ВтчСумНДС,РазнСтоимКСчФ,РазнНДСКСчФ");
			
			СоставСтроки.Вставить("КодОКВ", 	ЗаписьЖурналаУчетаСчетовФактур.КодВалюты);
			СоставСтроки.Вставить("СтТовУчНалВсего",
			ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокумента, ТекстБезНДС, ТекстПустаяСтрока));
			МассивКодовОпераций = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(ЗаписьЖурналаУчетаСчетовФактур.КодВидаОперации, ";");	
			СоставСтроки.Вставить("КодВидОпер", МассивКодовОпераций);
			
			СвПосредн = Новый Структура();
			СвПосредн.Вставить("НомерСчФпрод", СокрЛП(ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактурыКомитента));
			СвПосредн.Вставить("ДатаСчФпрод",  Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактурыКомитента, "ДФ=dd.MM.yyyy"));
			
			Если НЕ ПустаяСтрока(ЗаписьЖурналаУчетаСчетовФактур.КомитентИНН) Тогда
				
				СтруктураРеквизитовКонтрагента = УчетНДС.ПолучитьСтруктуруРеквизитовКонтрагента(ЗаписьЖурналаУчетаСчетовФактур.КомитентИНН, ЗаписьЖурналаУчетаСчетовФактур.КомитентКПП, ЗаписьЖурналаУчетаСчетовФактур.Комитент);
				
				Если СтруктураРеквизитовКонтрагента.Свойство("ИННФЛ") Тогда
					СвПосредн.Вставить("ИННФЛ", 	СтруктураРеквизитовКонтрагента.ИННФЛ);
					СвПосредн.Вставить("Фамилия", 	СтруктураРеквизитовКонтрагента.Фамилия);
					СвПосредн.Вставить("Имя", 		СтруктураРеквизитовКонтрагента.Имя);
					СвПосредн.Вставить("Отчество", 	СтруктураРеквизитовКонтрагента.Отчество);
				Иначе
					СвПосредн.Вставить("ИННЮЛ", 	СтруктураРеквизитовКонтрагента.ИННЮЛ);
					СвПосредн.Вставить("КПП", 		СтруктураРеквизитовКонтрагента.КПП);
					СвПосредн.Вставить("НаимОрг ", 	СтруктураРеквизитовКонтрагента.НаимОрг );
				КонецЕсли;
				
				Если СвПосредн.НомерСчФпрод <> "" Тогда 
					СоставСтроки.Вставить("СвПосредн", СвПосредн);
				КонецЕсли;
				
			КонецЕсли;
			
			СоставСтроки.Вставить("ВтчСумНДС",
			ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДС, ТекстБезНДС, ТекстПустаяСтрока));
			
			РазнСтоимКСчФ = Новый Структура();
			Ум = ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокументаРазницаУменьшение, ТекстБезНДС, ТекстПустаяСтрока);
			Если Ум <> 0 Тогда 
				РазнСтоимКСчФ.Вставить("Ум", Ум);
			КонецЕсли;
			Увел = ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокументаРазницаУвеличение, ТекстБезНДС, ТекстПустаяСтрока);
			Если Увел <> 0 Тогда 
				РазнСтоимКСчФ.Вставить("Увел", Увел);
			КонецЕсли;
			
			Если РазнСтоимКСчФ.Свойство("Ум")
				ИЛИ РазнСтоимКСчФ.Свойство("Увел") Тогда 
				СоставСтроки.Вставить("РазнСтоимКСчФ", РазнСтоимКСчФ);
			КонецЕсли;
			
			РазнНДСКСчФ = Новый Структура();
			Ум = ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДСРазницаУменьшение, ТекстБезНДС, ТекстПустаяСтрока);
			Если Ум <> 0 Тогда 
				РазнНДСКСчФ.Вставить("Ум", Ум);
			КонецЕсли;
			Увел = ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДСРазницаУвеличение, ТекстБезНДС, ТекстПустаяСтрока);
			Если Увел <> 0 Тогда 
				РазнНДСКСчФ.Вставить("Увел", Увел);
			КонецЕсли;
			
			Если РазнНДСКСчФ.Свойство("Ум")
				ИЛИ РазнНДСКСчФ.Свойство("Увел") Тогда 
				СоставСтроки.Вставить("РазнНДСКСчФ", РазнНДСКСчФ);
			КонецЕсли;
			
			ЗаполнитьЗначенияСвойств(СвГр10_19, СоставСтроки);
			
			СтруктураОтбора = Новый Структура("НомПП", НомерПП);
			// Осуществляем поиск по таблице, в случе если записи нет - добавляем новую строку,
			// иначе для периода до 01.10.2017 - не добавляем (не предусмотрено форматом)
			//       для периода после 01.10.2017 - добавляем
			СтрокиЧ1 = СтруктураПараметров.ЗаписиВыставленных.НайтиСтроки(СтруктураОтбора);
			Если СтрокиЧ1.Количество()= 0 Тогда 
				
				СоставСтроки.Вставить("НомПП", 			НомерПП);
				СоставСтроки.Вставить("ДатаВыстСчФ", 	Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаПередачиПолучения, "ДФ=dd.MM.yyyy"));
				СоставСтроки.Вставить("НомерСчФ", 		ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры);
				СоставСтроки.Вставить("ДатаСчФ", 		Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"));
				СоставСтроки.Вставить("НомерИспрСчФ", 	ЗаписьЖурналаУчетаСчетовФактур.НомерИсправления);
				СоставСтроки.Вставить("ДатаИспрСчФ", 	Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправления, "ДФ=dd.MM.yyyy"));
				СоставСтроки.Вставить("НомерКСчФ", 		ЗаписьЖурналаУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры);
				СоставСтроки.Вставить("ДатаКСчФ", 		Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy"));
				СоставСтроки.Вставить("НомерИспрКСчФ", 	ЗаписьЖурналаУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры);
				СоставСтроки.Вставить("ДатаИспрКСчФ", 	Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy"));
				СоставСтроки.Вставить("НаимПок", 		ПараметрыСтроки.КонтрагентНаименование);
				
				Если НЕ ПустаяСтрока(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентИНН) Тогда
					СтруктураРеквизитовКонтрагента = УчетНДС.ПолучитьСтруктуруРеквизитовКонтрагента(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентИНН, ЗаписьЖурналаУчетаСчетовФактур.КонтрагентКПП);
					Если СтруктураРеквизитовКонтрагента.Свойство("ИННФЛ") Тогда
						СоставСтроки.Вставить("ИННФЛ", 	СтруктураРеквизитовКонтрагента.ИННФЛ);
					Иначе
						СоставСтроки.Вставить("ИННЮЛ", 	СтруктураРеквизитовКонтрагента.ИННЮЛ);
						СоставСтроки.Вставить("КПП",	СтруктураРеквизитовКонтрагента.КПП);
					КонецЕсли;
				КонецЕсли;
				
				Если СтруктураПараметров.НалоговыйПериод >= '20171001' Тогда
					МассивСвПосрДеят = Новый Массив();
					МассивСвПосрДеят.Добавить(СвГр10_19);
					СоставСтроки.Вставить("СвГр10_19", МассивСвПосрДеят);
				КонецЕсли; 
				
				СтрокаРаздела = СтруктураПараметров.ЗаписиВыставленных.Добавить();
				ЗаполнитьЗначенияСвойств(СтрокаРаздела, СоставСтроки);
			ИначеЕсли СтруктураПараметров.НалоговыйПериод >= '20171001' Тогда
				
				СтрокаРаздела = СтрокиЧ1[0];
				
				МассивСвПосрДеят = СтрокаРаздела.СвГр10_19;
				МассивСвПосрДеят.Добавить(СвГр10_19);
				
			КонецЕсли;
		Иначе
			
			СоставСтроки.Вставить("НомПП", НомерПП);
			СоставСтроки.Вставить("ДатаПолСчФ", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаПередачиПолучения, "ДФ=dd.MM.yyyy"));
			
			СоставСтроки.Вставить("НомерСчФ", ЗаписьЖурналаУчетаСчетовФактур.НомерСчетаФактуры);
			СоставСтроки.Вставить("ДатаСчФ", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаСчетаФактуры, "ДФ=dd.MM.yyyy"));
			
			СоставСтроки.Вставить("НомерИспрСчФ", ЗаписьЖурналаУчетаСчетовФактур.НомерИсправления);
			СоставСтроки.Вставить("ДатаИспрСчФ", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправления, "ДФ=dd.MM.yyyy"));
			
			СоставСтроки.Вставить("НомерКСчФ", ЗаписьЖурналаУчетаСчетовФактур.НомерКорректировочногоСчетаФактуры);
			СоставСтроки.Вставить("ДатаКСчФ", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy"));
			
			СоставСтроки.Вставить("НомерИспрКСчФ", ЗаписьЖурналаУчетаСчетовФактур.НомерИсправленияКорректировочногоСчетаФактуры);
			СоставСтроки.Вставить("ДатаИспрКСчФ", Формат(ЗаписьЖурналаУчетаСчетовФактур.ДатаИсправленияКорректировочногоСчетаФактуры, "ДФ=dd.MM.yyyy"));
			
			СоставСтроки.Вставить("НаимПрод", ПараметрыСтроки.КонтрагентНаименование);
			
			Если НЕ ПустаяСтрока(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентИНН) Тогда
				СтруктураРеквизитовКонтрагента = УчетНДС.ПолучитьСтруктуруРеквизитовКонтрагента(ЗаписьЖурналаУчетаСчетовФактур.КонтрагентИНН, ЗаписьЖурналаУчетаСчетовФактур.КонтрагентКПП, ПараметрыСтроки.КонтрагентНаименование);
				Если СтруктураРеквизитовКонтрагента.Свойство("ИННФЛ") Тогда
					СоставСтроки.Вставить("ИННФЛ", 	СтруктураРеквизитовКонтрагента.ИННФЛ);
				Иначе
					СоставСтроки.Вставить("ИННЮЛ", 	СтруктураРеквизитовКонтрагента.ИННЮЛ);
					СоставСтроки.Вставить("КПП",	СтруктураРеквизитовКонтрагента.КПП);
				КонецЕсли;
				
				Если СтруктураПараметров.НалоговыйПериод < '20171001' Тогда
					// Формат выгрузки предполагает обязательное присутствие субкомиссионера
					Если НЕ СвПоКомиссионеруДляДокумента.Свойство("НаимСубКом")
						И НЕ СвПоКомиссионеруДляДокумента.Свойство("Фамилия")
						И СвПоКомиссионеруДляДокумента.КодВидСдел <> "" Тогда
						Если СоставСтроки.Свойство("ИННЮЛ") Тогда 
							СвПоКомиссионеруДляДокумента.Вставить("ИННЮЛСубКом", СоставСтроки.ИННЮЛ);
							СвПоКомиссионеруДляДокумента.Вставить("КППСубКом", СоставСтроки.КПП);
							СвПоКомиссионеруДляДокумента.Вставить("НаимСубКом", ПараметрыСтроки.КонтрагентНаименование);
						Иначе
							СвПоКомиссионеруДляДокумента.Вставить("ИННФЛСубКом ", СоставСтроки.ИННФЛ);
							СвПоКомиссионеруДляДокумента.Вставить("Фамилия", СтруктураРеквизитовКонтрагента.Фамилия);
							СвПоКомиссионеруДляДокумента.Вставить("Имя", СтруктураРеквизитовКонтрагента.Имя);
							СвПоКомиссионеруДляДокумента.Вставить("Отчество", СтруктураРеквизитовКонтрагента.Отчество);
						КонецЕсли;
					КонецЕсли;
				КонецЕсли;
			КонецЕсли;
			
			СоставСтроки.Вставить("КодОКВ", 	ЗаписьЖурналаУчетаСчетовФактур.КодВалюты);
			СоставСтроки.Вставить("СтТовУчНалВсего",
					ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокумента, ТекстБезНДС, ТекстПустаяСтрока));
			МассивКодовОпераций = СтроковыеФункцииКлиентСервер.РазложитьСтрокуВМассивПодстрок(ЗаписьЖурналаУчетаСчетовФактур.КодВидаОперации, ";");
			СоставСтроки.Вставить("КодВидОпер", МассивКодовОпераций);
			
			Если СвПоКомиссионеруДляДокумента.КодВидСдел <> "" 
				ИЛИ СтруктураПараметров.НалоговыйПериод >= '20171001' Тогда
				СоставСтроки.Вставить("СвПосредн", СвПоКомиссионеруДляДокумента);
			КонецЕсли;
			СоставСтроки.Вставить("ВтчСумНДС",
			ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДС, ТекстБезНДС, ТекстПустаяСтрока));
			
			РазнСтоимКСчФ = Новый Структура();
			Ум = ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокументаРазницаУменьшение, ТекстБезНДС, ТекстПустаяСтрока);
			Если Ум <> 0 Тогда 
				РазнСтоимКСчФ.Вставить("Ум", Ум);
			КонецЕсли;
			Увел = ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаДокументаРазницаУвеличение, ТекстБезНДС, ТекстПустаяСтрока);
			Если Увел <> 0 Тогда 
				РазнСтоимКСчФ.Вставить("Увел", Увел);
			КонецЕсли;
			
			Если РазнСтоимКСчФ.Свойство("Ум")
				ИЛИ РазнСтоимКСчФ.Свойство("Увел") Тогда 
				СоставСтроки.Вставить("РазнСтоимКСчФ", РазнСтоимКСчФ);
			КонецЕсли;
			
			РазнНДСКСчФ = Новый Структура();
			Ум = ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДСРазницаУменьшение, ТекстБезНДС, ТекстПустаяСтрока);
			Если Ум <> 0 Тогда 
				РазнНДСКСчФ.Вставить("Ум", Ум);
			КонецЕсли;
			Увел = ПреобразоватьСтрокуВФорматДекларации(СоставСтроки.СуммаНДСРазницаУвеличение, ТекстБезНДС, ТекстПустаяСтрока);
			Если Увел <> 0 Тогда 
				РазнНДСКСчФ.Вставить("Увел", Увел);
			КонецЕсли;
			
			Если РазнНДСКСчФ.Свойство("Ум")
				ИЛИ РазнНДСКСчФ.Свойство("Увел") Тогда 
				СоставСтроки.Вставить("РазнНДСКСчФ", РазнНДСКСчФ);
			КонецЕсли;
			
			СтрокаРаздела = СтруктураПараметров.ЗаписиПолученных.Добавить();
			ЗаполнитьЗначенияСвойств(СтрокаРаздела, СоставСтроки);
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Функция ПреобразоватьСтрокуВФорматДекларации(ИсходныйПоказатель, ТекстБезНДС, ТекстПустаяСтрока)
	
	Если Строка(ИсходныйПоказатель) = ТекстБезНДС
		ИЛИ Строка(ИсходныйПоказатель) = ТекстПустаяСтрока Тогда
		Возврат 0;
	Иначе
		Возврат ИсходныйПоказатель;
	КонецЕсли;
	
КонецФункции

#КонецОбласти

#КонецЕсли