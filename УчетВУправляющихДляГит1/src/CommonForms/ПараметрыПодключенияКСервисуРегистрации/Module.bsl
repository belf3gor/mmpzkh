#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ПрочитатьЗначенияКонстант();
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗакрытием(Отказ, ЗавершениеРаботы, ТекстПредупреждения, СтандартнаяОбработка)
	
	Если Модифицированность Тогда
		
		Отказ = Истина;
		
		Если ЗавершениеРаботы Тогда
			Возврат;
		КонецЕсли;
		
		Оповещение = Новый ОписаниеОповещения("ВопросПередЗакрытиемЗавершение", ЭтотОбъект);
		ТекстВопроса = НСтр("ru = 'Данные были изменены. Сохранить изменения?'");
		ПоказатьВопрос(Оповещение, ТекстВопроса, РежимДиалогаВопрос.ДаНетОтмена);
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ЗаписатьИЗакрыть(Команда)
	
	ЗаписатьЗначенияКонстант();
	Закрыть();
	
КонецПроцедуры

&НаКлиенте
Процедура Записать(Команда)
	
	ЗаписатьЗначенияКонстант();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаСервере
Процедура ПрочитатьЗначенияКонстант()
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
	"ВЫБРАТЬ
	|	ИспользоватьСервисРегистрации.Значение КАК ИспользоватьСервисРегистрации,
	|	АдресДемобазы.Значение КАК АдресДемобазы,
	|	АдресСервисаРегистрации.Значение КАК АдресСервисаРегистрации,
	|	ИмяПользователяСервисаРегистрации.Значение КАК ИмяПользователяСервисаРегистрации
	|ИЗ
	|	Константа.ИспользоватьСервисРегистрации КАК ИспользоватьСервисРегистрации,
	|	Константа.АдресДемобазы КАК АдресДемобазы,
	|	Константа.АдресСервисаРегистрации КАК АдресСервисаРегистрации,
	|	Константа.ИмяПользователяСервисаРегистрации КАК ИмяПользователяСервисаРегистрации";
	
	Выборка = Запрос.Выполнить().Выбрать();
	Если Выборка.Следующий() Тогда
		ЗаполнитьЗначенияСвойств(ЭтотОбъект, Выборка);
	КонецЕсли;
	
	Если Не ПустаяСтрока(ИмяПользователяСервисаРегистрации) Тогда
		
		ПарольПользователяСервисаРегистрации = ОбщегоНазначения.ПрочитатьДанныеИзБезопасногоХранилища(
			ИмяПользователяСервисаРегистрации,
			"ПарольПользователяСервисаРегистрации",
			Истина);
		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗаписатьЗначенияКонстант()
	
	Константы.ИспользоватьСервисРегистрации.Установить(ИспользоватьСервисРегистрации);
	Константы.АдресДемобазы.Установить(АдресДемобазы);
	Константы.АдресСервисаРегистрации.Установить(АдресСервисаРегистрации);
	Константы.ИмяПользователяСервисаРегистрации.Установить(ИмяПользователяСервисаРегистрации);
	
	Если Не ПустаяСтрока(ИмяПользователяСервисаРегистрации) Тогда
		ОбщегоНазначения.ЗаписатьДанныеВБезопасноеХранилище(
			ИмяПользователяСервисаРегистрации,
			ПарольПользователяСервисаРегистрации,
			"ПарольПользователяСервисаРегистрации");
	КонецЕсли;
	
	Модифицированность = Ложь;
	
КонецПроцедуры

&НаКлиенте
Процедура ВопросПередЗакрытиемЗавершение(Результат, ДополнительныеПараметры) Экспорт
	
	Если Результат = КодВозвратаДиалога.Да Тогда
		ЗаписатьЗначенияКонстант();
		Закрыть();
	ИначеЕсли Результат = КодВозвратаДиалога.Нет Тогда
		Модифицированность = Ложь;
		Закрыть();
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти