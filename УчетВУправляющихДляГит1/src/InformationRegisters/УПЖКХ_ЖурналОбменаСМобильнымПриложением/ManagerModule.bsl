
/////////////////////////////////////////////////////////////////////////
// ПОЛУЧЕНИЕ СВЕДЕНИЙ О ФАЙЛЕ

#Область ПолучениеСведенийОФайле

&НаСервере
// Формирует сведения о файле обмена.
//
Функция ПолучитьСведенияОФайлеОбмена(СтруктураОтбора) Экспорт
	
	// Формируем итоговую структуру сведений о файле.
	СтруктураСведенийОФайле = Новый Структура("СохраненныйФайл, РасширениеФайла, ВидОбмена");
	
	// Заполняем структуру для отбора записи из регистра.
	СтруктураОтбораТекущая = Новый Структура("ДатаОбмена, ВидОбмена");
	ЗаполнитьЗначенияСвойств(СтруктураОтбораТекущая, СтруктураОтбора);
	
	// Получаем искомую запись регистра.
	НайденнаяЗапись = РегистрыСведений.УПЖКХ_ЖурналОбменаСМобильнымПриложением.Получить(СтруктураОтбораТекущая);
	
	// Заполняем итоговую структуру сведений о файле.
	Если НЕ НайденнаяЗапись = Неопределено Тогда
		
		СохраненныйФайл = НайденнаяЗапись.ФайлОбмена.Получить();
		Расширение      = ПолучитьРасширениеФайлаОбмена(СохраненныйФайл);
		
		СтруктураСведенийОФайле.СохраненныйФайл = СохраненныйФайл;
		СтруктураСведенийОФайле.РасширениеФайла = Расширение;
		СтруктураСведенийОФайле.ВидОбмена       = СтруктураОтбораТекущая.ВидОбмена;
		
	КонецЕсли;
	
	Возврат СтруктураСведенийОФайле;
	
КонецФункции

&НаСервере
// Определяет расширение сохраненного файла обмена.
Функция ПолучитьРасширениеФайлаОбмена(СохраненныйФайл)
	
	ПервыеСимволы = Лев(Base64Строка(СохраненныйФайл), 7);
	
	Расширение = "";
	
	// xml.
	Если ПервыеСимволы = "77u/PD9" Тогда
		Расширение = "xml";
	// zip.
	Иначе
		ПервыеСимволы = Лев(Base64Строка(СохраненныйФайл), 3);
		
		Если ПервыеСимволы = "UEs" Тогда
			Расширение = "zip";
		КонецЕсли;
	КонецЕсли;
	
	Возврат Расширение;
	
КонецФункции


#КонецОбласти