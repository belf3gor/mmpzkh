#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПрограммныйИнтерфейс

#Область ДляВызоваИзДругихПодсистем

// СтандартныеПодсистемы.УправлениеДоступом

// См. УправлениеДоступомПереопределяемый.ПриЗаполненииСписковСОграничениемДоступа.
Процедура ПриЗаполненииОграниченияДоступа(Ограничение) Экспорт

	Ограничение.Текст =
	"РазрешитьЧтениеИзменение
	|ГДЕ
	|	ЗначениеРазрешено(Организация)";

КонецПроцедуры

// Конец СтандартныеПодсистемы.УправлениеДоступом

#КонецОбласти

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура УстановитьОсновнойВариантПеречисления(Организация, ФизическоеЛицо, ВидОперации, БанковскийСчет, НазначениеПлатежа = Неопределено) Экспорт
	
	Если НЕ ЗначениеЗаполнено(Организация)
		ИЛИ НЕ ЗначениеЗаполнено(ФизическоеЛицо)
		ИЛИ НЕ ЗначениеЗаполнено(ВидОперации)
		ИЛИ НЕ ЗначениеЗаполнено(БанковскийСчет)
		Тогда
		Возврат;
	КонецЕсли;
	
	МенеджерЗаписи = РегистрыСведений.ОсновныеВариантыПеречисленияСотруднику.СоздатьМенеджерЗаписи();
	МенеджерЗаписи.Организация    = Организация;
	МенеджерЗаписи.ФизическоеЛицо = ФизическоеЛицо;
	МенеджерЗаписи.ВидОперации    = ВидОперации;
	МенеджерЗаписи.БанковскийСчет = БанковскийСчет;
	Если НазначениеПлатежа = Неопределено 
		ИЛИ НЕ ЗначениеЗаполнено(БанковскийСчет)
		ИЛИ БанковскийСчет.Владелец = ФизическоеЛицо Тогда
		МенеджерЗаписи.НазначениеПлатежа = "";
	Иначе
		
		НазначениеПлатежа = СтрПолучитьСтроку(НазначениеПлатежа,1);
		ПозицияСумма = Найти(НазначениеПлатежа, "Сумма");
		НазначениеПлатежа = ?(ПозицияСумма = 0, НазначениеПлатежа, Лев(НазначениеПлатежа, ПозицияСумма - 1));
		
		МенеджерЗаписи.НазначениеПлатежа = НазначениеПлатежа;
		
	КонецЕсли;
	МенеджерЗаписи.Записать();
	
КонецПроцедуры

Функция ПолучитьНазначенияПлатежа(Организация, ФизическоеЛицо, ВидОперации, БанковскийСчет) Экспорт
	
	МенеджерЗаписи = РегистрыСведений.ОсновныеВариантыПеречисленияСотруднику.СоздатьМенеджерЗаписи();
	МенеджерЗаписи.Организация    = Организация;
	МенеджерЗаписи.ФизическоеЛицо = ФизическоеЛицо;
	МенеджерЗаписи.ВидОперации    = ВидОперации;
	МенеджерЗаписи.БанковскийСчет = БанковскийСчет;
	МенеджерЗаписи.Прочитать();
	
	Возврат МенеджерЗаписи.НазначениеПлатежа;
	
КонецФункции

Функция ПолучитьОсновнойВариантПеречисления(Реквизиты) Экспорт
	
	МенеджерЗаписи = РегистрыСведений.ОсновныеВариантыПеречисленияСотруднику.СоздатьМенеджерЗаписи();
	МенеджерЗаписи.Организация    = Реквизиты.Организация;
	МенеджерЗаписи.ФизическоеЛицо = Реквизиты.ФизическоеЛицо;
	МенеджерЗаписи.ВидОперации    = Реквизиты.ВидОперации;
	Если Реквизиты.БанковскийСчет <> Неопределено Тогда
		МенеджерЗаписи.БанковскийСчет = Реквизиты.БанковскийСчет;
	КонецЕсли;
	
	МенеджерЗаписи.Прочитать();
	ЗаполнитьЗначенияСвойств(Реквизиты, МенеджерЗаписи);
	
	Возврат Реквизиты;
	
КонецФункции

#КонецОбласти

#КонецЕсли