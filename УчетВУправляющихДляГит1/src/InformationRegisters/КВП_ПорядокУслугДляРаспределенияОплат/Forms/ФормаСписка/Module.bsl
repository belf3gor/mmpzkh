
#Область СлужебныеПроцедурыИФункции

&НаКлиенте
// Обработка действия "ПереместитьВверх" командной панели "ДействияФормы".
//
Процедура ПереместитьВверх(Команда)

	ИзменитьПорядокУТекущегоЭлемента(Истина);
	
КонецПроцедуры

&НаКлиенте
// Обработка действия "ПереместитьВниз" командной панели "ДействияФормы".
//
Процедура ПереместитьВниз(Команда)

	ИзменитьПорядокУТекущегоЭлемента(Ложь);
	
КонецПроцедуры

&НаСервере
// Измнить порядок элемента и зафиксировать в базе данных.
//
Процедура ИзменитьПорядокУТекущегоЭлемента(ПоднятьВверх)
	
	// ключ текущей записи
	ТекСтр = Элементы.Список.ТекущаяСтрока;
	Если ТекСтр = Неопределено Тогда
		Возврат;
	КонецЕсли;
	ТекЭлемент = ТекСтр.ВидУслуги;
	ТекДанные = РегистрыСведений.КВП_ПорядокУслугДляРаспределенияОплат.Получить(Новый Структура("ВидУслуги", 
																								ТекСтр.ВидУслуги));
	
	ТЗ =
	"ВЫБРАТЬ ПЕРВЫЕ 1
	|	КВП_ПорядокУслугДляРаспределенияОплат.ВидУслуги,
	|	КВП_ПорядокУслугДляРаспределенияОплат.Порядок
	|ИЗ
	|	РегистрСведений.КВП_ПорядокУслугДляРаспределенияОплат КАК КВП_ПорядокУслугДляРаспределенияОплат
	|ГДЕ
	|	КВП_ПорядокУслугДляРаспределенияОплат.Порядок " + ?(ПоднятьВверх, "<", ">") + " &Порядок
	|
	|УПОРЯДОЧИТЬ ПО
	|	КВП_ПорядокУслугДляРаспределенияОплат.Порядок " + ?(ПоднятьВверх, "Убыв", "Возр");
	
	Запрос = Новый Запрос(ТЗ);
	Запрос.УстановитьПараметр("Порядок", ТекДанные.Порядок);
	
	Выборка = Запрос.Выполнить().Выбрать();
	Если Не Выборка.Следующий() Тогда
		Возврат;
	КонецЕсли;
	
	НаборЗаписей1 = РегистрыСведений.КВП_ПорядокУслугДляРаспределенияОплат.СоздатьНаборЗаписей();
	НаборЗаписей1.Отбор.ВидУслуги.Установить(ТекЭлемент);
	НаборЗаписей1.Прочитать();
	Объект1 = НаборЗаписей1.Получить(0);
	НаборЗаписей2 = РегистрыСведений.КВП_ПорядокУслугДляРаспределенияОплат.СоздатьНаборЗаписей();
	НаборЗаписей2.Отбор.ВидУслуги.Установить(Выборка.ВидУслуги);
	НаборЗаписей2.Прочитать();
	Объект2 = НаборЗаписей2.Получить(0);
	
	НачатьТранзакцию();
	
	Порядок1 = Объект1.Порядок;
	Объект1.Порядок = Объект2.Порядок;
	Объект2.Порядок = Порядок1;
	НаборЗаписей1.Записать();
	НаборЗаписей2.Записать();
	
	ЗафиксироватьТранзакцию();
	
КонецПроцедуры

#КонецОбласти

#Область ИнициализацияПеременных

УПЖКХ_ТиповыеМетодыКлиентСервер.УстановитьЭлементПорядка(Список.Порядок, "Порядок");

#КонецОбласти