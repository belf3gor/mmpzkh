
////////////////////////////////////////////////////////////////////////////////
// ОБЩИЕ ПРОЦЕДУРЫ И ФУНКЦИИ

#Область ОбщиеПроцедурыИФункции

&НаКлиенте
// Процедура проверяет заполнение табличных частей.
Процедура ПроверитьЗаполнениеЗаписи(Отказ)
	
	Для Каждого СтрокаТаблицы ИЗ ТаблицаСтавокНДС Цикл
		Если НЕ ЗначениеЗаполнено(СтрокаТаблицы.СтавкаНДС) Тогда
			УПЖКХ_ТиповыеМетодыКлиентСервер.СообщитьОбОшибке("В процессе записи обнаружены ошибки заполнения. В строке " + (СтрокаТаблицы.ПолучитьИдентификатор() + 1) + " не указана ставка НДС.");
			Отказ = Истина;
		КонецЕсли;
		Если СтрокаТаблицы.ДоляНачисления = 0 Тогда
			УПЖКХ_ТиповыеМетодыКлиентСервер.СообщитьОбОшибке("В процессе записи обнаружены ошибки заполнения. В строке " + (СтрокаТаблицы.ПолучитьИдентификатор() + 1) + " не указана доля начисления.");
			Отказ = Истина;
		КонецЕсли;
	КонецЦикла;
	
	Если НЕ ТаблицаСтавокНДС.Итог("ДоляНачисления") = 100 Тогда
		УПЖКХ_ТиповыеМетодыКлиентСервер.СообщитьОбОшибке("В процессе записи обнаружены ошибки заполнения. Сумма долей начисления должна быть равна 100%.");
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

#Область ОбработчикиСобытийФормы

&НаСервере
// Обработчик события "ПриЧтенииНаСервере" формы.
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	
	СтавкиНДС = ТекущийОбъект.СтавкиНДС.Получить();
	Если ТипЗнч(СтавкиНДС) = Тип("ТаблицаЗначений") Тогда
		ТаблицаСтавокНДС.Загрузить(СтавкиНДС);
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
// Обработчик события "ПередЗаписью" формы.
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	
	ПроверитьЗаполнениеЗаписи(Отказ);
	
КонецПроцедуры

&НаСервере
// Обработчик события "ПередЗаписьюНаСервере" формы.
Процедура ПередЗаписьюНаСервере(Отказ, ТекущийОбъект, ПараметрыЗаписи)
	
	ТекущийОбъект.СтавкиНДС = Новый ХранилищеЗначения(ТаблицаСтавокНДС.Выгрузить());
	
КонецПроцедуры

#КонецОбласти