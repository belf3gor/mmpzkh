
/////////////////////////////////////////////////////////////////////////
// ПОЛУЧЕНИЕ СВЕДЕНИЙ О ФАЙЛЕ

#Область ПолучениеСведенийОФайле

&НаСервере
// Формирует сведения о файле обмена.
//
Функция ПолучитьСведенияОФайлеОбмена(СтруктураОтбора) Экспорт
	
	// Формируем итоговую структуру сведений о файле.
	СтруктураСведенийОФайле = Новый Структура("СохраненныйФайл, РасширениеФайла, ВерсияФорматаОбмена, НомерБилда, СписокМодулейСтрокой");
	
	// Заполняем структуру для отбора записи из регистра.
	СтруктураОтбораТекущая = Новый Структура("НастройкаДоступа, ВариантОбмена, ВидОбмена, Дата");
	ЗаполнитьЗначенияСвойств(СтруктураОтбораТекущая, СтруктураОтбора);
	
	// Получаем искомую запись регистра.
	НайденнаяЗапись = РегистрыСведений.УПЖКХ_ЖурналОбменаССайтом.Получить(СтруктураОтбораТекущая);
	
	// Заполняем итоговую структуру сведений о файле.
	Если НЕ НайденнаяЗапись = Неопределено Тогда
		
		СохраненныйФайл = НайденнаяЗапись.ФайлОбмена.Получить();
		Расширение      = ПолучитьРасширениеФайлаОбмена(СохраненныйФайл);
		
		СтруктураСведенийОФайле.СохраненныйФайл      = СохраненныйФайл;
		СтруктураСведенийОФайле.РасширениеФайла      = Расширение;
		СтруктураСведенийОФайле.ВерсияФорматаОбмена  = НайденнаяЗапись.ВерсияФорматаОбмена;
		СтруктураСведенийОФайле.НомерБилда           = НайденнаяЗапись.НомерБилда;
		СтруктураСведенийОФайле.СписокМодулейСтрокой = НайденнаяЗапись.УстановленныеМодули;
		
	КонецЕсли;
	
	Возврат СтруктураСведенийОФайле;
	
КонецФункции

&НаСервере
// Определяет расширение сохраненного файла обмена.
//
Функция ПолучитьРасширениеФайлаОбмена(СохраненныйФайл)
	
	ПервыеСимволы = Лев(Base64Строка(СохраненныйФайл), 3);
	
	Расширение = "";
	
	// xml.
	Если ПервыеСимволы = "PD9" Тогда
		Расширение = "xml";
	// zip.
	ИначеЕсли ПервыеСимволы = "UEs" Тогда
		Расширение = "zip";
	КонецЕсли;
	
	Возврат Расширение;
	
КонецФункции

#КонецОбласти