
#Область СлужебныеПроцедурыИФункции

&НаСервере
// Процедура вычисляет сумму задолженности по л/с и сумму пени на дату документа.
Процедура ЗаполнитьГрафикПлатежейНаСервере()
	
	ОбъектДокумента = ДанныеФормыВЗначение(Объект, Тип("ДокументОбъект.УПЖКХ_СудебноеСоглашение"));
	ОбъектДокумента.ЗаполнитьГрафикПлатежей();
	ЗначениеВДанныеФормы(ОбъектДокумента, Объект);
	
КонецПроцедуры

&НаСервере
// Процедура вычисляет сумму задолженности по л/с и сумму пени на дату документа.
Процедура ОбновитьЗадолженность(ЛС)
	
	Объект.СуммаПоСоглашению  = РегистрыНакопления.КВП_ВзаиморасчетыПоЛицевымСчетам.Остатки(Объект.ДатаНачалаПлатежей,
							новый Структура("Организация,ЛицевойСчет",Объект.Организация,ЛС),"ЛицевойСчет").Итог("СуммаНачисления");
	
КонецПроцедуры

&НаКлиенте
// Процедура - обработчик команды "КомандаЗаполнитьГрафикПлатежей".
//
Процедура КомандаЗаполнитьГрафикПлатежей(Команда)
	
	ЗаполнитьГрафикПлатежейНаСервере();
	
КонецПроцедуры

&НаКлиенте
// Процедура - обработчик команды "КомандаОбновитьЗадолженность".
//
Процедура КомандаОбновитьЗадолженность(Команда)
	
	ОбновитьЗадолженность(Объект.ЛицевойСчет);
	
КонецПроцедуры

&НаКлиенте
// Процедура - обработчик события "ОбработкаВыбора" поля ввода "ЛицевойСчет".
//
Процедура ЛицевойСчетОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	Если НЕ ВыбранноеЗначение = Объект.ЛицевойСчет Тогда
		ОбновитьЗадолженность(ВыбранноеЗначение);
		Объект.ГрафикПлатежей.Очистить();
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийФормы

&НаСервере
// Процедура - обработчик события "ПриЧтенииНаСервере" формы.
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	
	УПЖКХ_ТиповыеМетодыСервер.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);
	УПЖКХ_ТиповыеМетодыСервер.УстановитьСостояниеДокумента(ЭтотОбъект);
	
КонецПроцедуры

&НаСервере
// Процедура - обработчик события "ПриСозданииНаСервере" формы.
//
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// СтандартныеПодсистемы.ПодключаемыеКоманды
	УПЖКХ_ТиповыеМетодыСервер.ПриСозданииНаСервере(ЭтаФорма);
	// Конец СтандартныеПодсистемы.ПодключаемыеКоманды
	
	Если Объект.Ссылка.Пустая() Тогда
		ОбъектДокумента = ДанныеФормыВЗначение(Объект, Тип("ДокументОбъект.УПЖКХ_СудебноеСоглашение"));
		УПЖКХ_ЗаполнениеДокументовСервер.ЗаполнитьШапкуДокумента(ОбъектДокумента, УПЖКХ_ТиповыеМетодыКлиентСервер.ТекущийПользователь());
		ЗначениеВДанныеФормы(ОбъектДокумента, Объект);
		
		УПЖКХ_ТиповыеМетодыСервер.УстановитьСостояниеДокумента(ЭтотОбъект);
	КонецЕсли;
	
	Если Параметры.Свойство("ДокументВводитсяНаОснованииПараметров") И Параметры.ДокументВводитсяНаОснованииПараметров Тогда
		
		Если Параметры.Свойство("ПараметрыЗаполнения") Тогда
			
			ПараметрыЗаполнения = Параметры.ПараметрыЗаполнения;
			
			ПараметрыЗаполнения.Свойство("ДатаНачалаПлатежей",  Объект.ДатаНачалаПлатежей);
			ПараметрыЗаполнения.Свойство("Организация",         Объект.Организация);
			ПараметрыЗаполнения.Свойство("ЛицевойСчет",         Объект.ЛицевойСчет);
			ПараметрыЗаполнения.Свойство("СуммаПоСоглашению",   Объект.СуммаПоСоглашению);
			ПараметрыЗаполнения.Свойство("МесяцевПоСоглашению", Объект.МесяцевПоСоглашению);
			ПараметрыЗаполнения.Свойство("Комментарий",         Объект.Комментарий);
			
			
			ЗаполнитьГрафикПлатежейНаСервере();
			
		КонецЕсли;
		
	КонецЕсли;
	
	СЗК_МодульЗащитыКлиентСервер.УстановитьДоступностьФормыДляРедактирования(ЭтаФорма);
	
	// ОбщиеМеханизмыИКоманды
	ОТР_ПодключаемыеОбщиеМеханизмыИКоманды.ПриСозданииНаСервере(ЭтаФорма);
	// Конец ОбщиеМеханизмыИКоманды
	
КонецПроцедуры

&НаСервере
// Процедура - обработчик события "ПослеЗаписиНаСервере" формы.
//
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	УПЖКХ_ТиповыеМетодыСервер.УстановитьСостояниеДокумента(ЭтотОбъект);
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

// СтандартныеПодсистемы.ПодключаемыеКоманды
&НаКлиенте
Процедура Подключаемый_ВыполнитьКоманду(Команда)
	
	УПЖКХ_ТиповыеМетодыКлиент.ВыполнитьКоманду(ЭтотОбъект, Команда, Объект);
	
КонецПроцедуры

&НаСервере
Процедура Подключаемый_ВыполнитьКомандуНаСервере(Контекст, Результат)
	
	УПЖКХ_ТиповыеМетодыСервер.ВыполнитьКоманду(ЭтотОбъект, Контекст, Объект, Результат);
	
КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_ОбновитьКоманды()
	
	УПЖКХ_ТиповыеМетодыКлиентСервер.ОбновитьКоманды(ЭтотОбъект, Объект);
	
КонецПроцедуры
// Конец СтандартныеПодсистемы.ПодключаемыеКоманды

// ЧастоЗадаваемыеВопросы
&НаКлиенте
// Подключаемый обработчик команды перехода к часто задаваемым вопросам.
Процедура Подключаемый_ЧастоЗадаваемыеВопросыОткрытьСсылку(Команда)
	
	ОТР_ЧастоЗадаваемыеВопросыКлиент.Подключаемый_ЧастоЗадаваемыеВопросыОткрытьСсылку(Команда);
	
КонецПроцедуры
// Конец ЧастоЗадаваемыеВопросы

#КонецОбласти