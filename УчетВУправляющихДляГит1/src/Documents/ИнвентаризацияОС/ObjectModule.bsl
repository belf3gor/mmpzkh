#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбработчикиСобытий

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)

	ТипДанныхЗаполнения = ТипЗнч(ДанныеЗаполнения);
	Если ДанныеЗаполнения <> Неопределено
			И ТипДанныхЗаполнения <> Тип("Структура")
			И Метаданные().ВводитсяНаОсновании.Содержит(ДанныеЗаполнения.Метаданные()) Тогда
		ЗаполнитьПоДокументуОснованию(ДанныеЗаполнения);
	КонецЕсли;
	ЗаполнениеДокументов.Заполнить(ЭтотОбъект, ДанныеЗаполнения);

КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)

	УправлениеВнеоборотнымиАктивами.ПроверитьОтсутствиеДублейВТабличнойЧасти(ЭтотОбъект, "ОС", Новый Структура("ОсновноеСредство"), Отказ);
	ПроверитьЗаполнениеНаличияВСпискеОС(Отказ);
	
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	
	Дата = НачалоДня(ОбщегоНазначения.ТекущаяДатаПользователя());
	Ответственный = Пользователи.ТекущийПользователь();
	
	Для каждого ОсновноеСредство Из ОС Цикл
		
		ОсновноеСредство.СтоимостьПоДаннымУчета = 0;
		ОсновноеСредство.НаличиеПоДаннымУчета = Ложь;
		
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

Процедура ЗаполнитьПоДокументуОснованию(Основание)

	// Заполним реквизиты из стандартного набора по документу основанию.
	ЗаполнениеДокументов.ЗаполнитьПоОснованию(ЭтотОбъект, Основание);

КонецПроцедуры

Процедура ПроверитьЗаполнениеНаличияВСпискеОС(Отказ)
	
	НомераНекорректныхСтрок = Новый Массив;
		
	Для каждого СтрокаТЧ Из ЭтотОбъект.ОС Цикл
		Если СтрокаТЧ.НаличиеПоДаннымУчета = Ложь И СтрокаТЧ.НаличиеФактическое = Ложь Тогда
			НомераНекорректныхСтрок.Добавить(СтрокаТЧ.НомерСтроки);
		КонецЕсли;
	КонецЦикла;
	
	Если НомераНекорректныхСтрок.Количество() > 0 Тогда	
		Для каждого НомерСтроки из НомераНекорректныхСтрок Цикл
			ТекстСообщения = НСтр("ru = 'Не указана информация о наличии основного средства в строке %1 списка ""ОсновныеСредства"".
									|Укажите наличие по данным учета или фактическое.'");
			ТекстСообщения = СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(ТекстСообщения, НомерСтроки);
			Поле = "ОС[" + Формат(НомерСтроки - 1, "ЧН=0; ЧГ=") + "].НаличиеПоДаннымУчета";
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(ТекстСообщения, ЭтотОбъект, Поле);
		КонецЦикла;	
		Отказ = Истина;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли