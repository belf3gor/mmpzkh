
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ОбщиеПроцедурыИФункции

// Обработчик события "ПриЗаписи" документа.
Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ПометкаУдаления Тогда
		Запрос = Новый Запрос;
		Запрос.Текст =
		"ВЫБРАТЬ
		|	УПЖКХ_ЭлектронныеПаспортаДляОтправкиНаСайтСрезПоследних.ЭлектронныйПаспорт
		|ИЗ
		|	РегистрСведений.УПЖКХ_ЭлектронныеПаспортаДляОтправкиНаСайт.СрезПоследних(&ТекущаяДата, ЭлектронныйПаспорт = &ЭлектронныйПаспорт) КАК УПЖКХ_ЭлектронныеПаспортаДляОтправкиНаСайтСрезПоследних
		|ГДЕ
		|	УПЖКХ_ЭлектронныеПаспортаДляОтправкиНаСайтСрезПоследних.СтатусОтправки = ЗНАЧЕНИЕ(Перечисление.УПЖКХ_СтатусыОтправкиЭлектронныхПаспортовНаСайт.ГотовКОтправке)";
		Запрос.УстановитьПараметр("ТекущаяДата",        ТекущаяДата());
		Запрос.УстановитьПараметр("ЭлектронныйПаспорт", Ссылка);
		
		Выборка = Запрос.Выполнить().Выбрать();
		
		// Если в регистре сведений "Электронные паспорта для отправки на сайт" для текущего паспорта есть запись, символизирующая, что он готов к отправке на сайт,
		// то при пометке на удаление текущего паспорта надо указать, что отправка на сайт отменена.
		// Кроме того следует сбросить значение тумблера "Паспорт заполнен полностью".
		Если Выборка.Следующий() Тогда
			УПЖКХ_ВебИнтеграцияВзаимодействиеСБазойДанных.СоздатьЗаписьВРегистреЭПДляОтправки(ТекущаяДата(), Ссылка, Перечисления.УПЖКХ_СтатусыОтправкиЭлектронныхПаспортовНаСайт.ОтправкаОтменена);
			
			ПаспортЗаполнен = Ложь;
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли