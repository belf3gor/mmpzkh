
#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область ПроцедурыИФункцииДляОбеспеченияПроведенияДокумента

// Возвращает доступные варианты печати документа
//
// Возвращаемое значение:
//  Структура, каждая строка которой соответствует одному из вариантов печати.
//
Функция ПолучитьСтруктуруПечатныхФорм() Экспорт
	
	Структура = Новый Структура;

	Возврат Структура	
	
КонецФункции

#КонецОбласти 

#Область ПроцедурыИФункцииДляОбеспеченияПроведенияДокумента

// Процедура формирует движения документа по регистрам.
//
Процедура ДвиженияПоРегистрам(РежимПроведения, СтруктураШапкиДокумента, ТаблицаПоВознаграждениям, Отказ, Заголовок)
	
	НаборДвижений = Движения.КВП_СтавкиВознагражденияСоСборовЗаУслуги;
	
	Для Каждого ТекСтрока Из ТаблицаПоВознаграждениям Цикл
		
		НовоеДвижение = НаборДвижений.Добавить();
		НовоеДвижение.Организация           = СтруктураШапкиДокумента.Организация;
		НовоеДвижение.УправляющаяКомпания   = СтруктураШапкиДокумента.УправляющаяКомпания;
		НовоеДвижение.ВидУслуги             = ТекСтрока.ВидыУслуг;
		НовоеДвижение.Услуга                = ТекСтрока.Услуга;
		НовоеДвижение.ПоставщикУслуг        = СтруктураШапкиДокумента.ПоставщикУслуг;
		НовоеДвижение.ПроцентВознаграждения = ТекСтрока.Процент;
		
		НовоеДвижение.ПроцентШтрафа         = ТекСтрока.ПроцентШтрафа;
		НовоеДвижение.СпособРасчета         = ТекСтрока.СпособРасчета;

		НовоеДвижение.НДСВТомЧисле          = СтруктураШапкиДокумента.НДСВТомЧисле;
		НовоеДвижение.Период                = СтруктураШапкиДокумента.Дата;
		
	КонецЦикла;
	
КонецПроцедуры

#КонецОбласти 

#Область ОбработчикиСобытийДокумента

// Обработчик события "ОбработкаЗаполнения" документа.
Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	УПЖКХ_ТиповыеМетодыСервер.Заполнить(ЭтотОбъект, ДанныеЗаполнения);
	
КонецПроцедуры

// Процедура проведения документа.
Процедура ОбработкаПроведения(Отказ, Режим)
	
	Заголовок = УПЖКХ_ТиповыеМетодыВызовСервера.ПредставлениеДокументаПриПроведении(Ссылка);
	
	// Сформируем запрос на дополнительные параметры, нужные при проведении,
	// по данным шапки документа.
	ПараметрыПроведения = 
		Документы.КВП_УстановкиПроцентовВознагражденияПоУслугам.ПодготовитьПараметрыПроведения(Ссылка, Отказ);
	Если Отказ Тогда
		Возврат;
	КонецЕсли;
	
	СтруктураШапкиДокумента  = ПараметрыПроведения.Реквизиты;
	ТаблицаПоВознаграждениям = ПараметрыПроведения.ТаблицаПоВознаграждениям;
		
	Если НЕ Отказ Тогда
		
		ДвиженияПоРегистрам(Режим, СтруктураШапкиДокумента, ТаблицаПоВознаграждениям, Отказ, Заголовок);
		
	КонецЕсли;
	
КонецПроцедуры

// Обработчик события "ОбработкаПроверкиЗаполнения" документа.
Процедура ОбработкаПроверкиЗаполнения(Отказ, ПроверяемыеРеквизиты)
	
	ПроверяемыеРеквизиты.Добавить("Организация");
	ПроверяемыеРеквизиты.Добавить("ПоставщикУслуг");
	
	ПроверяемыеРеквизиты.Добавить("Услуги.ВидыУслуг");
	ПроверяемыеРеквизиты.Добавить("Услуги.Услуга");
	ПроверяемыеРеквизиты.Добавить("Услуги.Процент");
	ПроверяемыеРеквизиты.Добавить("Услуги.СпособРасчета");
	
КонецПроцедуры

#КонецОбласти 

#КонецЕсли