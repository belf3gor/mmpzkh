#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

#Область СлужебныеПроцедурыИФункции

Процедура ПодготовитьТаблицыДокумента(ТаблицаВыручки) Экспорт
	
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("ДокументОснование", ДокументОснование);
	Запрос.УстановитьПараметр("СчетФактура", Ссылка);
	Запрос.Текст =
	"ВЫБРАТЬ
	|	ВводНачальныхОстатковДанныеПоСФНДС.СчетУчета КАК СчетУчетаНДС,
	|	ВводНачальныхОстатковДанныеПоСФНДС.СтавкаНДС,
	|	ВводНачальныхОстатковДанныеПоСФНДС.НДС,
	|	ВводНачальныхОстатковДанныеПоСФНДС.СуммаБезНДС,
	|	ВводНачальныхОстатковДанныеПоСФНДС.ВидЦенности
	|ИЗ
	|	Документ.ВводНачальныхОстатков.ДанныеПоСФНДС КАК ВводНачальныхОстатковДанныеПоСФНДС
	|ГДЕ
	|	ВводНачальныхОстатковДанныеПоСФНДС.Ссылка.РазделУчета = ЗНАЧЕНИЕ(Перечисление.РазделыУчетаДляВводаОстатков.НДСПоПриобретеннымЦенностям)
	|	И ВводНачальныхОстатковДанныеПоСФНДС.СчетФактура = &СчетФактура";
	
	ТаблицаВыручки = Запрос.Выполнить().Выгрузить();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытий

Процедура ОбработкаЗаполнения(ДанныеЗаполнения, СтандартнаяОбработка)
	
	ЗаполнениеДокументов.Заполнить(ЭтотОбъект, ДанныеЗаполнения);
	
	Если ЗначениеЗаполнено(ДоговорКонтрагента) Тогда
		ВалютаДокумента = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ДоговорКонтрагента, "ВалютаВзаиморасчетов");
	КонецЕсли;
	
КонецПроцедуры

Процедура ПриКопировании(ОбъектКопирования)
	
	Дата              = НачалоДня(ОбщегоНазначения.ТекущаяДатаПользователя());
	ДокументОснование = Неопределено;
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ, РежимЗаписи, РежимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	// Если не ведется учет по договорам и заполнен договор, 
	// то по реквизитам этого договора ищем основной договор
	// Если находим, то устанавливаем основной договор в качестве договора контрагента в документе.
	// В случае если не находим, то устанавливаем договор, который выбрал пользователь, как основной. 
	Если НЕ ПолучитьФункциональнуюОпцию("ВестиУчетПоДоговорам") И ЗначениеЗаполнено(ДоговорКонтрагента) Тогда
		СтруктураРеквизитов = ОбщегоНазначения.ЗначенияРеквизитовОбъекта(ДоговорКонтрагента, "Организация, Владелец, ВидДоговора");
		
		ОсновнойДоговор = Справочники.ДоговорыКонтрагентов.ПустаяСсылка();
		РаботаСДоговорамиКонтрагентовБП.УстановитьДоговорКонтрагента(
			ОсновнойДоговор, 
			СтруктураРеквизитов.Владелец,
			СтруктураРеквизитов.Организация,
			СтруктураРеквизитов.ВидДоговора);
			
		Если ЗначениеЗаполнено(ОсновнойДоговор) Тогда
			ДоговорКонтрагента = ОсновнойДоговор;
		Иначе
			РаботаСДоговорамиКонтрагентовБП.УстановитьОсновнойДоговорКонтрагента(ДоговорКонтрагента);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти

#КонецЕсли
