////////////////////////////////////////////////////////////////////////////////
// ПРОЦЕДУРЫ И ФУНКЦИИ ОБЩЕГО НАЗНАЧЕНИЯ

#Область ПроцедурыИФункцииОбщегоНазначения

// Процедура формирует и устанавливает текст заголовка формы документа.
//
&НаСервере
Процедура УстановитьЗаголовокФормыДокумента()
	
	УПЖКХ_РаботаСДиалогамиКлиентСервер.УстановитьЗаголовокФормыДокумента(Строка(Объект.ВидОперации),
																			Объект.Ссылка, ЭтаФорма);
	
КонецПроцедуры

// Процедура устанавливает подменю "Печать" и кнопку "Печать по умолчанию" при необходимости.
//
&НаКлиенте
Процедура УстановитьКнопкиПечати()
	
	Если Объект.ВидОперации = ПредопределенноеЗначение("Перечисление.КВП_ВидыОперацийРегистрацииПоМестуЖительства.Регистрация") Тогда
		Показать = Истина;
	Иначе		
		Показать = Ложь;
	КонецЕсли;
	
	Элементы.ФормаКоманднаяПанель.ПодчиненныеЭлементы.ФормаПечать.ПодчиненныеЭлементы.ФормаДокументКВП_ЗаявлениеОРегистрацииОСнятииСРегистрационногоУчетаПоМестуЖительстваПечатьФ2.Видимость = Показать;
	Элементы.ФормаКоманднаяПанель.ПодчиненныеЭлементы.ФормаПечать.ПодчиненныеЭлементы.ФормаДокументКВП_ЗаявлениеОРегистрацииОСнятииСРегистрационногоУчетаПоМестуЖительстваПечатьС_ПР.Видимость = Показать;
	Элементы.ФормаКоманднаяПанель.ПодчиненныеЭлементы.ФормаПечать.ПодчиненныеЭлементы.ФормаДокументКВП_ЗаявлениеОРегистрацииОСнятииСРегистрационногоУчетаПоМестуЖительстваПечатьС_ЗП.Видимость = Показать;
	Элементы.ФормаКоманднаяПанель.ПодчиненныеЭлементы.ФормаПечать.ПодчиненныеЭлементы.ФормаДокументКВП_ЗаявлениеОРегистрацииОСнятииСРегистрационногоУчетаПоМестуЖительстваПечатьЗ_С.Видимость = Показать;
	Элементы.ФормаКоманднаяПанель.ПодчиненныеЭлементы.ФормаПечать.ПодчиненныеЭлементы.ФормаДокументКВП_ЗаявлениеОРегистрацииОСнятииСРегистрационногоУчетаПоМестуЖительстваПечатьРФЛ1.Видимость = Показать;
	
	Элементы.ФормаКоманднаяПанель.ПодчиненныеЭлементы.ФормаПечать.ПодчиненныеЭлементы.ФормаДокументКВП_ЗаявлениеОРегистрацииОСнятииСРегистрационногоУчетаПоМестуЖительстваПечатьФ7.Видимость = Не Показать;
	
КонецПроцедуры

// Возвращает массив собственников по лицевому счету.
&НаСервере
Функция ПолучитьМассивСобственников()
	
	ТаблицаСобственников = ПолучитьДанныеОСобственностиПомещения(Объект.ЛицевойСчет.Адрес, Объект.Дата);
	
	Возврат ТаблицаСобственников.ВыгрузитьКолонку("Собственник");
	
КонецФункции

#КонецОбласти

////////////////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

#Область ОбработчикиСобытийФормы

// Процедура - обработчик события "ПриЧтенииНаСервере" формы.
&НаСервере
Процедура ПриЧтенииНаСервере(ТекущийОбъект)
	
	УПЖКХ_ТиповыеМетодыСервер.ОбъектПриЧтенииНаСервере(ЭтаФорма, ТекущийОбъект);
	
КонецПроцедуры

// Процедура - обработчик события "ПриСозданииНаСервере" формы.
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// СтандартныеПодсистемы.ПодключаемыеКоманды
	УПЖКХ_ТиповыеМетодыСервер.ПриСозданииНаСервере(ЭтаФорма);
	// Конец СтандартныеПодсистемы.ПодключаемыеКоманды
	
	// Устанавливаем значение по умолчанию.
	Если Объект.Ссылка.Пустая() Тогда
		УПЖКХ_ЗаполнениеДокументовСервер.ЗаполнитьШапкуДокумента(Объект,
																	УПЖКХ_ТиповыеМетодыКлиентСервер.ТекущийПользователь());
	КонецЕсли;
	
	// Вывести в заголовке формы вид операции.
	УстановитьЗаголовокФормыДокумента();
	
	// Установить доступность формы с учетом ключа СЛК.
	СЗК_МодульЗащитыКлиентСервер.УстановитьДоступностьФормыДляРедактирования(ЭтаФорма);
	
	// ОбщиеМеханизмыИКоманды
	ОТР_ПодключаемыеОбщиеМеханизмыИКоманды.ПриСозданииНаСервере(ЭтаФорма);
	// Конец ОбщиеМеханизмыИКоманды
	
КонецПроцедуры

// Процедура - обработчик события "ПриОткрытии" формы.
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	// Установка кнопок печати
	УстановитьКнопкиПечати();
	
КонецПроцедуры

// Процедура - обработчик события "ПослеЗаписиНаСервере" формы.
&НаСервере
Процедура ПослеЗаписиНаСервере(ТекущийОбъект, ПараметрыЗаписи)
	
	// Вывести в заголовке формы вид операции и статус документа (новый, не проведен, проведен).
	УстановитьЗаголовокФормыДокумента();
	
КонецПроцедуры

#КонецОбласти

//////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ФОРМЫ

#Область ОбработчикиСобытийЭлементовФормы

// Процедура - обработчик события "ПриИзменении" поля ввода даты документа.
&НаКлиенте
Процедура ДатаПриИзменении(Элемент)
	
	УПЖКХ_РаботаСДиалогамиКлиентСервер.ПроверитьНомерДокумента(Объект, Объект.Дата);
	
КонецПроцедуры

// Процедура - обработчик события "НачалоВыбора" поля ввода проживающего.
&НаКлиенте
Процедура ПроживающийНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	Если Не Объект.ЛицевойСчет.Пустая() Тогда
		СтандартнаяОбработка = Ложь;
		
		ОткрытьФорму("Справочник.УПЖКХ_Жильцы.Форма.ФормаВыбора", Новый Структура("ЛицевойСчет", Объект.ЛицевойСчет), Элемент);
	КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода проживающего.
&НаКлиенте
Процедура ПроживающийПриИзменении(Элемент)
	
	Объект.ЛицевойСчет = УПЖКХ_ОбщегоНазначенияСервер.ПолучитьЗначениеРеквизита(Объект.Проживающий, "Владелец");
	
	Если Не УПЖКХ_ОбщегоНазначенияСервер.ПолучитьЗначениеРеквизита(Объект.Собственник, "Владелец") = Объект.ЛицевойСчет Тогда
		Объект.Собственник = ПредопределенноеЗначение("Справочник.УПЖКХ_Жильцы.ПустаяСсылка");
	КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода Лицевой счет.
&НаКлиенте
Процедура ЛицевойСчетПриИзменении(Элемент)
	
	Если УПЖКХ_ОбщегоНазначенияСервер.ПолучитьЗначениеРеквизита(Объект.Проживающий, "Владелец") <> Объект.ЛицевойСчет Тогда
		Объект.Проживающий = ПредопределенноеЗначение("Справочник.УПЖКХ_Жильцы.ПустаяСсылка");
	КонецЕсли;
	
	Если Не УПЖКХ_ОбщегоНазначенияСервер.ПолучитьЗначениеРеквизита(Объект.Собственник, "Владелец") = Объект.ЛицевойСчет Тогда
		Объект.Собственник = ПредопределенноеЗначение("Справочник.УПЖКХ_Жильцы.ПустаяСсылка");
	КонецЕсли;
	
КонецПроцедуры

// Процедура - обработчик события "ПриИзменении" поля ввода ВидОперации.
&НаКлиенте
Процедура ВидОперацииПриИзменении(Элемент)
	
	// Вывести в заголовке формы вид операции и статус документа (новый, не проведен, проведен).
	УстановитьЗаголовокФормыДокумента();
	
	УстановитьКнопкиПечати();
	
КонецПроцедуры

// Процедура - обработчик события "НачалоВыбора" поля ввода Собственник.
&НаКлиенте
Процедура СобственникНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	МассивПараметров = Новый Массив();
	
	МассивСобственников = ПолучитьМассивСобственников();
	
	МассивПараметров.Добавить(Новый ПараметрВыбора("Отбор.ФизЛицо",  МассивСобственников));
	МассивПараметров.Добавить(Новый ПараметрВыбора("Отбор.Владелец", Объект.ЛицевойСчет));
	
	НовыеПараметрыВыбора = Новый ФиксированныйМассив(МассивПараметров);
	
	Элемент.ПараметрыВыбора = НовыеПараметрыВыбора;
	
КонецПроцедуры

#КонецОбласти

//////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ

#Область ОбработчикиКомандФормы

// СтандартныеПодсистемы.ПодключаемыеКоманды
&НаКлиенте
Процедура Подключаемый_ВыполнитьКоманду(Команда)
	
	УПЖКХ_ТиповыеМетодыКлиент.ВыполнитьКоманду(ЭтотОбъект, Команда, Объект);
	
КонецПроцедуры

&НаСервере
Процедура Подключаемый_ВыполнитьКомандуНаСервере(Контекст, Результат)
	
	УПЖКХ_ТиповыеМетодыСервер.ВыполнитьКоманду(ЭтотОбъект, Контекст, Объект, Результат);
	
КонецПроцедуры

&НаКлиенте
Процедура Подключаемый_ОбновитьКоманды()
	
	УПЖКХ_ТиповыеМетодыКлиентСервер.ОбновитьКоманды(ЭтотОбъект, Объект);
	
КонецПроцедуры
// Конец СтандартныеПодсистемы.ПодключаемыеКоманды

// ЧастоЗадаваемыеВопросы
&НаКлиенте
// Подключаемый обработчик команды перехода к часто задаваемым вопросам.
Процедура Подключаемый_ЧастоЗадаваемыеВопросыОткрытьСсылку(Команда)
	
	ОТР_ЧастоЗадаваемыеВопросыКлиент.Подключаемый_ЧастоЗадаваемыеВопросыОткрытьСсылку(Команда);
	
КонецПроцедуры
// Конец ЧастоЗадаваемыеВопросы

#КонецОбласти