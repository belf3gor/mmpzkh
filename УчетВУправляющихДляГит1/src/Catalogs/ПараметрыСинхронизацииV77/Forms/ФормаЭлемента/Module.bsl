&НаКлиенте
Процедура ВыборФайла(Элемент, ПроверятьСуществование=Ложь)
		
	ДиалогВыбораФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);

	ДиалогВыбораФайла.Фильтр                      = "Файл данных (*.xml)|*.xml";
	ДиалогВыбораФайла.Заголовок                   = "Выберите файл";
	ДиалогВыбораФайла.ПредварительныйПросмотр     = Ложь;
	ДиалогВыбораФайла.Расширение                  = "xml";
	ДиалогВыбораФайла.ИндексФильтра               = 0;	
	ДиалогВыбораФайла.ПолноеИмяФайла              = Элемент.ТекстРедактирования;
	ДиалогВыбораФайла.ПроверятьСуществованиеФайла = Ложь;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ВыборФайлаЗавершение", ЭтотОбъект);
	ДиалогВыбораФайла.Показать(ОписаниеОповещения);

КонецПроцедуры

&НаКлиенте
Процедура ВыборФайлаЗавершение(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт
	
	Если ВыбранныеФайлы <> Неопределено 
		И ВыбранныеФайлы.Количество()>0 Тогда
		
		Объект.ИмяФайлаДанных = ВыбранныеФайлы.Получить(0);
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ИмяФайлаДанныхНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ВыборФайла(Элемент, Истина);
	
КонецПроцедуры

&НаСервере
Процедура ОбновитьСписокПользователей()
	
	СписПользователей = ПользователиИнформационнойБазы.ПолучитьПользователей();
	
	Если СписПользователей.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	Если ПустаяСтрока(Объект.ОтветственныйПользователь) Тогда
		Возврат;
	КонецЕсли;	
	
	СписокПользователей.Очистить();
	СписокПользователей.Вставить(0, Объект.ОтветственныйПользователь);
	
КонецПроцедуры

&НаСервере
Процедура СоздатьСписокПользователей()
	
	СписПользователей = ПользователиИнформационнойБазы.ПолучитьПользователей();
	
	Если СписПользователей.Количество() = 0 Тогда
		Возврат;
	КонецЕсли;
	
	Для Каждого Пользователь  Из СписПольЗователей Цикл
		ТекПользователь = ПользователиИнформационнойБазы.НайтиПоИмени(Пользователь.Имя);
		
		Если ТекПользователь.ПоказыватьВСпискеВыбора Тогда
			Элементы.СписокПользователей.СписокВыбора.Добавить(ТекПользователь.Имя);
		КонецЕсли;
	КонецЦикла;
	
	Если НЕ ПустаяСтрока(Объект.ОтветственныйПользователь) Тогда
		ЭлементСписка = Элементы.СписокПользователей.СписокВыбора.НайтиПоЗначению(Объект.ОтветственныйПользователь);
		Если ЭлементСписка <> Неопределено Тогда
			СписокПользователей.Вставить(0, ЭлементСписка.Значение);
			
			ТекПользователь = ПользователиИнформационнойБазы.НайтиПоИмени(ЭлементСписка.Значение);
		КонецЕсли;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	СоздатьСписокПользователей();
	
КонецПроцедуры

&НаКлиенте
Процедура СписокПользователейОбработкаВыбора(Элемент, ВыбранноеЗначение, СтандартнаяОбработка)
	
	ИмеетПраво = СинхронизацияДанныхV77ВызовСервера.ПроверитьПолныеПрава(ВыбранноеЗначение);
	
	Если НЕ ИмеетПраво Тогда
		ВыбранноеЗначение = "";
		Возврат;
	КонецЕсли;	
	
	Объект.ОтветственныйПользователь = ВыбранноеЗначение;
	ОбновитьСписокПользователей();
	
КонецПроцедуры