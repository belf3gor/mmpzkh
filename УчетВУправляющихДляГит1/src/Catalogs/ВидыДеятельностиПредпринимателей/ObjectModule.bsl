#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда

Процедура ПриЗаписи(Отказ)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Если БухгалтерскийУчетВызовСервераПовтИсп.ИспользоватьОднуНоменклатурнуюГруппу() Тогда
		
		ПерваяНоменклатурнаяГруппа = РегистрыСведений.ВидыДеятельностиПредпринимателей.ПолучитьПервуюНоменклатурнуюГруппу(Ссылка, ХарактерДеятельности);
		
		Если НЕ ЗначениеЗаполнено(ПерваяНоменклатурнаяГруппа) Тогда
			МенеджерЗаписиРегистра = РегистрыСведений.ВидыДеятельностиПредпринимателей.СоздатьМенеджерЗаписи();
			МенеджерЗаписиРегистра.НоменклатурнаяГруппа = НоменклатурнаяГруппа;
			МенеджерЗаписиРегистра.ВидДеятельности      = Ссылка;
			МенеджерЗаписиРегистра.ХарактерДеятельности = ХарактерДеятельности;
			МенеджерЗаписиРегистра.Записать(Ложь);
		КонецЕсли;
		
	КонецЕсли;
	
	// Очистка регистра сведений от записей не соответствующих заданному характеру деятельности
	РегистрыСведений.ВидыДеятельностиПредпринимателей.ОчиститьСписокНоменклатуныхГрупп(Ссылка, ХарактерДеятельности);
	
	Если ЗначениеЗаполнено(НоменклатурнаяГруппа) Тогда
		
		Если НЕ РегистрыСведений.ВидыДеятельностиПредпринимателей.ПолучитьВидДеятельности(ХарактерДеятельности, НоменклатурнаяГруппа) = Ссылка Тогда
			
			// В качестве основной номенклатурной группы указана номенклатурная групппа
			// не связанная с видом деятельности
			НоменклатурнаяГруппа = Неопределено;
			
		КонецЕсли;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ПередЗаписью(Отказ)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Если БухгалтерскийУчетВызовСервераПовтИсп.ИспользоватьОднуНоменклатурнуюГруппу() И  НЕ ЗначениеЗаполнено(НоменклатурнаяГруппа) Тогда
		
		НоменклатурнаяГруппа = БухгалтерскийУчетВызовСервераПовтИсп.ОсновнаяНоменклатурнаяГруппа();
		
	КонецЕсли;
	
КонецПроцедуры

#КонецЕсли
